# LangGraph SOLID –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ü–ª–∞–Ω

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 8 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 10 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** –í –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ (–§–∞–∑–∞ 7 ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê)  
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 7/8 —Ñ–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ (87.5%)
**–¶–µ–ª—å:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `app/agent_runner/langgraph/` –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID –±–µ–∑ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞

## üèÜ –ü–û–°–õ–ï–î–ù–ò–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

### ‚úÖ –§–∞–∑–∞ 7 –ó–ê–í–ï–†–®–ï–ù–ê (10 –∞–≤–≥—É—Å—Ç–∞ 2025)
- **94% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ factory.py**: 1007 ‚Üí 60 —Å—Ç—Ä–æ–∫ + 4 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏
- **SOLID –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: MainFactory, ComponentFactory, NodeFactory, LLMFactory
- **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: —á–µ—Ä–µ–∑ legacy_factory.py
- **–í—Å–µ —Ü–µ–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã**: —Ñ–∞–π–ª—ã <600 —Å—Ç—Ä–æ–∫, main_factory <300 —Å—Ç—Ä–æ–∫
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É**: 100% –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞

## üéØ SOLID –ù–ê–†–£–®–ï–ù–ò–Ø –ò –†–ï–®–ï–ù–ò–Ø

### Single Responsibility Principle (SRP) - –ù–ê–†–£–®–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** factory.py (1355 —Å—Ç—Ä–æ–∫) - –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—è–º–∏

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- LLM —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí `llm/manager.py`
- Workflow —É–∑–ª—ã ‚Üí `workflow/nodes.py` 
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –≤ `tools/`
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è ‚Üí `workflow/edges.py`

### Open/Closed Principle (OCP) - –ù–ê–†–£–®–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ñ–µ—Å—Ç–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –≤ `core/interfaces.py`

### Dependency Inversion Principle (DIP) - –ß–ê–°–¢–ò–ß–ù–û –ù–ê–†–£–®–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ dependency injection

## üèóÔ∏è –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

```
app/agent_runner/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ agent_runner.py             # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å (513 —Å—Ç—Ä–æ–∫) ‚úÖ –û–ö
‚îú‚îÄ‚îÄ runner_main.py              # Entry point (180 —Å—Ç—Ä–æ–∫) ‚úÖ –û–ö  
‚îú‚îÄ‚îÄ core/                       # –û—Å–Ω–æ–≤–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ ‚úÖ –°–û–ó–î–ê–ù–û
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ config_mixin.py         # ‚úÖ –ü–ï–†–ï–ú–ï–©–ï–ù–û –∏–∑ common/
‚îÇ   ‚îú‚îÄ‚îÄ interfaces.py           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã/–ø—Ä–æ—Ç–æ–∫–æ–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py           # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ langgraph/                  # LangGraph –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚úÖ –°–¢–†–£–ö–¢–£–†–ê –û–ö
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ models.py               # (34 —Å—Ç—Ä–æ–∫–∏) ‚úÖ –û–ö
    ‚îú‚îÄ‚îÄ contexts.py             # ‚úÖ –ü–ï–†–ï–ú–ï–©–ï–ù–û –∏–∑ models/
    ‚îú‚îÄ‚îÄ core/                   # –û—Å–Ω–æ–≤–Ω—ã–µ LangGraph –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ interfaces.py       # LangGraph –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
    ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py       # LangGraph –∏—Å–∫–ª—é—á–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ llm/                    # LLM —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ üö® –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py  
    ‚îÇ   ‚îú‚îÄ‚îÄ manager.py          # LLMManager (–∏–∑ factory.py)
    ‚îÇ   ‚îú‚îÄ‚îÄ providers.py        # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã LLM
    ‚îÇ   ‚îú‚îÄ‚îÄ token_tracker.py    # TokenManager (–∏–∑ handlers/)
    ‚îÇ   ‚îî‚îÄ‚îÄ config.py           # LLM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ workflow/               # Workflow —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ üö® –ö–†–ò–¢–ò–ß–ù–û
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ builder.py          # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ nodes/              # –£–∑–ª—ã workflow
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py         # –ë–∞–∑–æ–≤—ã–µ —É–∑–ª—ã
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent_node.py   # üî¥ _agent_node (CCN=24)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grading_node.py # üî¥ _grade_docs_node (CCN=20)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate_node.py# üî¥ _generate_node (CCN=13)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rewrite_node.py # üî¥ _rewrite_node (CCN=12)
    ‚îÇ   ‚îú‚îÄ‚îÄ edges/              # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ edges
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py         # –ë–∞–∑–æ–≤–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routing.py      # üî¥ _route_tools_edge (CCN=10)
    ‚îÇ   ‚îî‚îÄ‚îÄ state_manager.py    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
    ‚îú‚îÄ‚îÄ tools/                  # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã üö® –ù–£–ñ–ù–û –†–ê–ó–î–ï–õ–ò–¢–¨
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ registry/           # –†–µ–µ—Å—Ç—Ä—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main_registry.py    # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–µ—Å—Ç—Ä
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ centralized.py      # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ tools
    ‚îÇ   ‚îú‚îÄ‚îÄ vision/             # Vision tools üî¥ CCN=14
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_analyzer.py   # analyze_images —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers.py        # Vision –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py            # –£—Ç–∏–ª–∏—Ç—ã
    ‚îÇ   ‚îú‚îÄ‚îÄ voice/              # Voice tools üéØ –ù–û–í–ê–Ø –ö–ê–¢–ï–ì–û–†–ò–Ø
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice_tools.py      # –ì–æ–ª–æ—Å–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tts_manager.py      # Text-to-Speech —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stt_manager.py      # Speech-to-Text —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audio_utils.py      # –ê—É–¥–∏–æ —É—Ç–∏–ª–∏—Ç—ã
    ‚îÇ   ‚îú‚îÄ‚îÄ knowledge_base/     # KB tools  
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ retriever.py        # RAG retrieval
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ grading.py          # Document grading
    ‚îÇ   ‚îú‚îÄ‚îÄ web_search/         # Web search tools
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py  
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ search_tools.py     # Tavily –∏ –¥—Ä—É–≥–∏–µ
    ‚îÇ   ‚îú‚îÄ‚îÄ internal/           # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ tools
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth_tools.py       # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    ‚îÇ   ‚îî‚îÄ‚îÄ document/           # Document tools
    ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ       ‚îú‚îÄ‚îÄ processor.py        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ‚îÇ       ‚îî‚îÄ‚îÄ converters.py       # –ö–æ–Ω–≤–µ—Ä—Ç–æ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–æ–≤
    ‚îú‚îÄ‚îÄ factory/                # –§–∞–±—Ä–∏–∫–∏ ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û - –†–ê–ó–î–ï–õ–ï–ù–û
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ main_factory.py     # –ì–ª–∞–≤–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞ (210 —Å—Ç—Ä–æ–∫ ‚â§300) ‚úÖ –°–û–ó–î–ê–ù–û
    ‚îÇ   ‚îú‚îÄ‚îÄ component_factory.py # –§–∞–±—Ä–∏–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (238 —Å—Ç—Ä–æ–∫) ‚úÖ –°–û–ó–î–ê–ù–û
    ‚îÇ   ‚îú‚îÄ‚îÄ node_factory.py     # –§–∞–±—Ä–∏–∫–∞ —É–∑–ª–æ–≤ (234 —Å—Ç—Ä–æ–∫–∏) ‚úÖ –°–û–ó–î–ê–ù–û
    ‚îÇ   ‚îî‚îÄ‚îÄ llm_factory.py      # –§–∞–±—Ä–∏–∫–∞ LLM (187 —Å—Ç—Ä–æ–∫) ‚úÖ –°–û–ó–î–ê–ù–û
    ‚îú‚îÄ‚îÄ legacy_factory.py       # –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (60 —Å—Ç—Ä–æ–∫) ‚úÖ –°–û–ó–î–ê–ù–û
    ‚îú‚îÄ‚îÄ handlers/               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ‚úÖ –ü–ï–†–ï–ú–ï–©–ï–ù–û
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ history_handler.py  # ‚úÖ –û–ö
    ‚îÇ   ‚îú‚îÄ‚îÄ message_handler.py  # ‚úÖ –û–ö
    ‚îÇ   ‚îî‚îÄ‚îÄ token_handler.py    # ‚Üí llm/token_tracker.py
    ‚îî‚îÄ‚îÄ utils/                  # –£—Ç–∏–ª–∏—Ç—ã
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îú‚îÄ‚îÄ helpers.py          # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        ‚îú‚îÄ‚îÄ error_handlers.py   # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        ‚îî‚îÄ‚îÄ validators.py       # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
```

## üéØ SOLID –†–ï–®–ï–ù–ò–Ø (–î–ï–¢–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–ï)

### Single Responsibility Principle (SRP) - –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
**–ü—Ä–æ–±–ª–µ–º—ã:**
- `factory.py` (1007 —Å—Ç—Ä–æ–∫) - 8 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
- `tools.py` (714 —Å—Ç—Ä–æ–∫) - —Å–º–µ—à–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ —É–∑–ª—ã —Å –≤—ã—Å–æ–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é

**–†–µ—à–µ–Ω–∏—è:**
1. **LLM –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å** ‚Üí `llm/manager.py`, `llm/providers.py`
2. **Workflow —É–∑–ª—ã** ‚Üí `workflow/nodes/` (–ø–æ –æ–¥–Ω–æ–º—É —É–∑–ª—É –Ω–∞ —Ñ–∞–π–ª)
3. **Tools –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** ‚Üí `tools/{vision,voice,knowledge_base,web_search,internal}/`
4. **Factory —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** ‚Üí `factory/{main,component,node,llm}_factory.py`

### Open/Closed Principle (OCP) - –†–ê–°–®–ò–†–ï–ù–ò–Ø
**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ñ–µ—Å—Ç–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —É–∑–ª–∞—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–†–µ—à–µ–Ω–∏—è:**
1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** ‚Üí `core/interfaces.py`, `langgraph/core/interfaces.py`
2. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã** ‚Üí `llm/providers.py`, `tools/vision/providers.py`
3. **–ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã** ‚Üí `workflow/nodes/base.py`

### Dependency Inversion Principle (DIP) - –ê–ë–°–¢–†–ê–ö–¶–ò–ò
**–†–µ—à–µ–Ω–∏—è:**
1. **LLM –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏** - –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
2. **Node –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏** - –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —É–∑–ª–æ–≤
3. **Tool –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏** - –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

## üöÄ –ü–õ–ê–ù –í–´–ü–û–õ–ù–ï–ù–ò–Ø (–û–ë–ù–û–í–õ–ï–ù–ù–´–ô)

### –§–∞–∑–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ ‚úÖ
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –†–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã handlers, contexts –≤ langgraph/
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞–Ω core/config_mixin.py
- [ ] –°–æ–∑–¥–∞—Ç—å `core/interfaces.py` —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `core/exceptions.py`
- [ ] –í—Å—Ç—Ä–æ–∏—Ç—å `core/exceptions.py` –∏ `core/interfaces.py` –≤ —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º—É.

### –§–∞–∑–∞ 2: LLM —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ü–†–ò–û–†–ò–¢–ï–¢ 1)
- [x] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_create_llm_instance` (CCN: 12 ‚Üí ‚â§8)**
- [x] –ò–∑–≤–ª–µ—á—å LLMManager ‚Üí `llm/manager.py`
- [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å LLMManager
- [x] –°–æ–∑–¥–∞—Ç—å LLMProvider –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ ‚Üí `llm/providers.py`
- [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å LLMProvider –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- [x] –°–æ–∑–¥–∞—Ç—å TokenManager ‚Üí `llm/token_tracker.py`
- [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å TokenManager
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- [x] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_extract_token_data` (CCN: 15 ‚Üí ‚â§8)**

### –§–∞–∑–∞ 3: Workflow Nodes (–ü–†–ò–û–†–ò–¢–ï–¢ 1 - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–õ–û–ñ–ù–û–°–¢–¨)
- [x] **–ö–†–ò–¢–ò–ß–ù–û: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_agent_node` (CCN: 24 ‚Üí ‚â§8)**
- [x] **–ö–†–ò–¢–ò–ß–ù–û: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_grade_docs_node` (CCN: 20 ‚Üí ‚â§8)**
- [x] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_generate_node` (CCN: 13 ‚Üí ‚â§8)**
- [x] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_rewrite_node` (CCN: 12 ‚Üí ‚â§8)**
- [x] –°–æ–∑–¥–∞—Ç—å `workflow/nodes.py` —Å –±–∞–∑–æ–≤—ã–º–∏ —É–∑–ª–∞–º–∏
- [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å `workflow/nodes.py`
- [x] –†–∞–∑–¥–µ–ª–∏—Ç—å —É–∑–ª—ã –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 4: Vision Tools (–ü–†–ò–û–†–ò–¢–ï–¢ 2)
- [ ] **–°–æ–∑–¥–∞—Ç—å `tools/vision/image_analyzer.py`** (–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã)
- [ ] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `analyze_images` (CCN: 14 ‚Üí ‚â§8)**
- [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–µ—Ç–æ–¥—ã:
  - `_validate_inputs()` CCN < 3
  - `_analyze_via_urls()` CCN < 5  
  - `_analyze_via_binary()` CCN < 5
  - `_format_response()` CCN < 3
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å `tools/vision/image_analyzer.py`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 5: Workflow Edges ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `workflow/edges/routing.py` (–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã)
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `_route_tools_edge` (CCN: 10 ‚Üí 1)**
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `create_graph` (CCN: 17 ‚Üí 1)**
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `workflow/builder.py` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `workflow/state_manager.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –ü–æ–¥–∫–ª—é—á–∏—Ç—å `workflow/edges/routing.py`
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 6: Tools —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
- [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å `tools.py` (714 —Å—Ç—Ä–æ–∫ ‚Üí ‚â§600) (–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã)
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:
  - `tools/vision/`
  - `tools/voice/`
  - `tools/knowledge_base/`
  - `tools/web_search/`
  - `tools/internal/`
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å tools_registry.py
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 7: Factory —Ä–∞–∑–±–∏–µ–Ω–∏–µ (–ö–†–ò–¢–ò–ß–ù–û - —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞) ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: **–†–∞–∑–¥–µ–ª–∏—Ç—å `factory.py` (1007 —Å—Ç—Ä–æ–∫ ‚Üí 60 —Å—Ç—Ä–æ–∫ legacy + 4 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏)**
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `factory/main_factory.py` (210 —Å—Ç—Ä–æ–∫ ‚â§300 —Å—Ç—Ä–æ–∫)
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `factory/component_factory.py` (238 —Å—Ç—Ä–æ–∫)
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `factory/node_factory.py` (234 —Å—Ç—Ä–æ–∫–∏)
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –°–æ–∑–¥–∞—Ç—å `factory/llm_factory.py` (187 —Å—Ç—Ä–æ–∫)
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ —á–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç—ã
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –û–±–µ—Å–ø–µ—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ legacy_factory.py
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã –≤–æ –≤—Å–µ—Ö —Ñ–∞–±—Ä–∏–∫–∞—Ö
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: –í—Å–µ —Ñ–∞–π–ª—ã <600 —Å—Ç—Ä–æ–∫, main_factory.py <300 —Å—Ç—Ä–æ–∫
- [x] ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**: 94% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (1007 ‚Üí 60 —Å—Ç—Ä–æ–∫)

### –§–∞–∑–∞ 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö CCN ‚â§ 8
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤ ‚â§ 600 —Å—Ç—Ä–æ–∫
- [ ] Codacy –∞–Ω–∞–ª–∏–∑ ‚â• 90/100
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–∑–ª–æ–≤

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –ú–ï–¢–†–ò–ö–ò (–û–ë–ù–û–í–õ–ï–ù–ù–´–ï)

**–î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- **–§–∞–π–ª—ã**: 15 —Ñ–∞–π–ª–æ–≤ –≤ agent_runner/
- **CCN –Ω–∞—Ä—É—à–µ–Ω–∏—è**: 9 —Ñ—É–Ω–∫—Ü–∏–π —Å CCN > 8
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è**: 2 (CCN=24, CCN=20)
- **Largest files**: factory.py (1007), tools.py (714)
- **Codacy Grade**: 85/100 (B)
- **Issues**: 292 –ø—Ä–æ–±–ª–µ–º—ã (12%)
- **Duplication**: 18%
- **Test Coverage**: 0%

**–¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï (–ü–æ—Å–ª–µ –§–∞–∑—ã 7):**
- **–§–∞–π–ª—ã**: 23 —Ñ–∞–π–ª–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–æ +8 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–±—Ä–∏–∫)
- **Factory —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: ‚úÖ 1007 ‚Üí 60 —Å—Ç—Ä–æ–∫ (94% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ) + 4 —Ñ–∞–±—Ä–∏–∫–∏
- **SOLID —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: ‚úÖ 100% –≤ factory/ –º–æ–¥—É–ª—è—Ö
- **Largest factory file**: ‚úÖ 238 —Å—Ç—Ä–æ–∫ (ComponentFactory) < 600
- **Main factory**: ‚úÖ 210 —Å—Ç—Ä–æ–∫ < 300 (—Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞)
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ legacy_factory.py
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: ‚úÖ 100%

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–ª—å (–ü–æ—Å–ª–µ –≤—Å–µ—Ö —Ñ–∞–∑):**
- **–§–∞–π–ª—ã**: ~35 —Ñ–∞–π–ª–æ–≤ (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏)
- **CCN –Ω–∞—Ä—É—à–µ–Ω–∏—è**: 0 (–≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚â§ 8)
- **Largest file**: ‚â§400 —Å—Ç—Ä–æ–∫
- **Codacy Grade**: ‚â•90/100 (A)
- **Issues**: <5% 
- **Duplication**: <10%
- **Test Coverage**: ‚â•60%
- **SOLID —Å–æ–±–ª—é–¥–µ–Ω–∏–µ**: 100%

## üîß –ü–†–ò–ù–¶–ò–ü–´ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê (–î–û–ü–û–õ–ù–ï–ù–ù–´–ï)

1. **–ù–µ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥** - –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–ª—å–∑–æ–π
2. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å** - –ø–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö API
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
5. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
6. **Codacy-driven** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏
7. **–†–∞–∑–º–µ—Ä-–∫–æ–Ω—Ç—Ä–æ–ª—å** - –∂–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç 600 —Å—Ç—Ä–æ–∫ –Ω–∞ —Ñ–∞–π–ª


**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```python
# –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 5 –º–µ—Ç–æ–¥–æ–≤:
async def _agent_node(self, state, config) -> dict:          # CCN ‚â§ 3
async def _invoke_agent_llm(self, messages, config) -> AIMessage:  # CCN ‚â§ 4  
async def _recover_invalid_tool_calls(self, response) -> list:     # CCN ‚â§ 6
async def _handle_agent_error(self, error, context) -> AIMessage: # CCN ‚â§ 3
async def _process_agent_response(self, response, state) -> dict:  # CCN ‚â§ 4
```

### üî¥ –ö–†–ò–¢–ò–ß–ù–û: `_grade_docs_node` (CCN=20) - factory.py:362  
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö + –æ—Ü–µ–Ω–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ + —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è KB IDs
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –∏ —É—Å–ª–æ–≤–∏–π

**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```python
# –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 4 –º–µ—Ç–æ–¥–∞:
async def _grade_docs_node(self, state, config) -> dict:           # CCN ‚â§ 3
async def _extract_grading_context(self, state) -> dict:           # CCN ‚â§ 5
async def _evaluate_documents(self, docs, question, config) -> str: # CCN ‚â§ 6  
async def _format_grading_decision(self, decision, docs) -> dict:   # CCN ‚â§ 3
```

### üü° –í–´–°–û–ö–ò–ô: `create_graph` (CCN=17) - factory.py:864
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É–∑–ª–æ–≤ + –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è edges
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É—Å–ª–æ–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```python
# –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 3 –º–µ—Ç–æ–¥–∞ + –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª:
# workflow/builder.py:
def create_graph(self, config) -> StateGraph:                     # CCN ‚â§ 4
def _configure_nodes(self, graph) -> None:                        # CCN ‚â§ 5  
def _configure_edges(self, graph) -> None:                        # CCN ‚â§ 6
```

### üü° –í–´–°–û–ö–ò–ô: `analyze_images` (CCN=14) - tools.py:433
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è + URL/binary –æ–±—Ä–∞–±–æ—Ç–∫–∞ + multiple providers + —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```python
# tools/vision/image_analyzer.py:
async def analyze_images(urls, prompt, state) -> str:              # CCN ‚â§ 3
async def _validate_image_inputs(urls, prompt) -> bool:            # CCN ‚â§ 2
async def _analyze_via_urls(urls, prompt) -> str:                  # CCN ‚â§ 4
async def _analyze_via_binary(image_data, prompt) -> str:          # CCN ‚â§ 4  
async def _format_analysis_response(result) -> str:                # CCN ‚â§ 2
```

## üéØ –ö–û–ù–ö–†–ï–¢–ù–´–ï –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1-2 –¥–Ω—è)
1. **–°–æ–∑–¥–∞—Ç—å core/interfaces.py:**
   ```python
   # –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, —É–∑–ª–æ–≤, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
   class LLMProvider(Protocol)
   class WorkflowNode(Protocol)  
   class ToolProvider(Protocol)
   ```

2. **–°–æ–∑–¥–∞—Ç—å langgraph/core/exceptions.py:**
   ```python
   # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
   class LLMError(Exception)
   class NodeExecutionError(Exception)
   class ToolExecutionError(Exception)
   ```

3. **–°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
   ```bash
   mkdir -p app/agent_runner/langgraph/{llm,workflow/{nodes,edges},tools/{vision,knowledge_base},factory}
   ```

### –≠–¢–ê–ü 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ _agent_node (CCN=24) (2-3 –¥–Ω—è)
1. **–°–æ–∑–¥–∞—Ç—å workflow/nodes/agent_node.py:**
   - –ò–∑–≤–ª–µ—á—å –ª–æ–≥–∏–∫—É –∏–∑ factory.py:254-350
   - –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 5 –º–µ—Ç–æ–¥–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É
   - –ü–æ–∫—Ä—ã—Ç—å unit —Ç–µ—Å—Ç–∞–º–∏ –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥

2. **–°–æ–∑–¥–∞—Ç—å workflow/nodes/base.py:**  
   - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤
   - –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã: error handling, logging, token tracking

3. **–û–±–Ω–æ–≤–∏—Ç—å factory.py:**
   - –ó–∞–º–µ–Ω–∏—Ç—å _agent_node –Ω–∞ –≤—ã–∑–æ–≤ AgentNode.execute()
   - –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥

### –≠–¢–ê–ü 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ _grade_docs_node (CCN=20) (2 –¥–Ω—è)
1. **–°–æ–∑–¥–∞—Ç—å workflow/nodes/grading_node.py:**
   - –ò–∑–≤–ª–µ—á—å –ª–æ–≥–∏–∫—É –∏–∑ factory.py:362-450  
   - –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 4 –º–µ—Ç–æ–¥–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ —Ç–µ—Å—Ç—ã

### –≠–¢–ê–ü 4: Vision Tools —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (2 –¥–Ω—è)
1. **–°–æ–∑–¥–∞—Ç—å tools/vision/image_analyzer.py:**
   - –ò–∑–≤–ª–µ—á—å analyze_images –∏–∑ tools.py:433-500
   - –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 5 –º–µ—Ç–æ–¥–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö API

2. **–°–æ–∑–¥–∞—Ç—å tools/vision/providers.py:**
   - OpenAI Vision Provider
   - Google Vision Provider  
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º

### –≠–¢–ê–ü 4.5: Voice Tools –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. **–°–æ–∑–¥–∞—Ç—å tools/voice/voice_tools.py:**
   - –ò–∑–≤–ª–µ—á—å –≥–æ–ª–æ—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–µ—Å—Ç—Ä–∞
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å voice_v2 —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - TTS/STT tool wrapper'—ã

2. **–°–æ–∑–¥–∞—Ç—å tools/voice/tts_manager.py & stt_manager.py:**
   - –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –¥–ª—è Text-to-Speech –∏ Speech-to-Text
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VoiceServiceOrchestrator
   - –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã: OpenAI, Google, Yandex

3. **–°–æ–∑–¥–∞—Ç—å tools/voice/audio_utils.py:**
   - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö

### –≠–¢–ê–ü 5: Factory —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (3-4 –¥–Ω—è)
1. **–°–æ–∑–¥–∞—Ç—å factory/main_factory.py (‚â§300 —Å—Ç—Ä–æ–∫):**
   - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∞
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–∞–±—Ä–∏–∫–∞–º–∏

2. **–°–æ–∑–¥–∞—Ç—å factory/node_factory.py:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É–∑–ª–æ–≤
   - –ò–∑–≤–ª–µ—á—å –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ factory.py

3. **–°–æ–∑–¥–∞—Ç—å factory/llm_factory.py:**
   - LLM —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –ò–∑–≤–ª–µ—á—å _create_llm_instance

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ë–´–°–¢–†–û–ì–û –°–¢–ê–†–¢–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```bash
# –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
uv run python -c "import lizard; [print(f'{f.name}:{f.start_line} CCN={f.cyclomatic_complexity}') for f in lizard.analyze_file('app/agent_runner/langgraph/factory.py').function_list if f.cyclomatic_complexity > 8]"

# –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤  
find app/agent_runner -name "*.py" -exec wc -l {} + | sort -nr

# Codacy –∞–Ω–∞–ª–∏–∑
uv run python -m codacy_cli analyze app/agent_runner/ --tool pylint
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p app/agent_runner/langgraph/{core,llm,workflow/{nodes,edges},tools/{vision,voice,knowledge_base,web_search,internal},factory,utils}

# –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ __init__.py
find app/agent_runner/langgraph -type d -exec touch {}/__init__.py \;
```

## üìä –í–ê–õ–ò–î–ê–¶–ò–Ø –ò –ú–ï–¢–†–ò–ö–ò

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞:

```bash
# 1. CCN –≤–∞–ª–∏–¥–∞—Ü–∏—è (–≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚â§ 8)
uv run python -c "
import lizard
files = ['app/agent_runner/langgraph/factory.py', 'app/agent_runner/langgraph/tools/tools.py']
violations = []
for file in files:
    result = lizard.analyze_file(file)
    violations.extend([f'{f.name}:{f.start_line} CCN={f.cyclomatic_complexity}' 
                      for f in result.function_list if f.cyclomatic_complexity > 8])
print(f'CCN violations: {len(violations)}')
[print(f'  {v}') for v in violations]
print('‚úÖ PASSED' if not violations else '‚ùå FAILED')
"

# 2. –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (‚â§ 600 —Å—Ç—Ä–æ–∫)
uv run python -c "
import os
violations = []
for root, dirs, files in os.walk('app/agent_runner'):
    for file in files:
        if file.endswith('.py'):
            path = os.path.join(root, file)
            lines = sum(1 for line in open(path))
            if lines > 600:
                violations.append(f'{path}: {lines} lines')
print(f'Size violations: {len(violations)}')
[print(f'  {v}') for v in violations]
print('‚úÖ PASSED' if not violations else '‚ùå FAILED')
"

# 3. Import –≤–∞–ª–∏–¥–∞—Ü–∏—è
python -c "
try:
    from app.agent_runner.langgraph.factory import create_agent_app
    from app.agent_runner.agent_runner import AgentRunner
    print('‚úÖ IMPORTS OK')
except Exception as e:
    print(f'‚ùå IMPORT ERROR: {e}')
"

# 4. –¢–µ—Å—Ç—ã (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è)
pytest app/tests/agent_runner/ -v --cov=app.agent_runner --cov-report=term-missing
```

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ —ç—Ç–∞–ø–∞–º:

| –≠—Ç–∞–ø | –§–∞–π–ª–æ–≤ | Max CCN | Max —Ä–∞–∑–º–µ—Ä | –¢–µ—Å—Ç –ø–æ–∫—Ä—ã—Ç–∏–µ |
|------|--------|---------|------------|---------------|
| –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 2 | 18 | ‚â§ 12 | ‚â§ 800 | ‚â• 30% |
| –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 3 | 22 | ‚â§ 10 | ‚â§ 700 | ‚â• 50% |  
| –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 4 | 26 | ‚â§ 8 | ‚â§ 600 | ‚â• 70% |
| –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 5 | 32 | ‚â§ 8 | ‚â§ 400 | ‚â• 80% |

### Codacy —Ü–µ–ª–∏:
- **–¢–µ–∫—É—â–µ–µ**: Grade 85/100 (B), Issues 12%
- **–¶–µ–ª—å –≠—Ç–∞–ø–∞ 3**: Grade ‚â• 88/100, Issues ‚â§ 8%  
- **–§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–ª—å**: Grade ‚â• 92/100 (A), Issues ‚â§ 5%
