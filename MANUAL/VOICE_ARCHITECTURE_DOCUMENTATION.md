# üé§ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Voice Services - PlatformAI-HUB

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
3. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
4. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∞–≥–µ–Ω—Ç–∞)
5. [–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤](#–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã-–≥–æ–ª–æ—Å–æ–≤—ã—Ö-—Å–µ—Ä–≤–∏—Å–æ–≤)
6. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–Ω–∞–º–µ—Ä–µ–Ω–∏–π)
7. [Fallback —Å–∏—Å—Ç–µ–º–∞](#fallback-—Å–∏—Å—Ç–µ–º–∞)
8. [–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
9. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º)
10. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π)
11. [Troubleshooting](#troubleshooting)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram Bot  ‚îÇ    ‚îÇ   Voice         ‚îÇ    ‚îÇ   Agent         ‚îÇ
‚îÇ   Integration   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Orchestrator  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Runner        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Audio Input   ‚îÇ    ‚îÇ   STT/TTS       ‚îÇ    ‚îÇ   Text          ‚îÇ
‚îÇ   (Voice Msgs)  ‚îÇ    ‚îÇ   Services      ‚îÇ    ‚îÇ   Processing    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MinIO         ‚îÇ    ‚îÇ   Redis Cache   ‚îÇ    ‚îÇ   Voice         ‚îÇ
‚îÇ   File Storage  ‚îÇ    ‚îÇ   & Rate Limit  ‚îÇ    ‚îÇ   Response      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–ú–Ω–æ–≥–æ–ø—Ä–æ–≤–∞–π–¥–µ—Ä–Ω–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI, Google, Yandex
- **Fallback –ª–æ–≥–∏–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è STT —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ rate limiting
- **–ù–∞–º–µ—Ä–µ–Ω–∏—è**: –î–µ—Ç–µ–∫—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π –≤ —Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: MinIO –¥–ª—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. VoiceServiceOrchestrator
**–ü—É—Ç—å**: `app/services/voice/voice_orchestrator.py`

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ STT/TTS
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ fallback –ª–æ–≥–∏–∫–æ–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Rate limiting

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
```python
async def process_voice_message()      # STT –æ–±—Ä–∞–±–æ—Ç–∫–∞
async def synthesize_response()        # TTS —Å–∏–Ω—Ç–µ–∑
async def initialize_voice_services_for_agent()  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞
```

### 2. STT (Speech-to-Text) –°–µ—Ä–≤–∏—Å—ã
**–ü—É—Ç–∏**: 
- `app/services/voice/stt/openai_stt.py` - OpenAI Whisper
- `app/services/voice/stt/google_stt.py` - Google Cloud Speech
- `app/services/voice/stt/yandex_stt.py` - Yandex SpeechKit

**–§—É–Ω–∫—Ü–∏–∏**: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –≤ —Ç–µ–∫—Å—Ç

### 3. TTS (Text-to-Speech) –°–µ—Ä–≤–∏—Å—ã
**–ü—É—Ç–∏**:
- `app/services/voice/tts/openai_tts.py` - OpenAI TTS
- `app/services/voice/tts/google_tts.py` - Google Cloud TTS
- `app/services/voice/tts/yandex_tts.py` - Yandex SpeechKit

**–§—É–Ω–∫—Ü–∏–∏**: –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞

### 4. MinioFileManager
**–ü—É—Ç—å**: `app/services/voice/minio_manager.py`

**–§—É–Ω–∫—Ü–∏–∏**: 
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è presigned URLs
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ lifecycle —Ñ–∞–π–ª–æ–≤

### 5. Telegram Integration
**–ü—É—Ç—å**: `app/integrations/telegram/telegram_bot.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- Fallback –Ω–∞ —Ç–µ–∫—Å—Ç –ø—Ä–∏ VOICE_MESSAGES_FORBIDDEN

---

## üìä –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### STT –ü–æ—Ç–æ–∫ (–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –¢–µ–∫—Å—Ç)
```
–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        ‚Üì
Telegram Bot –ø–æ–ª—É—á–∞–µ—Ç –∞—É–¥–∏–æ
        ‚Üì
–ó–∞–≥—Ä—É–∑–∫–∞ –≤ MinIO
        ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ Redis (–ø–æ —Ö—ç—à—É —Ñ–∞–π–ª–∞)
        ‚Üì
STT –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Å fallback –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º)
        ‚Üì
–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∞–≥–µ–Ω—Ç—É
        ‚Üì
–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥–µ–Ω—Ç–æ–º
        ‚Üì
–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞
```

### TTS –ü–æ—Ç–æ–∫ (–¢–µ–∫—Å—Ç ‚Üí –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
```
–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞
        ‚Üì
–î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è (keywords)
        ‚Üì
TTS —Å–∏–Ω—Ç–µ–∑ (—Å fallback –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º)
        ‚Üì
–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ –≤ MinIO
        ‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ presigned URL
        ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        ‚Üì
Fallback –Ω–∞ —Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞

–ì–æ–ª–æ—Å–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ –ø—É—Ç–∏: **`config.simple.settings.voice_settings`**

```json
{
  "config": {
    "simple": {
      "settings": {
        "voice_settings": {
          // –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
          "enabled": true,                    // –í–∫–ª—é—á–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
          "intent_detection_mode": "keywords", // "keywords", "always", "disabled"
          "auto_stt": true,                   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è STT –æ–±—Ä–∞–±–æ—Ç–∫–∞
          "auto_tts_on_keywords": true,       // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è TTS –ø—Ä–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è—Ö
          
          // –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø
          "max_file_size_mb": 25,             // –ú–∞–∫—Å —Ä–∞–∑–º–µ—Ä –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
          "rate_limit_per_minute": 15,        // –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
          
          // –ö–≠–®–ò–†–û–í–ê–ù–ò–ï
          "cache_enabled": true,              // –í–∫–ª—é—á–∏—Ç—å –∫—ç—à STT —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          "cache_ttl_hours": 24,              // TTL –∫—ç—à–∞ –≤ —á–∞—Å–∞—Ö
          
          // –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê –î–õ–Ø –ù–ê–ú–ï–†–ï–ù–ò–ô
          "intent_keywords": [
            "–≥–æ–ª–æ—Å",
            "—Å–∫–∞–∂–∏", 
            "–ø—Ä–æ–∏–∑–Ω–µ—Å–∏",
            "–æ–∑–≤—É—á—å",
            "—Ä–∞—Å—Å–∫–∞–∂–∏ –≥–æ–ª–æ—Å–æ–º",
            "–æ—Ç–≤–µ—Ç—å –≥–æ–ª–æ—Å–æ–º",
            "–ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–ª—É—Ö"
          ],
          
          // –ü–†–û–í–ê–ô–î–ï–†–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)
          "providers": [
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (—Å–º. –Ω–∏–∂–µ)
          ]
        }
      }
    }
  }
}
```

### –ü–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `enabled` | boolean | –î–∞ | –í–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ |
| `intent_detection_mode` | string | –î–∞ | –†–µ–∂–∏–º –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π: `"keywords"`, `"always"`, `"disabled"` |
| `intent_keywords` | string[] | –ù–µ—Ç | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π (–ø—Ä–∏ mode="keywords") |
| `auto_stt` | boolean | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true) |
| `auto_tts_on_keywords` | boolean | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∑–≤—É—á–∏–≤–∞—Ç—å –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true) |
| `max_file_size_mb` | number | –ù–µ—Ç | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ –≤ –ú–ë (1-100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 25) |
| `cache_enabled` | boolean | –ù–µ—Ç | –í–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ STT —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true) |
| `cache_ttl_hours` | number | –ù–µ—Ç | TTL –∫—ç—à–∞ –≤ —á–∞—Å–∞—Ö (1-168, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24) |
| `rate_limit_per_minute` | number | –ù–µ—Ç | –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (1-100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10) |
| `providers` | object[] | –î–∞ | –°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |

---

## üåê –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
```json
{
  "provider": "openai|google|yandex",
  "priority": 1,                      // –ß–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
  "fallback_enabled": true,           // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ fallback
  "stt_config": { /* STT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */ },
  "tts_config": { /* TTS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */ },
  "custom_settings": { /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */ }
}
```

### 1. OpenAI –ü—Ä–æ–≤–∞–π–¥–µ—Ä

#### STT –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Whisper)
```json
{
  "stt_config": {
    "enabled": true,
    "model": "whisper-1",               // –ú–æ–¥–µ–ª—å Whisper
    "language": "ru",                   // –Ø–∑—ã–∫ (ISO 639-1)
    "max_duration": 120,                // –ú–∞–∫—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    "enable_automatic_punctuation": true,
    "custom_params": {
      "model": "whisper-1",
      "language": "ru"
    }
  }
}
```

#### TTS –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```json
{
  "tts_config": {
    "enabled": true,
    "model": "tts-1",                   // tts-1 –∏–ª–∏ tts-1-hd
    "voice": "nova",                    // alloy, echo, fable, onyx, nova, shimmer
    "language": "ru",
    "speed": 1.0,                       // 0.25-4.0
    "audio_format": "mp3",              // mp3, opus, aac, flac
    "sample_rate": 22050,
    "custom_params": {
      "model": "tts-1",
      "voice": "nova",
      "speed": 1.0
    }
  }
}
```

### 2. Google Cloud –ü—Ä–æ–≤–∞–π–¥–µ—Ä

#### STT –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Cloud Speech)
```json
{
  "stt_config": {
    "enabled": true,
    "model": "latest_short",            // latest_short, latest_long, command_and_search
    "language": "ru-RU",                // BCP-47 language tag
    "max_duration": 60,
    "sample_rate_hertz": 16000,         // 8000, 16000, 22050, 44100, 48000
    "enable_automatic_punctuation": true,
    "custom_params": {
      "model": "latest_short",
      "languageCode": "ru-RU"
    }
  }
}
```

#### TTS –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```json
{
  "tts_config": {
    "enabled": true,
    "model": "wavenet",                 // standard, wavenet, neural2
    "voice": "ru-RU-Wavenet-A",         // –ì–æ–ª–æ—Å –¥–ª—è —è–∑—ã–∫–∞
    "language": "ru-RU",
    "speed": 1.0,
    "audio_format": "mp3",
    "sample_rate": 22050,
    "custom_params": {
      "voiceName": "ru-RU-Wavenet-A",
      "audioEncoding": "MP3"
    }
  }
}
```

### 3. Yandex SpeechKit –ü—Ä–æ–≤–∞–π–¥–µ—Ä

#### STT –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```json
{
  "stt_config": {
    "enabled": true,
    "model": "general",                 // general, general:rc, general:deprecated
    "language": "ru-RU",
    "max_duration": 60,
    "sample_rate_hertz": 16000,
    "enable_automatic_punctuation": true,
    "enable_profanity_filter": false,
    "custom_params": {
      "sampleRateHertz": 16000,
      "languageCode": "ru-RU",
      "model": "general"
    }
  }
}
```

#### TTS –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```json
{
  "tts_config": {
    "enabled": true,
    "model": "jane",                    // jane, oksana, alyss, omazh
    "voice": "jane",
    "language": "ru-RU",
    "speed": 1.0,
    "pitch": 0.0,                       // -20.0 –¥–æ 20.0
    "volume_gain_db": 0.0,
    "audio_format": "mp3",
    "sample_rate": 22050,
    "custom_params": {
      "speed": 1.0
    }
  }
}
```

---

## üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π

### –†–µ–∂–∏–º—ã –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–π

| –†–µ–∂–∏–º | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-------|----------|---------------|
| `"keywords"` | –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ —Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ |
| `"always"` | –í—Å–µ–≥–¥–∞ –æ–∑–≤—É—á–∏–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã | –î–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ–ª–æ—Å–æ–≤—ã—Ö –±–æ—Ç–æ–≤ |
| `"disabled"` | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–∑–≤—É—á–∏–≤–∞—Ç—å | –¢–æ–ª—å–∫–æ STT, –±–µ–∑ TTS |

### –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```json
[
  "–≥–æ–ª–æ—Å",
  "—Å–∫–∞–∂–∏", 
  "–ø—Ä–æ–∏–∑–Ω–µ—Å–∏",
  "–æ–∑–≤—É—á—å",
  "—Ä–∞—Å—Å–∫–∞–∂–∏ –≥–æ–ª–æ—Å–æ–º",
  "–æ—Ç–≤–µ—Ç—å –≥–æ–ª–æ—Å–æ–º", 
  "–ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–ª—É—Ö"
]
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤:
```json
{
  "intent_keywords": [
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
    "–≥–æ–ª–æ—Å", "—Å–∫–∞–∂–∏", "–ø—Ä–æ–∏–∑–Ω–µ—Å–∏", "–æ–∑–≤—É—á—å",
    
    // –î–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –±–æ—Ç–∞
    "–¥–∏–∞–≥–Ω–æ–∑ –≥–æ–ª–æ—Å–æ–º", "—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–ª—É—Ö",
    
    // –î–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞
    "–æ–±—ä—è—Å–Ω–∏ –≥–æ–ª–æ—Å–æ–º", "—Ä–∞—Å—Å–∫–∞–∂–∏ —É—Ä–æ–∫",
    
    // –î–ª—è —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞
    "—Å–ø–æ–π", "—Ä–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç", "–æ–∑–≤—É—á—å –∏—Å—Ç–æ—Ä–∏—é"
  ]
}
```

---

## üîÑ Fallback —Å–∏—Å—Ç–µ–º–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:

1. **Priority 1** (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π) - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
2. **Priority 2** - –ø–µ—Ä–≤—ã–π fallback
3. **Priority 3** - –≤—Ç–æ—Ä–æ–π fallback
4. –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

```json
{
  "providers": [
    {
      "provider": "yandex",      // –õ—É—á—à–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
      "priority": 1,
      "fallback_enabled": true
    },
    {
      "provider": "openai",      // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π fallback
      "priority": 2, 
      "fallback_enabled": true
    },
    {
      "provider": "google",      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π fallback
      "priority": 3,
      "fallback_enabled": true
    }
  ]
}
```

### –õ–æ–≥–∏–∫–∞ fallback
1. –ü–æ–ø—ã—Ç–∫–∞ —Å **Priority 1** –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ **Priority 2**
3. –ü—Ä–∏ –æ—à–∏–±–∫–µ - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ **Priority 3**
4. –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–µ—É–¥–∞—á–Ω—ã - –≤–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏

---

## ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### STT –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ö–ª—é—á –∫—ç—à–∞**: MD5 —Ö—ç—à –æ—Ç (—Ä–∞–∑–º–µ—Ä_—Ñ–∞–π–ª–∞ + mime_type + –ø—Ä–æ–≤–∞–π–¥–µ—Ä)
- **TTL**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `cache_ttl_hours` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24 —á–∞—Å–∞)
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: Redis

### Rate Limiting
- **–õ–∏–º–∏—Ç**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `rate_limit_per_minute`
- **–ü–µ—Ä–∏–æ–¥**: 60 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ù–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –∞–≥–µ–Ω—Ç–∞
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: Redis

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **Lazy loading**: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
- **Credential –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–æ–ø—É—Å–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –±–µ–∑ credentials
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –í—Å–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ

---

## üíª –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### –î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

#### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è UI —Ñ–æ—Ä–º—ã
```typescript
interface VoiceSettings {
  enabled: boolean;
  intent_detection_mode: 'keywords' | 'always' | 'disabled';
  intent_keywords: string[];
  auto_stt: boolean;
  auto_tts_on_keywords: boolean;
  max_file_size_mb: number;         // 1-100
  cache_enabled: boolean;
  cache_ttl_hours: number;          // 1-168
  rate_limit_per_minute: number;    // 1-100
  providers: VoiceProvider[];
}

interface VoiceProvider {
  provider: 'openai' | 'google' | 'yandex';
  priority: number;                 // 1-10
  fallback_enabled: boolean;
  stt_config?: STTConfig;
  tts_config?: TTSConfig;
  custom_settings?: Record<string, any>;
}
```

#### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
```typescript
function validateVoiceSettings(settings: VoiceSettings): string[] {
  const errors: string[] = [];
  
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  if (settings.max_file_size_mb < 1 || settings.max_file_size_mb > 100) {
    errors.push('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 100 –ú–ë');
  }
  
  if (settings.cache_ttl_hours < 1 || settings.cache_ttl_hours > 168) {
    errors.push('TTL –∫—ç—à–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 168 —á–∞—Å–æ–≤');
  }
  
  if (settings.rate_limit_per_minute < 1 || settings.rate_limit_per_minute > 100) {
    errors.push('Rate limit –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É');
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
  if (!settings.providers || settings.providers.length === 0) {
    errors.push('–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä');
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
  const priorities = settings.providers.map(p => p.priority);
  if (new Set(priorities).size !== priorities.length) {
    errors.push('–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏');
  }
  
  return errors;
}
```

#### 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç React –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
```tsx
interface ProviderConfigProps {
  provider: VoiceProvider;
  onChange: (provider: VoiceProvider) => void;
}

function ProviderConfig({ provider, onChange }: ProviderConfigProps) {
  const updateSTTConfig = (config: Partial<STTConfig>) => {
    onChange({
      ...provider,
      stt_config: { ...provider.stt_config, ...config }
    });
  };
  
  return (
    <div className="provider-config">
      <h3>{provider.provider.toUpperCase()} –ü—Ä–æ–≤–∞–π–¥–µ—Ä</h3>
      
      <label>
        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
        <input 
          type="number" 
          min="1" 
          max="10"
          value={provider.priority}
          onChange={e => onChange({
            ...provider, 
            priority: parseInt(e.target.value)
          })}
        />
      </label>
      
      {/* STT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}
      {provider.stt_config && (
        <div className="stt-config">
          <h4>STT –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
          
          <label>
            –ú–æ–¥–µ–ª—å:
            <select 
              value={provider.stt_config.model}
              onChange={e => updateSTTConfig({ model: e.target.value })}
            >
              {getSTTModelsForProvider(provider.provider).map(model => (
                <option key={model} value={model}>{model}</option>
              ))}
            </select>
          </label>
          
          <label>
            –Ø–∑—ã–∫:
            <input 
              value={provider.stt_config.language}
              onChange={e => updateSTTConfig({ language: e.target.value })}
            />
          </label>
        </div>
      )}
    </div>
  );
}
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ OpenAI)
```json
{
  "config": {
    "simple": {
      "settings": {
        "voice_settings": {
          "enabled": true,
          "intent_detection_mode": "keywords",
          "intent_keywords": ["–≥–æ–ª–æ—Å", "—Å–∫–∞–∂–∏", "–ø—Ä–æ–∏–∑–Ω–µ—Å–∏"],
          "providers": [
            {
              "provider": "openai",
              "priority": 1,
              "fallback_enabled": false,
              "stt_config": {
                "enabled": true,
                "model": "whisper-1",
                "language": "ru"
              },
              "tts_config": {
                "enabled": true,
                "model": "tts-1",
                "voice": "nova"
              }
            }
          ]
        }
      }
    }
  }
}
```

### 2. –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —Ç—Ä–µ–º—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
```json
{
  "config": {
    "simple": {
      "settings": {
        "voice_settings": {
          "enabled": true,
          "intent_detection_mode": "keywords",
          "intent_keywords": [
            "–≥–æ–ª–æ—Å", "—Å–∫–∞–∂–∏", "–ø—Ä–æ–∏–∑–Ω–µ—Å–∏", "–æ–∑–≤—É—á—å",
            "—Ä–∞—Å—Å–∫–∞–∂–∏ –≥–æ–ª–æ—Å–æ–º", "–æ—Ç–≤–µ—Ç—å –≥–æ–ª–æ—Å–æ–º", "–ø—Ä–æ—á–∏—Ç–∞–π –≤—Å–ª—É—Ö"
          ],
          "auto_stt": true,
          "auto_tts_on_keywords": true,
          "max_file_size_mb": 25,
          "cache_enabled": true,
          "cache_ttl_hours": 24,
          "rate_limit_per_minute": 15,
          
          "providers": [
            {
              "provider": "yandex",
              "priority": 1,
              "fallback_enabled": true,
              "stt_config": {
                "enabled": true,
                "model": "general",
                "language": "ru-RU",
                "max_duration": 60,
                "enable_automatic_punctuation": true
              },
              "tts_config": {
                "enabled": true,
                "model": "jane",
                "voice": "jane",
                "language": "ru-RU",
                "speed": 1.0,
                "audio_format": "mp3"
              },
              "custom_settings": {
                "description": "–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞",
                "priority_reason": "–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–π —Ä–µ—á–∏"
              }
            },
            {
              "provider": "openai",
              "priority": 2,
              "fallback_enabled": true,
              "stt_config": {
                "enabled": true,
                "model": "whisper-1",
                "language": "ru",
                "max_duration": 120
              },
              "tts_config": {
                "enabled": true,
                "model": "tts-1",
                "voice": "nova",
                "speed": 1.0,
                "audio_format": "mp3"
              },
              "custom_settings": {
                "description": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä",
                "priority_reason": "–ù–∞–¥–µ–∂–Ω—ã–π —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç"
              }
            },
            {
              "provider": "google",
              "priority": 3,
              "fallback_enabled": true,
              "stt_config": {
                "enabled": true,
                "model": "latest_short",
                "language": "ru-RU",
                "max_duration": 60,
                "sample_rate_hertz": 16000
              },
              "tts_config": {
                "enabled": true,
                "model": "wavenet",
                "voice": "ru-RU-Wavenet-A",
                "language": "ru-RU",
                "audio_format": "mp3"
              },
              "custom_settings": {
                "description": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π fallback",
                "priority_reason": "–†–µ–∑–µ—Ä–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞–µ–≤"
              }
            }
          ]
        }
      }
    }
  }
}
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è STT (–±–µ–∑ TTS)
```json
{
  "config": {
    "simple": {
      "settings": {
        "voice_settings": {
          "enabled": true,
          "intent_detection_mode": "disabled",
          "auto_stt": true,
          "auto_tts_on_keywords": false,
          
          "providers": [
            {
              "provider": "openai",
              "priority": 1,
              "stt_config": {
                "enabled": true,
                "model": "whisper-1",
                "language": "ru"
              }
              // –ë–µ–∑ tts_config - —Ç–æ–ª—å–∫–æ STT
            }
          ]
        }
      }
    }
  }
}
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–≥–æ –±–æ—Ç–∞
```json
{
  "config": {
    "simple": {
      "settings": {
        "voice_settings": {
          "enabled": true,
          "intent_detection_mode": "keywords",
          "intent_keywords": [
            // –†—É—Å—Å–∫–∏–µ
            "–≥–æ–ª–æ—Å", "—Å–∫–∞–∂–∏", "–ø—Ä–æ–∏–∑–Ω–µ—Å–∏",
            // –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ  
            "voice", "say", "speak",
            // –î—Ä—É–≥–∏–µ —è–∑—ã–∫–∏...
          ],
          
          "providers": [
            {
              "provider": "openai",
              "priority": 1,
              "stt_config": {
                "enabled": true,
                "model": "whisper-1",
                "language": "auto"         // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
              },
              "tts_config": {
                "enabled": true,
                "model": "tts-1",
                "voice": "nova"
              }
            }
          ]
        }
      }
    }
  }
}
```

---

## üîß Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. "Voice services not initialized"
**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç credentials –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `OPENAI_API_KEY`, `GOOGLE_APPLICATION_CREDENTIALS`, `YANDEX_API_KEY`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–º–µ–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ credentials

#### 2. "STT service –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
**–ü—Ä–∏—á–∏–Ω–∞**: –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

#### 3. "Voice settings not found"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ –ø—É—Ç–∏ `config.simple.settings.voice_settings`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

#### 4. "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤"
**–ü—Ä–∏—á–∏–Ω–∞**: Rate limiting —Å—Ä–∞–±–æ—Ç–∞–ª
**–†–µ—à–µ–Ω–∏–µ**:
- –£–≤–µ–ª–∏—á–∏—Ç—å `rate_limit_per_minute`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

#### 5. "VOICE_MESSAGES_FORBIDDEN"
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
**–†–µ—à–µ–Ω–∏–µ**: 
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ fallback –Ω–∞ —Ç–µ–∫—Å—Ç
- –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```
INFO - Voice service orchestrator initialized
INFO - Successfully initialized {provider} STT service  
INFO - Voice services initialized for agent {agent_id}
INFO - STT successful with provider {provider}
INFO - TTS successful with provider {provider}
WARNING - Voice processing failed: {error}
ERROR - Failed to initialize voice services: {error}
```

#### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ STT/TTS
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ (hit rate)
- Rate limiting —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# OpenAI
OPENAI_API_KEY=sk-...

# Google Cloud  
GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json
GOOGLE_CLOUD_PROJECT_ID=your-project-id

# Yandex Cloud
YANDEX_API_KEY=your-api-key
YANDEX_IAM_TOKEN=your-iam-token  
YANDEX_FOLDER_ID=your-folder-id

# MinIO –¥–ª—è —Ñ–∞–π–ª–æ–≤
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_VOICE_BUCKET_NAME=voice-files
```

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `app/api/schemas/voice_schemas.py` - Pydantic —Å—Ö–µ–º—ã
- `app/core/config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `app/services/voice/base.py` - –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
- `app/services/voice/intent_utils.py` - –£—Ç–∏–ª–∏—Ç—ã –Ω–∞–º–µ—Ä–µ–Ω–∏–π

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 1.0  
**–î–∞—Ç–∞**: 15 —è–Ω–≤–∞—Ä—è 2025  
**–ê–≤—Ç–æ—Ä**: Voice Services Team
