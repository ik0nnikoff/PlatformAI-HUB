2025-05-28 16:58:51,275 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 16:58:51,275 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 16:58:51,280 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 16:58:51,280 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 16:58:51,280 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 16:58:51,280 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 16:58:51,280 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 16:58:51,281 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 16:58:51,281 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 16:58:51,281 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 16:58:51,281 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 16:58:51,281 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 16:58:51,281 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 16:58:51,284 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 16:58:51,285 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 16:58:51,285 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 16:58:51,286 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 16:58:51,286 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 16:58:51,286 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 16:58:51,286 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 16:58:51,287 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 16:58:51,287 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 16:58:51,287 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4375362592) setup complete. Starting run loop.
2025-05-28 16:58:51,287 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 16:58:51,287 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 16:58:51,287 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4375362160) setup complete. Starting run loop.
2025-05-28 16:58:51,287 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 16:58:51,288 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 16:58:51,288 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 16:58:51,334 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 16:58:51,334 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 16:58:51,335 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 16:58:51,335 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 16:58:51,335 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 16:58:51,336 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 16:58:51,337 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:58:51,337 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 16:58:51,337 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 16:58:51,337 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 16:59:01,288 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 16:59:01,294 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 16:59:01,294 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4375362304) setup complete. Starting run loop.
2025-05-28 16:59:01,294 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 16:59:14,388 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 16:59:14,389 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 16:59:14,389 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 16:59:14,389 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4375362592) was cancelled.
2025-05-28 16:59:14,389 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4375362592) stopping. Performing cleanup...
2025-05-28 16:59:14,389 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 16:59:14,393 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 16:59:14,394 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 16:59:14,394 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:14,394 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 16:59:14,394 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 16:59:14,394 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4375362592) cleanup complete.
2025-05-28 16:59:14,394 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 16:59:14,394 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 16:59:14,395 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4375362160) was cancelled.
2025-05-28 16:59:14,395 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4375362160) stopping. Performing cleanup...
2025-05-28 16:59:14,395 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 16:59:14,397 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 16:59:14,398 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 16:59:14,398 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:14,398 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 16:59:14,398 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 16:59:14,398 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4375362160) cleanup complete.
2025-05-28 16:59:14,398 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 16:59:14,398 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 16:59:14,398 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4375362304) was cancelled.
2025-05-28 16:59:14,398 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4375362304) stopping. Performing cleanup...
2025-05-28 16:59:14,398 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 16:59:14,398 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:14,398 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 16:59:14,398 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 16:59:14,398 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 16:59:14,401 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 16:59:14,402 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 16:59:14,402 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:14,402 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 16:59:14,402 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 16:59:14,402 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 16:59:14,402 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4375362304) cleanup complete.
2025-05-28 16:59:14,402 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 16:59:14,402 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 16:59:14,402 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 16:59:14,405 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 16:59:14,405 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 16:59:14,814 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 16:59:14,814 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 16:59:14,819 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 16:59:14,819 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 16:59:14,819 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 16:59:14,819 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 16:59:14,819 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 16:59:14,819 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 16:59:14,819 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 16:59:14,819 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 16:59:14,819 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 16:59:14,820 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 16:59:14,820 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 16:59:14,821 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 16:59:14,821 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 16:59:14,821 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 16:59:14,823 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 16:59:14,823 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 16:59:14,823 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 16:59:14,823 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 16:59:14,824 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 16:59:14,824 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 16:59:14,824 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4381794640) setup complete. Starting run loop.
2025-05-28 16:59:14,824 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 16:59:14,825 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 16:59:14,825 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4382303168) setup complete. Starting run loop.
2025-05-28 16:59:14,825 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 16:59:14,826 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 16:59:14,826 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 16:59:14,869 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 16:59:14,869 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 16:59:14,870 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 16:59:14,870 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 16:59:14,870 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 16:59:14,871 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 16:59:14,871 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:14,872 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 16:59:14,872 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 16:59:14,872 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 16:59:24,826 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 16:59:24,832 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 16:59:24,832 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4382603792) setup complete. Starting run loop.
2025-05-28 16:59:24,832 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 16:59:32,296 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 16:59:32,297 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 16:59:32,297 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 16:59:32,297 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4381794640) was cancelled.
2025-05-28 16:59:32,297 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4381794640) stopping. Performing cleanup...
2025-05-28 16:59:32,297 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 16:59:32,307 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 16:59:32,308 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 16:59:32,308 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:32,308 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 16:59:32,308 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 16:59:32,308 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4381794640) cleanup complete.
2025-05-28 16:59:32,308 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 16:59:32,308 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 16:59:32,308 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4382303168) was cancelled.
2025-05-28 16:59:32,308 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4382303168) stopping. Performing cleanup...
2025-05-28 16:59:32,309 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 16:59:32,312 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 16:59:32,314 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 16:59:32,314 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:32,314 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 16:59:32,314 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 16:59:32,314 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4382303168) cleanup complete.
2025-05-28 16:59:32,314 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 16:59:32,314 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 16:59:32,314 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4382603792) was cancelled.
2025-05-28 16:59:32,314 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4382603792) stopping. Performing cleanup...
2025-05-28 16:59:32,315 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 16:59:32,315 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:32,315 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 16:59:32,315 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 16:59:32,315 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 16:59:32,319 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 16:59:32,321 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 16:59:32,322 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:32,322 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 16:59:32,322 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 16:59:32,322 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 16:59:32,322 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4382603792) cleanup complete.
2025-05-28 16:59:32,322 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 16:59:32,322 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 16:59:32,323 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 16:59:32,337 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 16:59:32,337 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 16:59:59,416 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 16:59:59,416 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 16:59:59,421 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 16:59:59,421 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 16:59:59,421 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 16:59:59,421 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 16:59:59,422 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 16:59:59,422 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 16:59:59,422 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 16:59:59,422 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 16:59:59,422 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 16:59:59,422 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 16:59:59,422 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 16:59:59,424 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 16:59:59,424 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 16:59:59,424 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 16:59:59,424 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 16:59:59,425 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 16:59:59,426 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 16:59:59,426 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 16:59:59,428 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 16:59:59,428 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4639351408) setup complete. Starting run loop.
2025-05-28 16:59:59,428 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 16:59:59,428 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 16:59:59,429 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 16:59:59,429 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 16:59:59,429 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 16:59:59,429 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4639226480) setup complete. Starting run loop.
2025-05-28 16:59:59,429 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 16:59:59,476 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 16:59:59,476 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 16:59:59,479 - INFO - app.services.process_manager - process_manager - start_agent_process - 880 - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 16:59:59,480 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 89654
2025-05-28 16:59:59,480 - INFO - app.services.process_manager - process_manager - start_agent_process - 913 - Agent process agent_airsoft_0faa9616 initiated start with PID 89654
2025-05-28 16:59:59,480 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 79 - Successfully initiated start for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 16:59:59,480 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 16:59:59,480 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 16:59:59,482 - INFO - app.services.process_manager - process_manager - start_integration_process - 554 - Attempting to start integration process for agent_airsoft_0faa9616/telegram...
2025-05-28 16:59:59,483 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [integration_start_agent_airsoft_0faa9616_telegram] Process launched without output capture. PID: 89655
2025-05-28 16:59:59,483 - INFO - app.services.process_manager - process_manager - start_integration_process - 600 - Integration process telegram for agent agent_airsoft_0faa9616 initiated start with PID 89655
2025-05-28 16:59:59,483 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 123 - Successfully initiated start for telegram integration for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 16:59:59,484 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 16:59:59,484 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 16:59:59,484 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 16:59:59,484 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:00:00,418 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 50 - Starting Telegram bot for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 57 - Database session factory configured for Telegram bot.
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - __init__ - 56 - TelegramIntegrationBot initialized. PID: 89655
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 74 - Calling TelegramIntegrationBot.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 441 - TelegramIntegrationBot setup started.
2025-05-28 17:00:00,419 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:00:00,425 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:00:00,438 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 452 - Aiogram Bot and Dispatcher initialized.
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _register_handlers - 341 - Aiogram handlers registered.
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 456 - TelegramIntegrationBot setup complete.
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component TelegramIntegrationBot (instance: 4873739712) setup complete. Starting run loop.
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 464 - TelegramIntegrationBot run_loop started for agent agent_airsoft_0faa9616. Polling for updates...
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: RedisOutputListener
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AiogramPolling
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 2 registered main tasks.
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:00:00,439 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 473 - Starting aiogram polling...
2025-05-28 17:00:00,439 - INFO - aiogram.dispatcher - dispatcher - start_polling - 527 - Start polling
2025-05-28 17:00:00,442 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:00:00,688 - INFO - aiogram.dispatcher - dispatcher - _polling - 341 - Run polling for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 17:00:00,891 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 21 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 28 - Database session factory configured for Agent.
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - __init__ - 120 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 89654
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 42 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - setup - 494 - AgentRunner setup started.
2025-05-28 17:00:00,892 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:00:00,898 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:00:00,898 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 27 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 17:00:00,980 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 17:00:00,980 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 33 - Configuration fetched successfully.
2025-05-28 17:00:00,980 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _load_config - 138 - Agent configuration loaded and prepared successfully.
2025-05-28 17:00:00,980 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 149 - Creating LangGraph application...
2025-05-28 17:00:00,980 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 908 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 17:00:00,980 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:00:01,006 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_main_llm - 63 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 17:00:01,006 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 813 - Creating agent graph in GraphFactory...
2025-05-28 17:00:01,006 - INFO - app.agent_runner.common.tools_registry - tools_registry - configure_tools_centralized - 364 - Configured 3 predefined tools from centralized registry
2025-05-28 17:00:01,006 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 94 - Added 3 tools from centralized registry
2025-05-28 17:00:01,006 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 114 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 17:00:01,061 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 17:00:01,068 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 17:00:02,267 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 17:00:02,332 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 132 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 17:00:02,333 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 166 - Must conditions for KB tool 'knowledgeBase-1745316404538': [FieldCondition(key='metadata.client_id', match=MatchValue(value='2'), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None), FieldCondition(key='metadata.datasource_id', match=MatchAny(any=['5', '6', '7']), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None)]
2025-05-28 17:00:02,333 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 182 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 17:00:02,333 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 190 - Using max_rewrites: 4
2025-05-28 17:00:02,333 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 217 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 17:00:02,334 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 244 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 17:00:02,334 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_tools - 153 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 17:00:02,334 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 821 - Context memory enabled: True
2025-05-28 17:00:02,335 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 829 - Added node: agent
2025-05-28 17:00:02,337 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 838 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 17:00:02,338 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 848 - Added node: safe_tools
2025-05-28 17:00:02,338 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 859 - Added edge: safe_tools -> agent
2025-05-28 17:00:02,338 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 865 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 17:00:02,339 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 872 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 17:00:02,339 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 888 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 900 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 917 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 157 - LangGraph application created successfully.
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component AgentRunner (instance: 4827235824) setup complete. Starting run loop.
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 522 - AgentRunner run_loop starting...
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AgentPubSubListener
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 1 registered main tasks.
2025-05-28 17:00:02,368 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:00:02,371 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:00:09,431 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:00:09,436 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:00:09,436 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4639755488) setup complete. Starting run loop.
2025-05-28 17:00:09,436 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 160 - ServiceComponentBase run_loop itself was cancelled (e.g. during shutdown).
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component AgentRunner (instance: 4827235824) received shutdown request. Initiating graceful shutdown...
2025-05-28 17:00:41,889 - WARNING - aiogram.dispatcher - dispatcher - _signal_stop_polling - 455 - Received SIGINT signal
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for AgentRunner (instance: 4827235824)...
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 536 - AgentRunner run_loop finished.
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for AgentRunner (instance: 4827235824) was cancelled.
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component AgentRunner (instance: 4827235824) stopping. Performing cleanup...
2025-05-28 17:00:41,889 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 546 - AgentRunner cleanup started.
2025-05-28 17:00:41,889 - INFO - aiogram.dispatcher - dispatcher - _polling - 359 - Polling stopped for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 17:00:41,889 - INFO - aiogram.dispatcher - dispatcher - start_polling - 554 - Polling stopped
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 552 - Cleared loaded threads cache 'agent_threads:agent_airsoft_0faa9616' (deleted: 0) on start/restart.
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 1 main tasks.
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:input finished.
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'AgentPubSubListener' completed during cleanup with result: None
2025-05-28 17:00:41,890 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 17:00:41,896 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616 as part of cleanup.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key agent_status:agent_airsoft_0faa9616 from Redis.
2025-05-28 17:00:41,897 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616 cleaned up Redis resources.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 581 - AgentRunner cleanup finished.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component AgentRunner (instance: 4827235824) cleanup complete.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 51 - AgentRunner for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 17:00:41,897 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 60 - Shutting down agent runner for agent_airsoft_0faa9616.
2025-05-28 17:00:41,898 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:00:41,898 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 63 - Database engine closed.
2025-05-28 17:00:41,898 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 66 - Agent runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 17:00:41,898 - INFO - __main__ - runner_main - <module> - 86 - Agent runner main finished.
2025-05-28 17:00:42,060 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:00:42,060 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:00:42,060 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:00:42,060 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4639351408) was cancelled.
2025-05-28 17:00:42,060 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4639351408) stopping. Performing cleanup...
2025-05-28 17:00:42,060 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:00:42,065 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:00:42,066 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:00:42,066 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:00:42,066 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:00:42,066 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:00:42,066 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4639351408) cleanup complete.
2025-05-28 17:00:42,066 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:00:42,066 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:00:42,066 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4639226480) was cancelled.
2025-05-28 17:00:42,066 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4639226480) stopping. Performing cleanup...
2025-05-28 17:00:42,067 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:00:42,069 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:00:42,070 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:00:42,070 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:00:42,071 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:00:42,071 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:00:42,071 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4639226480) cleanup complete.
2025-05-28 17:00:42,071 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:00:42,071 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:00:42,071 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4639755488) was cancelled.
2025-05-28 17:00:42,071 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4639755488) stopping. Performing cleanup...
2025-05-28 17:00:42,071 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:00:42,071 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:00:42,071 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:00:42,071 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:00:42,071 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:00:42,073 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:00:42,074 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:00:42,074 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:00:42,075 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:00:42,075 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:00:42,075 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:00:42,075 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4639755488) cleanup complete.
2025-05-28 17:00:42,075 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:00:42,075 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:00:42,075 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:00:42,079 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:00:42,079 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:00:42,141 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 482 - Aiogram polling has stopped.
2025-05-28 17:00:42,141 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 137 - Main task 'AiogramPolling' completed. Result: None
2025-05-28 17:00:42,141 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 156 - A main task finished. Initiating shutdown of other tasks and component.
2025-05-28 17:00:42,141 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component TelegramIntegrationBot (instance: 4873739712) received shutdown request. Initiating graceful shutdown...
2025-05-28 17:00:42,141 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for TelegramIntegrationBot (instance: 4873739712)...
2025-05-28 17:00:42,141 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 494 - TelegramIntegrationBot run_loop for agent agent_airsoft_0faa9616 finishing.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for TelegramIntegrationBot (instance: 4873739712) was cancelled.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component TelegramIntegrationBot (instance: 4873739712) stopping. Performing cleanup...
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 503 - TelegramIntegrationBot cleanup started.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 516 - Closing Aiogram bot session.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 518 - Aiogram bot session closed.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 2 main tasks.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 17:00:42,142 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:00:42,143 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:output finished.
2025-05-28 17:00:42,143 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'RedisOutputListener' completed during cleanup with result: None
2025-05-28 17:00:42,143 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 17:00:42,147 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616:telegram as part of cleanup.
2025-05-28 17:00:42,148 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key integration_status:agent_airsoft_0faa9616:telegram from Redis.
2025-05-28 17:00:42,148 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616:telegram cleaned up Redis resources.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 524 - TelegramIntegrationBot cleanup finished.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component TelegramIntegrationBot (instance: 4873739712) cleanup complete.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 86 - TelegramIntegrationBot for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 95 - Shutting down Telegram bot runner for agent_airsoft_0faa9616.
2025-05-28 17:00:42,149 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 98 - Database engine closed.
2025-05-28 17:00:42,149 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 101 - Telegram bot runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 17:00:42,151 - INFO - __main__ - telegram_bot_main - <module> - 124 - Telegram bot runner main finished.
2025-05-28 17:01:44,791 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:01:44,791 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:01:44,797 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:01:44,797 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:01:44,797 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:01:44,797 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:01:44,797 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:01:44,797 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:01:44,797 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:01:44,797 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:01:44,797 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:01:44,797 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:01:44,797 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:01:44,799 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:01:44,801 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:01:44,801 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:01:44,801 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:01:44,801 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:01:44,801 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:01:44,801 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:01:44,803 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:01:44,803 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:01:44,803 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4380465568) setup complete. Starting run loop.
2025-05-28 17:01:44,804 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:01:44,804 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:01:44,804 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4380605472) setup complete. Starting run loop.
2025-05-28 17:01:44,804 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:01:44,806 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:01:44,806 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:01:44,853 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:01:44,853 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:01:44,855 - INFO - app.services.process_manager - process_manager - start_agent_process - 880 - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 17:01:44,856 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 90507
2025-05-28 17:01:44,856 - INFO - app.services.process_manager - process_manager - start_agent_process - 913 - Agent process agent_airsoft_0faa9616 initiated start with PID 90507
2025-05-28 17:01:44,857 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 79 - Successfully initiated start for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 17:01:44,857 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:01:44,857 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:01:44,858 - INFO - app.services.process_manager - process_manager - start_integration_process - 554 - Attempting to start integration process for agent_airsoft_0faa9616/telegram...
2025-05-28 17:01:44,859 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [integration_start_agent_airsoft_0faa9616_telegram] Process launched without output capture. PID: 90508
2025-05-28 17:01:44,859 - INFO - app.services.process_manager - process_manager - start_integration_process - 600 - Integration process telegram for agent agent_airsoft_0faa9616 initiated start with PID 90508
2025-05-28 17:01:44,860 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 123 - Successfully initiated start for telegram integration for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 17:01:44,860 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:01:44,860 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:01:44,860 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:01:44,860 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:01:45,786 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 50 - Starting Telegram bot for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 57 - Database session factory configured for Telegram bot.
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - __init__ - 56 - TelegramIntegrationBot initialized. PID: 90508
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 74 - Calling TelegramIntegrationBot.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 441 - TelegramIntegrationBot setup started.
2025-05-28 17:01:45,786 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:01:45,793 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:01:45,806 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 452 - Aiogram Bot and Dispatcher initialized.
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _register_handlers - 341 - Aiogram handlers registered.
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 456 - TelegramIntegrationBot setup complete.
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component TelegramIntegrationBot (instance: 4777909840) setup complete. Starting run loop.
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 464 - TelegramIntegrationBot run_loop started for agent agent_airsoft_0faa9616. Polling for updates...
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: RedisOutputListener
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AiogramPolling
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 2 registered main tasks.
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:01:45,807 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 473 - Starting aiogram polling...
2025-05-28 17:01:45,807 - INFO - aiogram.dispatcher - dispatcher - start_polling - 527 - Start polling
2025-05-28 17:01:45,809 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:01:46,059 - INFO - aiogram.dispatcher - dispatcher - _polling - 341 - Run polling for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 17:01:46,217 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 21 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 28 - Database session factory configured for Agent.
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - __init__ - 120 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 90507
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 42 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - setup - 494 - AgentRunner setup started.
2025-05-28 17:01:46,217 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:01:46,223 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:01:46,223 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 27 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 17:01:46,303 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 17:01:46,303 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 33 - Configuration fetched successfully.
2025-05-28 17:01:46,303 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _load_config - 138 - Agent configuration loaded and prepared successfully.
2025-05-28 17:01:46,303 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 149 - Creating LangGraph application...
2025-05-28 17:01:46,303 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 908 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 17:01:46,303 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:01:46,329 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_main_llm - 63 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 17:01:46,329 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 813 - Creating agent graph in GraphFactory...
2025-05-28 17:01:46,329 - INFO - app.agent_runner.common.tools_registry - tools_registry - configure_tools_centralized - 364 - Configured 3 predefined tools from centralized registry
2025-05-28 17:01:46,329 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 94 - Added 3 tools from centralized registry
2025-05-28 17:01:46,329 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 114 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 17:01:46,387 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 17:01:46,399 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 17:01:47,491 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 17:01:47,493 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 132 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 17:01:47,493 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 166 - Must conditions for KB tool 'knowledgeBase-1745316404538': [FieldCondition(key='metadata.client_id', match=MatchValue(value='2'), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None), FieldCondition(key='metadata.datasource_id', match=MatchAny(any=['5', '6', '7']), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None)]
2025-05-28 17:01:47,493 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 182 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 17:01:47,493 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 190 - Using max_rewrites: 4
2025-05-28 17:01:47,493 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 217 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 17:01:47,493 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 244 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 17:01:47,493 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_tools - 153 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 17:01:47,493 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 821 - Context memory enabled: True
2025-05-28 17:01:47,494 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 829 - Added node: agent
2025-05-28 17:01:47,494 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 838 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 17:01:47,494 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 848 - Added node: safe_tools
2025-05-28 17:01:47,494 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 859 - Added edge: safe_tools -> agent
2025-05-28 17:01:47,494 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 865 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 17:01:47,494 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 872 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 17:01:47,495 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 888 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 900 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 917 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 157 - LangGraph application created successfully.
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component AgentRunner (instance: 4505191776) setup complete. Starting run loop.
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 522 - AgentRunner run_loop starting...
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AgentPubSubListener
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 1 registered main tasks.
2025-05-28 17:01:47,506 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:01:47,510 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:01:54,807 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:01:54,814 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:01:54,814 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4380605376) setup complete. Starting run loop.
2025-05-28 17:01:54,814 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:02:26,585 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'сколько нужно программистов для перехода на ут11?...'
2025-05-28 17:02:26,587 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 17:02:26,671 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 17:02:26,672 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 17:02:26,672 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 17:02:26,673 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: a0f496a3-e410-4b62-a956-d6e41a175aa8)
2025-05-28 17:02:26,673 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 17:02:26,674 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 423 - Thread '144641834' not found in cache 'agent_threads:agent_airsoft_0faa9616'. Loading history from DB with depth 20.
2025-05-28 17:02:26,710 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8, db_id: 890
2025-05-28 17:02:26,724 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 433 - Loaded 20 messages from DB for thread '144641834'.
2025-05-28 17:02:26,725 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 436 - Added thread '144641834' to cache 'agent_threads:agent_airsoft_0faa9616'.
2025-05-28 17:02:26,725 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 20)
2025-05-28 17:02:26,791 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:02:26,791 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:02:26,817 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 708 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:02:26,821 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 799 - Model bound to 5 tools.
2025-05-28 17:02:27,673 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756292 is handled. Duration 1089 ms by bot id=1750613938
2025-05-28 17:02:30,232 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:02:30,935 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: N/A
2025-05-28 17:02:30,935 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'tool_calls', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_79b79be41f'}
2025-05-28 17:02:30,935 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1548, 'output_tokens': 36, 'total_tokens': 1584, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 17:02:30,935 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1548 C:36 T:1584
2025-05-28 17:02:30,935 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1584 tokens recorded.
2025-05-28 17:02:30,936 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 600 - ---ROUTE TOOLS---
2025-05-28 17:02:30,936 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 630 - Tool call detected: knowledgeBase-1745316404538
2025-05-28 17:02:30,936 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 633 - ---DECISION: ROUTE TO RETRIEVE (knowledgeBase-1745316404538)---
2025-05-28 17:02:31,831 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 17:02:31,848 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST http://127.0.0.1:6333/collections/platformai/points/query "HTTP/1.1 200 OK"
2025-05-28 17:02:31,851 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 360 - ---CHECK RELEVANCE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:02:31,851 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 371 - Grading documents for question: 'сколько нужно программистов для перехода на ут11?'
2025-05-28 17:02:31,851 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.0, streaming: False
2025-05-28 17:02:31,876 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 708 - Created grading LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:02:33,144 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:02:33,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:191 C:6 T:197
2025-05-28 17:02:33,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for grading_llm: 197 tokens recorded.
2025-05-28 17:02:33,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 456 - Total token usage for grading_llm batch: 197 tokens.
2025-05-28 17:02:33,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 461 - Found 0 relevant documents out of 1 initial (after split).
2025-05-28 17:02:33,163 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _decide_to_generate_edge - 580 - ---ASSESS GRADED DOCUMENTS---
2025-05-28 17:02:33,163 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _decide_to_generate_edge - 589 - ---DECISION: NO RELEVANT DOCUMENTS, REWRITE---
2025-05-28 17:02:33,164 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 466 - ---TRANSFORM QUERY (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:02:33,164 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 477 - Rewrite attempt 1/4 for question: 'сколько нужно программистов для перехода на ут11?'
2025-05-28 17:02:33,164 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 480 - Rewriting original question: сколько нужно программистов для перехода на ут11?
2025-05-28 17:02:33,164 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: False
2025-05-28 17:02:33,190 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 708 - Created rewrite LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:02:35,253 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:02:35,255 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 498 - Rewritten question: Сколько программистов требуется для миграции на 1С:Управление торговлей 11 с учетом объема данных, количества кастомных доработок и сроков реализации проекта?
2025-05-28 17:02:35,255 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:2420 C:42 T:2462
2025-05-28 17:02:35,255 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for rewrite_llm: 2462 tokens recorded.
2025-05-28 17:02:35,257 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:02:35,257 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:02:35,283 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 708 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:02:35,287 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 799 - Model bound to 5 tools.
2025-05-28 17:02:36,718 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:02:38,058 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Конечно! Вот переформулированный запрос:

**"Сколько программистов требуется для миграции на 1С:Упра
2025-05-28 17:02:38,058 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_79b79be41f'}
2025-05-28 17:02:38,058 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1675, 'output_tokens': 81, 'total_tokens': 1756, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 17:02:38,058 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1675 C:81 T:1756
2025-05-28 17:02:38,058 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1756 tokens recorded.
2025-05-28 17:02:38,059 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 600 - ---ROUTE TOOLS---
2025-05-28 17:02:38,059 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 608 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 17:02:38,060 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Конечно! Вот переформулированный запрос:

**"Сколько программистов требуется для миграции на 1С:Упра...
2025-05-28 17:02:38,062 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: a0f496a3-e410-4b62-a956-d6e41a175aa8)
2025-05-28 17:02:38,062 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 4 token usage events for InteractionID: a0f496a3-e410-4b62-a956-d6e41a175aa8.
2025-05-28 17:02:38,066 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'a0f496a3-e410-4b62-a956-d6e41a175aa8', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1548, 'completion_tokens': 36, 'total_tokens': 1584, 'timestamp': '2025-05-28T12:02:30.935677+00:00'}
2025-05-28 17:02:38,066 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8
2025-05-28 17:02:38,066 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Конечно! Вот переформулированный запрос:

**"Сколько программистов требуется для миграции на 1С:Упра...
2025-05-28 17:02:38,066 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Конечно! Вот переформулированный запрос:

**"Сколь...'
2025-05-28 17:02:38,070 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8, db_id: 891
2025-05-28 17:02:38,097 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 891 for interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8 on attempt 1
2025-05-28 17:02:38,103 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8, db_id: 353
2025-05-28 17:02:38,105 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'a0f496a3-e410-4b62-a956-d6e41a175aa8', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1675, 'completion_tokens': 81, 'total_tokens': 1756, 'timestamp': '2025-05-28T12:02:38.058618+00:00'}
2025-05-28 17:02:38,105 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8
2025-05-28 17:02:38,107 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 891 for interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8 on attempt 1
2025-05-28 17:02:38,110 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8, db_id: 354
2025-05-28 17:02:38,112 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'a0f496a3-e410-4b62-a956-d6e41a175aa8', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'rewrite_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 2420, 'completion_tokens': 42, 'total_tokens': 2462, 'timestamp': '2025-05-28T12:02:35.255903+00:00'}
2025-05-28 17:02:38,112 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8
2025-05-28 17:02:38,113 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 891 for interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8 on attempt 1
2025-05-28 17:02:38,115 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8, db_id: 355
2025-05-28 17:02:38,117 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'a0f496a3-e410-4b62-a956-d6e41a175aa8', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'grading_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 191, 'completion_tokens': 6, 'total_tokens': 197, 'timestamp': '2025-05-28T12:02:33.162641+00:00'}
2025-05-28 17:02:38,117 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8
2025-05-28 17:02:38,118 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 891 for interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8 on attempt 1
2025-05-28 17:02:38,120 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: a0f496a3-e410-4b62-a956-d6e41a175aa8, db_id: 356
2025-05-28 17:04:07,147 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:04:07,147 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:04:07,147 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:04:07,148 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4380465568) was cancelled.
2025-05-28 17:04:07,148 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4380465568) stopping. Performing cleanup...
2025-05-28 17:04:07,148 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:04:07,153 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:04:07,155 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:04:07,155 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:04:07,155 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:04:07,155 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:04:07,155 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4380465568) cleanup complete.
2025-05-28 17:04:07,155 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:04:07,155 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:04:07,155 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4380605472) was cancelled.
2025-05-28 17:04:07,155 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4380605472) stopping. Performing cleanup...
2025-05-28 17:04:07,155 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:04:07,159 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:04:07,160 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:04:07,160 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:04:07,160 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:04:07,160 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:04:07,160 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4380605472) cleanup complete.
2025-05-28 17:04:07,160 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:04:07,160 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:04:07,160 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4380605376) was cancelled.
2025-05-28 17:04:07,160 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4380605376) stopping. Performing cleanup...
2025-05-28 17:04:07,161 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:04:07,161 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:04:07,161 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:04:07,161 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:04:07,161 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:04:07,163 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:04:07,164 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:04:07,164 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:04:07,164 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:04:07,164 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:04:07,164 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:04:07,164 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4380605376) cleanup complete.
2025-05-28 17:04:07,164 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:04:07,164 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:04:07,165 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:04:07,183 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:04:07,183 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:04:07,689 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:04:07,689 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:04:07,694 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:04:07,694 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:04:07,694 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:04:07,694 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:04:07,694 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:04:07,694 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:04:07,694 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:04:07,694 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:04:07,695 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:04:07,695 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:04:07,695 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:04:07,697 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:04:07,697 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:04:07,697 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:04:07,697 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:04:07,697 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:04:07,697 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:04:07,697 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:04:07,699 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:04:07,699 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4416281664) setup complete. Starting run loop.
2025-05-28 17:04:07,699 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:04:07,700 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:04:07,700 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:04:07,700 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4418485040) setup complete. Starting run loop.
2025-05-28 17:04:07,700 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:04:07,703 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:04:07,703 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:04:07,749 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:04:07,749 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:04:07,750 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:04:07,750 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:04:07,750 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:04:07,752 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:04:07,753 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:04:07,753 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:04:07,753 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:04:07,753 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:04:17,704 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:04:17,707 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:04:17,707 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4418475632) setup complete. Starting run loop.
2025-05-28 17:04:17,708 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:05:02,956 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 160 - ServiceComponentBase run_loop itself was cancelled (e.g. during shutdown).
2025-05-28 17:05:02,956 - WARNING - aiogram.dispatcher - dispatcher - _signal_stop_polling - 455 - Received SIGINT signal
2025-05-28 17:05:02,958 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component AgentRunner (instance: 4505191776) received shutdown request. Initiating graceful shutdown...
2025-05-28 17:05:02,959 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for AgentRunner (instance: 4505191776)...
2025-05-28 17:05:02,959 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 17:05:02,959 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 536 - AgentRunner run_loop finished.
2025-05-28 17:05:02,959 - INFO - aiogram.dispatcher - dispatcher - _polling - 359 - Polling stopped for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 17:05:02,959 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for AgentRunner (instance: 4505191776) was cancelled.
2025-05-28 17:05:02,959 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component AgentRunner (instance: 4505191776) stopping. Performing cleanup...
2025-05-28 17:05:02,959 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 546 - AgentRunner cleanup started.
2025-05-28 17:05:02,959 - INFO - aiogram.dispatcher - dispatcher - start_polling - 554 - Polling stopped
2025-05-28 17:05:02,960 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 552 - Cleared loaded threads cache 'agent_threads:agent_airsoft_0faa9616' (deleted: 1) on start/restart.
2025-05-28 17:05:02,960 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 1 main tasks.
2025-05-28 17:05:02,960 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 17:05:02,961 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 17:05:02,961 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:05:02,961 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:input finished.
2025-05-28 17:05:02,961 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'AgentPubSubListener' completed during cleanup with result: None
2025-05-28 17:05:02,961 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 17:05:02,965 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616 as part of cleanup.
2025-05-28 17:05:02,966 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key agent_status:agent_airsoft_0faa9616 from Redis.
2025-05-28 17:05:02,966 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:02,966 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616 cleaned up Redis resources.
2025-05-28 17:05:02,967 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 17:05:02,967 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 581 - AgentRunner cleanup finished.
2025-05-28 17:05:02,967 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component AgentRunner (instance: 4505191776) cleanup complete.
2025-05-28 17:05:02,967 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 51 - AgentRunner for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 17:05:02,967 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 60 - Shutting down agent runner for agent_airsoft_0faa9616.
2025-05-28 17:05:02,972 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:05:02,972 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 63 - Database engine closed.
2025-05-28 17:05:02,972 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 66 - Agent runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 17:05:02,973 - INFO - __main__ - runner_main - <module> - 86 - Agent runner main finished.
2025-05-28 17:05:03,120 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:05:03,120 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:05:03,120 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:05:03,120 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4416281664) was cancelled.
2025-05-28 17:05:03,120 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4416281664) stopping. Performing cleanup...
2025-05-28 17:05:03,120 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:05:03,125 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:05:03,125 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:05:03,126 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:03,126 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:05:03,126 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:05:03,126 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4416281664) cleanup complete.
2025-05-28 17:05:03,126 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:05:03,126 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:05:03,126 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4418485040) was cancelled.
2025-05-28 17:05:03,126 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4418485040) stopping. Performing cleanup...
2025-05-28 17:05:03,126 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:05:03,129 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:05:03,130 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:05:03,130 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:03,130 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:05:03,130 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:05:03,130 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4418485040) cleanup complete.
2025-05-28 17:05:03,130 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:05:03,130 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:05:03,130 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4418475632) was cancelled.
2025-05-28 17:05:03,130 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4418475632) stopping. Performing cleanup...
2025-05-28 17:05:03,130 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:05:03,130 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:03,130 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:05:03,130 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:05:03,130 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:05:03,132 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:05:03,133 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:05:03,133 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:03,133 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:05:03,133 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:05:03,133 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:05:03,133 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4418475632) cleanup complete.
2025-05-28 17:05:03,133 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:05:03,133 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:05:03,133 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:05:03,137 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:05:03,137 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 482 - Aiogram polling has stopped.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 137 - Main task 'AiogramPolling' completed. Result: None
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 156 - A main task finished. Initiating shutdown of other tasks and component.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component TelegramIntegrationBot (instance: 4777909840) received shutdown request. Initiating graceful shutdown...
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for TelegramIntegrationBot (instance: 4777909840)...
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 494 - TelegramIntegrationBot run_loop for agent agent_airsoft_0faa9616 finishing.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for TelegramIntegrationBot (instance: 4777909840) was cancelled.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component TelegramIntegrationBot (instance: 4777909840) stopping. Performing cleanup...
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 503 - TelegramIntegrationBot cleanup started.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 516 - Closing Aiogram bot session.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 518 - Aiogram bot session closed.
2025-05-28 17:05:03,211 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 2 main tasks.
2025-05-28 17:05:03,212 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 17:05:03,212 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 17:05:03,212 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:05:03,212 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:output finished.
2025-05-28 17:05:03,212 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'RedisOutputListener' completed during cleanup with result: None
2025-05-28 17:05:03,212 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 17:05:03,217 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616:telegram as part of cleanup.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key integration_status:agent_airsoft_0faa9616:telegram from Redis.
2025-05-28 17:05:03,218 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616:telegram cleaned up Redis resources.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 524 - TelegramIntegrationBot cleanup finished.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component TelegramIntegrationBot (instance: 4777909840) cleanup complete.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 86 - TelegramIntegrationBot for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 17:05:03,218 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 95 - Shutting down Telegram bot runner for agent_airsoft_0faa9616.
2025-05-28 17:05:03,223 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:05:03,223 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 98 - Database engine closed.
2025-05-28 17:05:03,223 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 101 - Telegram bot runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 17:05:03,225 - INFO - __main__ - telegram_bot_main - <module> - 124 - Telegram bot runner main finished.
2025-05-28 17:05:13,372 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:05:13,372 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:05:13,376 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:05:13,376 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:05:13,376 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:05:13,376 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:05:13,377 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:05:13,377 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:05:13,377 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:05:13,377 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:05:13,377 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:05:13,377 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:05:13,377 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:05:13,382 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:05:13,382 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:05:13,382 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:05:13,383 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:05:13,383 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:05:13,383 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:05:13,383 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:05:13,384 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:05:13,384 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:05:13,384 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4455495056) setup complete. Starting run loop.
2025-05-28 17:05:13,384 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:05:13,384 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4456151760) setup complete. Starting run loop.
2025-05-28 17:05:13,384 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:05:13,384 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:05:13,386 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:05:13,386 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:05:13,430 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:05:13,431 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:05:13,433 - INFO - app.services.process_manager - process_manager - start_agent_process - 880 - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 17:05:13,434 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 92550
2025-05-28 17:05:13,434 - INFO - app.services.process_manager - process_manager - start_agent_process - 913 - Agent process agent_airsoft_0faa9616 initiated start with PID 92550
2025-05-28 17:05:13,435 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 79 - Successfully initiated start for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 17:05:13,435 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:05:13,435 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:05:13,436 - INFO - app.services.process_manager - process_manager - start_integration_process - 554 - Attempting to start integration process for agent_airsoft_0faa9616/telegram...
2025-05-28 17:05:13,437 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [integration_start_agent_airsoft_0faa9616_telegram] Process launched without output capture. PID: 92551
2025-05-28 17:05:13,437 - INFO - app.services.process_manager - process_manager - start_integration_process - 600 - Integration process telegram for agent agent_airsoft_0faa9616 initiated start with PID 92551
2025-05-28 17:05:13,437 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 123 - Successfully initiated start for telegram integration for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 17:05:13,438 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:05:13,438 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:05:13,438 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:05:13,438 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:05:14,348 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 50 - Starting Telegram bot for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 57 - Database session factory configured for Telegram bot.
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - __init__ - 56 - TelegramIntegrationBot initialized. PID: 92551
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 74 - Calling TelegramIntegrationBot.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 441 - TelegramIntegrationBot setup started.
2025-05-28 17:05:14,349 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:05:14,356 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 452 - Aiogram Bot and Dispatcher initialized.
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _register_handlers - 341 - Aiogram handlers registered.
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 456 - TelegramIntegrationBot setup complete.
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component TelegramIntegrationBot (instance: 4402044256) setup complete. Starting run loop.
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 464 - TelegramIntegrationBot run_loop started for agent agent_airsoft_0faa9616. Polling for updates...
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: RedisOutputListener
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AiogramPolling
2025-05-28 17:05:14,369 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 2 registered main tasks.
2025-05-28 17:05:14,370 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:05:14,370 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 473 - Starting aiogram polling...
2025-05-28 17:05:14,370 - INFO - aiogram.dispatcher - dispatcher - start_polling - 527 - Start polling
2025-05-28 17:05:14,372 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:output
2025-05-28 17:05:14,623 - INFO - aiogram.dispatcher - dispatcher - _polling - 341 - Run polling for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 17:05:14,784 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 21 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 28 - Database session factory configured for Agent.
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - __init__ - 120 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 92550
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 42 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - setup - 494 - AgentRunner setup started.
2025-05-28 17:05:14,784 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:05:14,789 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:05:14,789 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 27 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 17:05:14,886 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 17:05:14,886 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 33 - Configuration fetched successfully.
2025-05-28 17:05:14,886 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _load_config - 138 - Agent configuration loaded and prepared successfully.
2025-05-28 17:05:14,886 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 149 - Creating LangGraph application...
2025-05-28 17:05:14,886 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 913 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 17:05:14,886 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:05:14,919 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_main_llm - 63 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 17:05:14,919 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 818 - Creating agent graph in GraphFactory...
2025-05-28 17:05:14,919 - INFO - app.agent_runner.common.tools_registry - tools_registry - configure_tools_centralized - 364 - Configured 3 predefined tools from centralized registry
2025-05-28 17:05:14,919 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 94 - Added 3 tools from centralized registry
2025-05-28 17:05:14,919 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 114 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 17:05:14,975 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 17:05:14,985 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 17:05:15,806 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 17:05:15,808 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 132 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 17:05:15,808 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 166 - Must conditions for KB tool 'knowledgeBase-1745316404538': [FieldCondition(key='metadata.client_id', match=MatchValue(value='2'), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None), FieldCondition(key='metadata.datasource_id', match=MatchAny(any=['5', '6', '7']), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None)]
2025-05-28 17:05:15,809 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 182 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 17:05:15,809 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 190 - Using max_rewrites: 4
2025-05-28 17:05:15,809 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 217 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 17:05:15,809 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 244 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 17:05:15,809 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_tools - 153 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 17:05:15,809 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 826 - Context memory enabled: True
2025-05-28 17:05:15,809 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 834 - Added node: agent
2025-05-28 17:05:15,809 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 843 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 17:05:15,810 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 853 - Added node: safe_tools
2025-05-28 17:05:15,810 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 864 - Added edge: safe_tools -> agent
2025-05-28 17:05:15,810 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 870 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 17:05:15,810 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 877 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 17:05:15,810 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 893 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 905 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 922 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 157 - LangGraph application created successfully.
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component AgentRunner (instance: 4679402944) setup complete. Starting run loop.
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 522 - AgentRunner run_loop starting...
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AgentPubSubListener
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 1 registered main tasks.
2025-05-28 17:05:15,820 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:05:15,823 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:05:23,388 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:05:23,392 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:05:23,392 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4456151904) setup complete. Starting run loop.
2025-05-28 17:05:23,392 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:05:48,796 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'сколько нужно программистов для перехода на ут11?...'
2025-05-28 17:05:48,799 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 17:05:48,884 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 17:05:48,884 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 17:05:48,884 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 17:05:48,885 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: c4470821-3b16-4cd8-a1e5-aa13826ee859)
2025-05-28 17:05:48,885 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 17:05:48,886 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 423 - Thread '144641834' not found in cache 'agent_threads:agent_airsoft_0faa9616'. Loading history from DB with depth 20.
2025-05-28 17:05:48,925 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859, db_id: 892
2025-05-28 17:05:48,936 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 433 - Loaded 20 messages from DB for thread '144641834'.
2025-05-28 17:05:48,936 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 436 - Added thread '144641834' to cache 'agent_threads:agent_airsoft_0faa9616'.
2025-05-28 17:05:48,937 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 20)
2025-05-28 17:05:48,987 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:05:48,987 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:05:49,013 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:05:49,018 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 17:05:49,884 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756293 is handled. Duration 1089 ms by bot id=1750613938
2025-05-28 17:05:50,226 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:05:50,805 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: N/A
2025-05-28 17:05:50,805 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'tool_calls', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_79b79be41f'}
2025-05-28 17:05:50,805 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1629, 'output_tokens': 36, 'total_tokens': 1665, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 17:05:50,805 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1629 C:36 T:1665
2025-05-28 17:05:50,805 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1665 tokens recorded.
2025-05-28 17:05:50,806 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 17:05:50,806 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 635 - Tool call detected: knowledgeBase-1745316404538
2025-05-28 17:05:50,806 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 638 - ---DECISION: ROUTE TO RETRIEVE (knowledgeBase-1745316404538)---
2025-05-28 17:05:51,395 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 17:05:51,417 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST http://127.0.0.1:6333/collections/platformai/points/query "HTTP/1.1 200 OK"
2025-05-28 17:05:51,421 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 360 - ---CHECK RELEVANCE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:05:51,421 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 371 - Grading documents for question: 'сколько нужно программистов для перехода на ут11?'
2025-05-28 17:05:51,421 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.0, streaming: False
2025-05-28 17:05:51,446 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created grading LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:05:51,447 - INFO - AGENT:agent_airsoft_0faa9616 - factory - process_doc - 413 - Grading document content (first 300 chars): 
---RETRIEVER_DOC---

---RETRIEVER_DOC---

---RETRIEVER_DOC---

2025-05-28 17:05:51,447 - INFO - AGENT:agent_airsoft_0faa9616 - factory - process_doc - 414 - Question for grading: сколько нужно программистов для перехода на ут11?
2025-05-28 17:05:52,443 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:05:52,456 - INFO - AGENT:agent_airsoft_0faa9616 - factory - process_doc - 424 - Grading result: no for document starting with: 
---RETRIEVER_DOC---

---RETRIEVER_DOC---

---RETRIEVER_DOC---
...
2025-05-28 17:05:52,456 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:191 C:6 T:197
2025-05-28 17:05:52,456 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for grading_llm: 197 tokens recorded.
2025-05-28 17:05:52,456 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 461 - Total token usage for grading_llm batch: 197 tokens.
2025-05-28 17:05:52,456 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 466 - Found 0 relevant documents out of 1 initial (after split).
2025-05-28 17:05:52,457 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _decide_to_generate_edge - 585 - ---ASSESS GRADED DOCUMENTS---
2025-05-28 17:05:52,457 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _decide_to_generate_edge - 594 - ---DECISION: NO RELEVANT DOCUMENTS, REWRITE---
2025-05-28 17:05:52,458 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 471 - ---TRANSFORM QUERY (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:05:52,458 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 482 - Rewrite attempt 1/4 for question: 'сколько нужно программистов для перехода на ут11?'
2025-05-28 17:05:52,458 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 485 - Rewriting original question: сколько нужно программистов для перехода на ут11?
2025-05-28 17:05:52,458 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: False
2025-05-28 17:05:52,483 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created rewrite LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:05:54,241 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:05:54,245 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _rewrite_node - 503 - Rewritten question: Сколько программистов требуется для миграции и адаптации системы на 1С:Управление торговлей 11 с учетом объема данных, количества кастомных доработок и сроков реализации проекта?
2025-05-28 17:05:54,245 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:2538 C:46 T:2584
2025-05-28 17:05:54,245 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for rewrite_llm: 2584 tokens recorded.
2025-05-28 17:05:54,246 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:05:54,246 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:05:54,271 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:05:54,274 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 17:05:55,201 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:05:56,890 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Конечно! Вот переформулированный запрос:

**"Сколько программистов требуется для миграции и адаптаци
2025-05-28 17:05:56,890 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_71b9d4b387'}
2025-05-28 17:05:56,890 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1760, 'output_tokens': 85, 'total_tokens': 1845, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 17:05:56,890 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1760 C:85 T:1845
2025-05-28 17:05:56,890 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1845 tokens recorded.
2025-05-28 17:05:56,891 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 17:05:56,891 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 17:05:56,892 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Конечно! Вот переформулированный запрос:

**"Сколько программистов требуется для миграции и адаптаци...
2025-05-28 17:05:56,894 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: c4470821-3b16-4cd8-a1e5-aa13826ee859)
2025-05-28 17:05:56,894 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 4 token usage events for InteractionID: c4470821-3b16-4cd8-a1e5-aa13826ee859.
2025-05-28 17:05:56,898 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'c4470821-3b16-4cd8-a1e5-aa13826ee859', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1629, 'completion_tokens': 36, 'total_tokens': 1665, 'timestamp': '2025-05-28T12:05:50.805681+00:00'}
2025-05-28 17:05:56,898 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Конечно! Вот переформулированный запрос:

**"Сколько программистов требуется для миграции и адаптаци...
2025-05-28 17:05:56,898 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859
2025-05-28 17:05:56,898 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Конечно! Вот переформулированный запрос:

**"Сколь...'
2025-05-28 17:05:56,903 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859, db_id: 893
2025-05-28 17:05:56,938 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 893 for interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859 on attempt 1
2025-05-28 17:05:56,943 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859, db_id: 357
2025-05-28 17:05:56,945 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'c4470821-3b16-4cd8-a1e5-aa13826ee859', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1760, 'completion_tokens': 85, 'total_tokens': 1845, 'timestamp': '2025-05-28T12:05:56.890708+00:00'}
2025-05-28 17:05:56,945 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859
2025-05-28 17:05:56,947 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 893 for interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859 on attempt 1
2025-05-28 17:05:56,950 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859, db_id: 358
2025-05-28 17:05:56,952 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'c4470821-3b16-4cd8-a1e5-aa13826ee859', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'rewrite_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 2538, 'completion_tokens': 46, 'total_tokens': 2584, 'timestamp': '2025-05-28T12:05:54.245404+00:00'}
2025-05-28 17:05:56,952 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859
2025-05-28 17:05:56,953 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 893 for interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859 on attempt 1
2025-05-28 17:05:56,955 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859, db_id: 359
2025-05-28 17:05:56,958 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'c4470821-3b16-4cd8-a1e5-aa13826ee859', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'grading_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 191, 'completion_tokens': 6, 'total_tokens': 197, 'timestamp': '2025-05-28T12:05:52.456390+00:00'}
2025-05-28 17:05:56,958 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859
2025-05-28 17:05:56,958 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 893 for interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859 on attempt 1
2025-05-28 17:05:56,961 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: c4470821-3b16-4cd8-a1e5-aa13826ee859, db_id: 360
2025-05-28 17:08:33,841 - INFO - app.api.routers.sse_api - sse_api - send_message_to_agent - 156 - Message published to agent:agent_airsoft_0faa9616:input for agent agent_airsoft_0faa9616, thread debug_test_thread_001
2025-05-28 17:08:33,841 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: debug_test_thread_001
2025-05-28 17:08:33,842 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: debug_test_thread_001, InteractionID: ac39eabd-2812-40ee-8978-4dec0a341a08)
2025-05-28 17:08:33,843 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 17:08:33,843 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 423 - Thread 'debug_test_thread_001' not found in cache 'agent_threads:agent_airsoft_0faa9616'. Loading history from DB with depth 20.
2025-05-28 17:08:33,853 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 433 - Loaded 1 messages from DB for thread 'debug_test_thread_001'.
2025-05-28 17:08:33,853 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: ac39eabd-2812-40ee-8978-4dec0a341a08, db_id: 894
2025-05-28 17:08:33,854 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 436 - Added thread 'debug_test_thread_001' to cache 'agent_threads:agent_airsoft_0faa9616'.
2025-05-28 17:08:33,854 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: debug_test_thread_001 (Initial history messages: 1)
2025-05-28 17:08:33,862 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 17:08:33,863 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:08:33,893 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 17:08:33,897 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 17:08:35,072 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 17:08:39,165 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Для миграции на Управление Торговлей 11 (УТ11) обычно используется специальный инструмент миграции, 
2025-05-28 17:08:39,165 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_79b79be41f'}
2025-05-28 17:08:39,165 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 383, 'output_tokens': 252, 'total_tokens': 635, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 17:08:39,165 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:383 C:252 T:635
2025-05-28 17:08:39,165 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 635 tokens recorded.
2025-05-28 17:08:39,166 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 17:08:39,166 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 17:08:39,167 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Для миграции на Управление Торговлей 11 (УТ11) обычно используется специальный инструмент миграции, ...
2025-05-28 17:08:39,168 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: debug_test_thread_001, InteractionID: ac39eabd-2812-40ee-8978-4dec0a341a08)
2025-05-28 17:08:39,169 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 1 token usage events for InteractionID: ac39eabd-2812-40ee-8978-4dec0a341a08.
2025-05-28 17:08:39,173 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'ac39eabd-2812-40ee-8978-4dec0a341a08', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': 'debug_test_thread_001', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 383, 'completion_tokens': 252, 'total_tokens': 635, 'timestamp': '2025-05-28T12:08:39.165286+00:00'}
2025-05-28 17:08:39,173 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: ac39eabd-2812-40ee-8978-4dec0a341a08
2025-05-28 17:08:39,176 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: ac39eabd-2812-40ee-8978-4dec0a341a08, db_id: 895
2025-05-28 17:08:39,177 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 895 for interaction_id: ac39eabd-2812-40ee-8978-4dec0a341a08 on attempt 1
2025-05-28 17:08:39,183 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: ac39eabd-2812-40ee-8978-4dec0a341a08, db_id: 361
2025-05-28 17:10:23,574 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 17:10:23,584 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 17:13:13,429 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:13:13,430 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:13:13,430 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:13:13,432 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4455495056) was cancelled.
2025-05-28 17:13:13,432 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4455495056) stopping. Performing cleanup...
2025-05-28 17:13:13,432 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:13:13,437 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:13:13,438 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:13:13,438 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:13:13,438 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:13:13,438 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:13:13,438 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4455495056) cleanup complete.
2025-05-28 17:13:13,438 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:13:13,438 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:13:13,438 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4456151760) was cancelled.
2025-05-28 17:13:13,438 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4456151760) stopping. Performing cleanup...
2025-05-28 17:13:13,438 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:13:13,443 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:13:13,444 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:13:13,444 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:13:13,444 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:13:13,444 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:13:13,444 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4456151760) cleanup complete.
2025-05-28 17:13:13,444 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:13:13,444 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:13:13,445 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4456151904) was cancelled.
2025-05-28 17:13:13,445 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4456151904) stopping. Performing cleanup...
2025-05-28 17:13:13,445 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:13:13,445 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:13:13,445 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:13:13,445 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:13:13,445 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:13:13,447 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:13:13,448 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:13:13,448 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:13:13,448 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:13:13,449 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:13:13,449 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:13:13,449 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4456151904) cleanup complete.
2025-05-28 17:13:13,449 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:13:13,449 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:13:13,449 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:13:13,468 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:13:13,469 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:13:14,006 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:13:14,007 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:13:14,012 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:13:14,012 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:13:14,012 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:13:14,012 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:13:14,012 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:13:14,012 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:13:14,012 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:13:14,012 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:13:14,012 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:13:14,013 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:13:14,013 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:13:14,015 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:13:14,015 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:13:14,015 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:13:14,016 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:13:14,016 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:13:14,016 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:13:14,016 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:13:14,017 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:13:14,018 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:13:14,018 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4415219296) setup complete. Starting run loop.
2025-05-28 17:13:14,018 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:13:14,018 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:13:14,018 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4416305536) setup complete. Starting run loop.
2025-05-28 17:13:14,018 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:13:14,020 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:13:14,020 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:13:14,065 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:13:14,066 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:13:14,066 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:13:14,067 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:13:14,067 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:13:14,067 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:13:14,068 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:13:14,068 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:13:14,068 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:13:14,068 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:13:24,021 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:13:24,026 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:13:24,026 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4416306496) setup complete. Starting run loop.
2025-05-28 17:13:24,026 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:18:24,208 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 17:18:24,218 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 17:21:36,854 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:21:36,855 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:21:36,855 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:21:36,855 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4415219296) was cancelled.
2025-05-28 17:21:36,855 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4415219296) stopping. Performing cleanup...
2025-05-28 17:21:36,855 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:21:36,860 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:21:36,861 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:21:36,861 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:21:36,862 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:21:36,862 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:21:36,862 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4415219296) cleanup complete.
2025-05-28 17:21:36,862 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:21:36,862 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:21:36,862 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4416305536) was cancelled.
2025-05-28 17:21:36,862 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4416305536) stopping. Performing cleanup...
2025-05-28 17:21:36,862 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:21:36,866 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:21:36,867 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:21:36,867 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:21:36,867 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:21:36,867 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:21:36,867 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4416305536) cleanup complete.
2025-05-28 17:21:36,867 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:21:36,867 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:21:36,867 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4416306496) was cancelled.
2025-05-28 17:21:36,867 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4416306496) stopping. Performing cleanup...
2025-05-28 17:21:36,867 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:21:36,867 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:21:36,868 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:21:36,868 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:21:36,868 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:21:36,869 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:21:36,870 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:21:36,870 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:21:36,871 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:21:36,871 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:21:36,871 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:21:36,871 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4416306496) cleanup complete.
2025-05-28 17:21:36,871 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:21:36,871 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:21:36,871 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:21:36,877 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:21:36,877 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:21:37,514 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:21:37,514 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:21:37,521 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:21:37,521 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:21:37,521 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:21:37,521 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:21:37,521 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:21:37,521 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:21:37,521 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:21:37,521 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:21:37,522 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:21:37,522 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:21:37,522 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:21:37,527 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:21:37,527 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:21:37,527 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:21:37,528 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:21:37,528 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:21:37,529 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:21:37,529 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:21:37,531 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:21:37,532 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:21:37,533 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4619973552) setup complete. Starting run loop.
2025-05-28 17:21:37,534 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:21:37,534 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:21:37,534 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4629924656) setup complete. Starting run loop.
2025-05-28 17:21:37,534 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:21:37,535 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:21:37,535 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:21:37,594 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:21:37,594 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:21:37,595 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:21:37,595 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:21:37,595 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:21:37,596 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:21:37,597 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:21:37,597 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:21:37,597 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:21:37,597 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:21:47,535 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:21:47,540 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:21:47,540 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4629735056) setup complete. Starting run loop.
2025-05-28 17:21:47,541 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:26:47,780 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 17:26:47,793 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 17:31:48,010 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 17:31:48,019 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 17:36:48,391 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 17:36:48,402 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 17:40:18,826 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:40:18,827 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:40:18,827 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:40:18,827 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4619973552) was cancelled.
2025-05-28 17:40:18,827 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4619973552) stopping. Performing cleanup...
2025-05-28 17:40:18,827 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:40:18,832 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:40:18,833 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:40:18,833 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:40:18,833 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:40:18,833 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:40:18,834 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4619973552) cleanup complete.
2025-05-28 17:40:18,834 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:40:18,834 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:40:18,834 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4629924656) was cancelled.
2025-05-28 17:40:18,834 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4629924656) stopping. Performing cleanup...
2025-05-28 17:40:18,834 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:40:18,837 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:40:18,838 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:40:18,838 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:40:18,838 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:40:18,838 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:40:18,838 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4629924656) cleanup complete.
2025-05-28 17:40:18,838 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:40:18,838 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:40:18,838 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4629735056) was cancelled.
2025-05-28 17:40:18,838 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4629735056) stopping. Performing cleanup...
2025-05-28 17:40:18,838 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:40:18,838 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:40:18,838 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:40:18,838 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:40:18,838 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:40:18,842 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:40:18,842 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:40:18,842 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:40:18,843 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:40:18,843 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:40:18,843 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:40:18,843 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4629735056) cleanup complete.
2025-05-28 17:40:18,843 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:40:18,843 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:40:18,843 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:40:18,851 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:40:18,851 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:40:19,331 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:40:19,331 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:40:19,337 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:40:19,337 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:40:19,337 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:40:19,337 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:40:19,337 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:40:19,337 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:40:19,337 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:40:19,337 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:40:19,338 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:40:19,338 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:40:19,338 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:40:19,340 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:40:19,341 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:40:19,341 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:40:19,341 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:40:19,341 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:40:19,341 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:40:19,341 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:40:19,343 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:40:19,344 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:40:19,344 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4381161568) setup complete. Starting run loop.
2025-05-28 17:40:19,344 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:40:19,345 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:40:19,345 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4381293360) setup complete. Starting run loop.
2025-05-28 17:40:19,346 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:40:19,347 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:40:19,347 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:40:19,393 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:40:19,393 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:40:19,394 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:40:19,394 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:40:19,394 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:40:19,395 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:40:19,396 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:40:19,396 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:40:19,397 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:40:19,397 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:40:29,348 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:40:29,353 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:40:29,353 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4381282416) setup complete. Starting run loop.
2025-05-28 17:40:29,353 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:41:11,461 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:41:11,461 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:41:11,461 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:41:11,462 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4381161568) was cancelled.
2025-05-28 17:41:11,462 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4381161568) stopping. Performing cleanup...
2025-05-28 17:41:11,462 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:41:11,466 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:41:11,467 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:41:11,467 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:41:11,467 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:41:11,467 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:41:11,467 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4381161568) cleanup complete.
2025-05-28 17:41:11,467 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:41:11,468 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:41:11,468 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4381293360) was cancelled.
2025-05-28 17:41:11,468 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4381293360) stopping. Performing cleanup...
2025-05-28 17:41:11,468 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:41:11,471 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:41:11,472 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:41:11,472 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:41:11,472 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:41:11,472 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:41:11,472 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4381293360) cleanup complete.
2025-05-28 17:41:11,472 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:41:11,472 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:41:11,472 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4381282416) was cancelled.
2025-05-28 17:41:11,472 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4381282416) stopping. Performing cleanup...
2025-05-28 17:41:11,472 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:41:11,472 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:41:11,472 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:41:11,472 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:41:11,472 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:41:11,474 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:41:11,475 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:41:11,475 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:41:11,475 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:41:11,475 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:41:11,475 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:41:11,475 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4381282416) cleanup complete.
2025-05-28 17:41:11,475 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:41:11,475 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:41:11,475 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:41:11,481 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:41:11,481 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:41:11,980 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:41:11,980 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:41:11,985 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:41:11,985 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:41:11,985 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:41:11,985 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:41:11,985 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:41:11,985 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:41:11,985 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:41:11,986 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:41:11,986 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:41:11,986 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:41:11,986 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:41:11,988 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:41:11,988 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:41:11,988 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:41:11,988 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:41:11,988 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:41:11,988 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:41:11,988 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:41:11,990 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:41:11,990 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4436255968) setup complete. Starting run loop.
2025-05-28 17:41:11,990 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:41:11,990 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:41:11,992 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:41:11,993 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4432449840) setup complete. Starting run loop.
2025-05-28 17:41:11,993 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:41:11,994 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:41:11,994 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:41:12,060 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:41:12,060 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:41:12,062 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:41:12,062 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:41:12,062 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:41:12,063 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:41:12,064 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:41:12,064 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:41:12,064 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:41:12,064 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:41:21,996 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:41:22,000 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:41:22,000 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4437605072) setup complete. Starting run loop.
2025-05-28 17:41:22,000 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:42:06,202 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:42:06,203 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:42:06,203 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:42:06,204 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4436255968) was cancelled.
2025-05-28 17:42:06,204 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4436255968) stopping. Performing cleanup...
2025-05-28 17:42:06,204 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:06,209 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:42:06,210 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:42:06,210 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:06,210 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:42:06,210 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:06,210 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4436255968) cleanup complete.
2025-05-28 17:42:06,211 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:42:06,211 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:42:06,211 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4432449840) was cancelled.
2025-05-28 17:42:06,211 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4432449840) stopping. Performing cleanup...
2025-05-28 17:42:06,211 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:06,215 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:42:06,215 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:42:06,215 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:06,216 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:42:06,216 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:06,216 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4432449840) cleanup complete.
2025-05-28 17:42:06,216 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:42:06,216 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:42:06,216 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4437605072) was cancelled.
2025-05-28 17:42:06,216 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4437605072) stopping. Performing cleanup...
2025-05-28 17:42:06,216 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:42:06,216 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:06,216 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:06,216 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:42:06,216 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:06,219 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:42:06,220 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:42:06,220 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:06,220 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:42:06,220 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:06,220 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:42:06,220 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4437605072) cleanup complete.
2025-05-28 17:42:06,220 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:42:06,220 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:42:06,220 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:42:06,231 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:42:06,231 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:42:06,722 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:42:06,722 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:42:06,728 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:42:06,728 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:42:06,728 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:42:06,728 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:42:06,728 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:42:06,728 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:42:06,728 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:42:06,728 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:42:06,729 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:42:06,729 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:42:06,729 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:42:06,730 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:42:06,732 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:42:06,732 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:42:06,732 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:42:06,732 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:42:06,732 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:42:06,732 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:42:06,733 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:42:06,733 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4421548848) setup complete. Starting run loop.
2025-05-28 17:42:06,733 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:42:06,734 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:42:06,734 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:42:06,734 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4421539248) setup complete. Starting run loop.
2025-05-28 17:42:06,735 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:42:06,736 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:42:06,736 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:42:06,785 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:42:06,785 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:42:06,786 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:06,786 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:42:06,786 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:42:06,787 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:06,788 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:06,788 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:06,788 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:42:06,788 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:42:16,736 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:42:16,742 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:42:16,743 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4309332480) setup complete. Starting run loop.
2025-05-28 17:42:16,743 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:42:19,674 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:42:19,674 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:42:19,674 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:42:19,674 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4421548848) was cancelled.
2025-05-28 17:42:19,674 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4421548848) stopping. Performing cleanup...
2025-05-28 17:42:19,674 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:19,680 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:42:19,681 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:42:19,681 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:19,681 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:42:19,681 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:19,681 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4421548848) cleanup complete.
2025-05-28 17:42:19,681 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:42:19,681 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:42:19,681 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4421539248) was cancelled.
2025-05-28 17:42:19,681 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4421539248) stopping. Performing cleanup...
2025-05-28 17:42:19,681 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:19,684 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:42:19,685 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:42:19,685 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:19,685 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:42:19,685 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:19,685 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4421539248) cleanup complete.
2025-05-28 17:42:19,685 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:42:19,685 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:42:19,685 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4309332480) was cancelled.
2025-05-28 17:42:19,685 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4309332480) stopping. Performing cleanup...
2025-05-28 17:42:19,685 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:42:19,685 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:19,685 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:19,686 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:42:19,686 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:19,688 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:42:19,689 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:42:19,689 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:19,689 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:42:19,689 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:19,689 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:42:19,689 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4309332480) cleanup complete.
2025-05-28 17:42:19,689 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:42:19,689 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:42:19,689 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:42:19,695 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:42:19,695 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:42:20,187 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:42:20,187 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:42:20,191 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:42:20,191 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:42:20,191 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:42:20,191 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:42:20,191 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:42:20,191 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:42:20,191 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:42:20,191 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:42:20,192 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:42:20,192 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:42:20,192 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:42:20,197 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:42:20,197 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:42:20,197 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:42:20,199 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:42:20,199 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:42:20,199 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:42:20,199 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:42:20,202 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:42:20,202 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4581313952) setup complete. Starting run loop.
2025-05-28 17:42:20,202 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:42:20,202 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:42:20,203 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:42:20,203 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4405370352) setup complete. Starting run loop.
2025-05-28 17:42:20,203 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:42:20,205 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:42:20,205 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:42:20,256 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:42:20,256 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:42:20,257 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:20,258 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:42:20,258 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:42:20,258 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:20,259 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:20,259 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:20,259 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:42:20,259 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:42:30,206 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:42:30,210 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:42:30,210 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4581980400) setup complete. Starting run loop.
2025-05-28 17:42:30,210 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:42:33,439 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:42:33,439 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:42:33,439 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:42:33,439 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4581313952) was cancelled.
2025-05-28 17:42:33,439 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4581313952) stopping. Performing cleanup...
2025-05-28 17:42:33,439 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:33,445 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:42:33,446 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:42:33,446 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:33,446 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:42:33,446 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:33,446 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4581313952) cleanup complete.
2025-05-28 17:42:33,446 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:42:33,446 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:42:33,446 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4405370352) was cancelled.
2025-05-28 17:42:33,446 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4405370352) stopping. Performing cleanup...
2025-05-28 17:42:33,446 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:33,449 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:42:33,450 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:42:33,450 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:33,450 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:42:33,450 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:33,450 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4405370352) cleanup complete.
2025-05-28 17:42:33,450 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:42:33,450 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:42:33,450 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4581980400) was cancelled.
2025-05-28 17:42:33,451 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4581980400) stopping. Performing cleanup...
2025-05-28 17:42:33,451 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:42:33,451 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:33,451 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:33,451 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:42:33,451 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:33,452 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:42:33,453 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:42:33,453 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:33,453 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:42:33,453 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:33,453 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:42:33,453 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4581980400) cleanup complete.
2025-05-28 17:42:33,453 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:42:33,453 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:42:33,454 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:42:33,460 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:42:33,460 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:42:33,886 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:42:33,886 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:42:33,891 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:42:33,891 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:42:33,891 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:42:33,891 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:42:33,891 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:42:33,891 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:42:33,891 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:42:33,891 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:42:33,892 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:42:33,892 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:42:33,892 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:42:33,894 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:42:33,894 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:42:33,894 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:42:33,895 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:42:33,895 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:42:33,895 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:42:33,896 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:42:33,896 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:42:33,897 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:42:33,897 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4436998768) setup complete. Starting run loop.
2025-05-28 17:42:33,897 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:42:33,897 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:42:33,897 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4436999344) setup complete. Starting run loop.
2025-05-28 17:42:33,897 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:42:33,899 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:42:33,899 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:42:33,941 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:42:33,941 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:42:33,941 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:33,942 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:42:33,942 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:42:33,942 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:33,943 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:33,943 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:33,943 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:42:33,943 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:42:35,350 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:42:35,350 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:42:35,350 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:42:35,351 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4436999344) was cancelled.
2025-05-28 17:42:35,351 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4436999344) stopping. Performing cleanup...
2025-05-28 17:42:35,351 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:35,355 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:42:35,356 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:42:35,356 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:35,357 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:42:35,357 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:35,357 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4436999344) cleanup complete.
2025-05-28 17:42:35,357 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:42:35,357 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:42:35,357 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4436998768) was cancelled.
2025-05-28 17:42:35,357 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4436998768) stopping. Performing cleanup...
2025-05-28 17:42:35,357 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:35,361 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:42:35,361 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:42:35,361 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:35,362 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:42:35,362 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:35,362 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4436998768) cleanup complete.
2025-05-28 17:42:35,362 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:42:35,362 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:42:35,362 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4436999104) was cancelled.
2025-05-28 17:42:35,362 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4436999104) stopping. Performing cleanup...
2025-05-28 17:42:35,363 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:42:35,363 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:35,363 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:35,363 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:42:35,363 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:35,365 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:42:35,365 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:42:35,365 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:35,366 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:42:35,366 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:35,366 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:42:35,366 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4436999104) cleanup complete.
2025-05-28 17:42:35,366 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:42:35,366 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:42:35,366 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:42:35,369 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:42:35,369 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:42:35,726 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:42:35,726 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:42:35,730 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:42:35,730 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:42:35,730 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:42:35,731 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:42:35,731 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:42:35,731 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:42:35,731 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:42:35,731 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:42:35,731 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:42:35,731 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:42:35,732 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:42:35,734 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:42:35,734 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:42:35,735 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:42:35,735 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:42:35,735 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:42:35,736 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:42:35,736 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:42:35,737 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:42:35,737 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:42:35,737 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4329823728) setup complete. Starting run loop.
2025-05-28 17:42:35,738 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:42:35,738 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:42:35,738 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4386945696) setup complete. Starting run loop.
2025-05-28 17:42:35,738 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:42:35,739 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:42:35,739 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:42:35,782 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:42:35,782 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:42:35,784 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:35,784 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:42:35,784 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:42:35,785 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:35,786 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:35,786 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:35,786 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:42:35,787 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:42:44,547 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:42:44,547 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:42:44,547 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:42:44,547 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4329823728) was cancelled.
2025-05-28 17:42:44,547 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4329823728) stopping. Performing cleanup...
2025-05-28 17:42:44,547 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:44,555 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:42:44,556 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:42:44,556 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:44,556 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:42:44,556 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:44,556 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4329823728) cleanup complete.
2025-05-28 17:42:44,556 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:42:44,556 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:42:44,556 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4386945696) was cancelled.
2025-05-28 17:42:44,556 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4386945696) stopping. Performing cleanup...
2025-05-28 17:42:44,556 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:44,559 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:42:44,560 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:42:44,560 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:44,560 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:42:44,560 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:44,561 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4386945696) cleanup complete.
2025-05-28 17:42:44,561 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:42:44,561 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:42:44,561 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4386945600) was cancelled.
2025-05-28 17:42:44,561 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4386945600) stopping. Performing cleanup...
2025-05-28 17:42:44,561 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:42:44,561 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:44,561 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:44,561 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:42:44,561 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:42:44,564 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:42:44,565 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:42:44,565 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:44,565 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:42:44,565 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:42:44,565 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:42:44,565 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4386945600) cleanup complete.
2025-05-28 17:42:44,565 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:42:44,565 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:42:44,565 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:42:44,568 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:42:44,568 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:42:44,937 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:42:44,937 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:42:44,942 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:42:44,942 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:42:44,942 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:42:44,942 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:42:44,942 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:42:44,942 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:42:44,942 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:42:44,942 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:42:44,943 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:42:44,943 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:42:44,943 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:42:44,945 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:42:44,945 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:42:44,945 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:42:44,947 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:42:44,947 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:42:44,948 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:42:44,948 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:42:44,949 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:42:44,949 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:42:44,949 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4456152240) setup complete. Starting run loop.
2025-05-28 17:42:44,949 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:42:44,949 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:42:44,949 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4456151664) setup complete. Starting run loop.
2025-05-28 17:42:44,949 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:42:44,951 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:42:44,951 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:42:45,000 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:42:45,000 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:42:45,001 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:45,001 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:42:45,001 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:42:45,002 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:42:45,003 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:42:45,003 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:42:45,004 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:42:45,004 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:42:54,952 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:42:54,957 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:42:54,957 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4456152000) setup complete. Starting run loop.
2025-05-28 17:42:54,957 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:43:10,869 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:43:10,870 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:43:10,870 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:43:10,870 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4456152240) was cancelled.
2025-05-28 17:43:10,870 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4456152240) stopping. Performing cleanup...
2025-05-28 17:43:10,870 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:10,876 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:43:10,877 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:43:10,877 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:10,877 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:43:10,877 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:10,878 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4456152240) cleanup complete.
2025-05-28 17:43:10,878 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:43:10,878 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:43:10,878 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4456151664) was cancelled.
2025-05-28 17:43:10,878 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4456151664) stopping. Performing cleanup...
2025-05-28 17:43:10,878 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:10,883 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:43:10,884 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:43:10,885 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:10,885 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:43:10,885 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:10,885 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4456151664) cleanup complete.
2025-05-28 17:43:10,885 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:43:10,885 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:43:10,886 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4456152000) was cancelled.
2025-05-28 17:43:10,886 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4456152000) stopping. Performing cleanup...
2025-05-28 17:43:10,886 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:43:10,886 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:10,886 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:43:10,886 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:43:10,886 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:10,889 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:43:10,890 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:43:10,890 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:10,890 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:43:10,890 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:10,890 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:43:10,890 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4456152000) cleanup complete.
2025-05-28 17:43:10,891 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:43:10,891 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:43:10,891 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:43:10,897 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:43:10,897 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:43:11,343 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:43:11,343 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:43:11,348 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:43:11,348 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:43:11,348 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:43:11,348 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:43:11,348 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:43:11,348 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:43:11,348 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:43:11,348 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:43:11,349 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:43:11,349 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:43:11,349 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:43:11,353 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:43:11,353 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:43:11,353 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:43:11,353 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:43:11,353 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:43:11,353 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:43:11,353 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:43:11,355 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:43:11,355 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:43:11,355 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4605455312) setup complete. Starting run loop.
2025-05-28 17:43:11,355 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:43:11,355 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:43:11,355 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4351644816) setup complete. Starting run loop.
2025-05-28 17:43:11,356 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:43:11,357 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:43:11,357 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:43:11,403 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:43:11,403 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:43:11,404 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:43:11,404 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:43:11,404 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:43:11,405 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:43:11,406 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:11,406 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:43:11,406 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:43:11,406 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:43:21,358 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:43:21,362 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:43:21,362 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4611325152) setup complete. Starting run loop.
2025-05-28 17:43:21,362 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:43:21,866 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:43:21,866 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:43:21,866 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:43:21,866 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4351644816) was cancelled.
2025-05-28 17:43:21,866 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4351644816) stopping. Performing cleanup...
2025-05-28 17:43:21,866 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:21,872 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:43:21,875 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:43:21,875 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:21,875 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:43:21,875 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:21,875 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4351644816) cleanup complete.
2025-05-28 17:43:21,875 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:43:21,875 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:43:21,875 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4605455312) was cancelled.
2025-05-28 17:43:21,875 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4605455312) stopping. Performing cleanup...
2025-05-28 17:43:21,875 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:21,882 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:43:21,882 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:43:21,883 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:21,883 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:43:21,883 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:21,883 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4605455312) cleanup complete.
2025-05-28 17:43:21,883 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:43:21,883 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:43:21,883 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4611325152) was cancelled.
2025-05-28 17:43:21,883 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4611325152) stopping. Performing cleanup...
2025-05-28 17:43:21,883 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:43:21,883 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:21,883 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:43:21,883 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:43:21,883 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:21,885 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:43:21,886 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:43:21,886 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:21,886 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:43:21,887 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:21,887 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:43:21,887 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4611325152) cleanup complete.
2025-05-28 17:43:21,887 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:43:21,887 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:43:21,887 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:43:21,897 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:43:21,897 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:43:22,318 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:43:22,318 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:43:22,323 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:43:22,323 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:43:22,323 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:43:22,323 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:43:22,323 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:43:22,323 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:43:22,323 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:43:22,323 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:43:22,324 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:43:22,324 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:43:22,324 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:43:22,334 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:43:22,334 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:43:22,334 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:43:22,334 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:43:22,334 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:43:22,334 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:43:22,334 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:43:22,336 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:43:22,337 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:43:22,337 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4579884304) setup complete. Starting run loop.
2025-05-28 17:43:22,337 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:43:22,337 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:43:22,337 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4579883824) setup complete. Starting run loop.
2025-05-28 17:43:22,337 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:43:22,338 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:43:22,338 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:43:22,388 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:43:22,388 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:43:22,389 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:43:22,389 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:43:22,389 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:43:22,390 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:43:22,391 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:22,391 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:43:22,391 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:43:22,391 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:43:30,742 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:43:30,742 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:43:30,742 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:43:30,743 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4579884304) was cancelled.
2025-05-28 17:43:30,743 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4579884304) stopping. Performing cleanup...
2025-05-28 17:43:30,743 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:30,746 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:43:30,747 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:43:30,747 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:30,748 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:43:30,748 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:30,748 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4579884304) cleanup complete.
2025-05-28 17:43:30,748 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:43:30,748 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:43:30,748 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4579883824) was cancelled.
2025-05-28 17:43:30,748 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4579883824) stopping. Performing cleanup...
2025-05-28 17:43:30,748 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:30,751 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:43:30,751 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:43:30,751 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:30,752 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:43:30,752 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:30,752 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4579883824) cleanup complete.
2025-05-28 17:43:30,752 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:43:30,752 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:43:30,752 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4579404464) was cancelled.
2025-05-28 17:43:30,752 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4579404464) stopping. Performing cleanup...
2025-05-28 17:43:30,752 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:43:30,752 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:30,752 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:43:30,752 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:43:30,752 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:43:30,754 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:43:30,754 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:43:30,754 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:30,755 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:43:30,755 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:43:30,755 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:43:30,755 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4579404464) cleanup complete.
2025-05-28 17:43:30,755 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:43:30,755 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:43:30,755 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:43:30,758 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:43:30,758 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:43:31,172 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:43:31,173 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:43:31,177 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:43:31,177 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:43:31,177 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:43:31,177 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:43:31,177 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:43:31,178 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:43:31,178 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:43:31,178 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:43:31,178 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:43:31,178 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:43:31,178 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:43:31,180 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:43:31,182 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:43:31,182 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:43:31,182 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:43:31,182 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:43:31,182 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:43:31,182 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:43:31,183 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:43:31,184 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:43:31,184 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4727723584) setup complete. Starting run loop.
2025-05-28 17:43:31,184 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:43:31,184 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:43:31,184 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4727733136) setup complete. Starting run loop.
2025-05-28 17:43:31,184 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:43:31,194 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:43:31,195 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:43:31,228 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:43:31,228 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:43:31,229 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:43:31,229 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:43:31,229 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:43:31,229 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:43:31,230 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:43:31,230 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:43:31,230 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:43:31,230 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:43:41,195 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:43:41,199 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:43:41,199 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4727733280) setup complete. Starting run loop.
2025-05-28 17:43:41,199 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:48:04,894 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:48:04,894 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:48:04,894 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:48:04,895 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4727723584) was cancelled.
2025-05-28 17:48:04,895 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4727723584) stopping. Performing cleanup...
2025-05-28 17:48:04,895 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:48:04,900 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:48:04,901 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:48:04,901 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:48:04,901 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:48:04,901 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:48:04,901 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4727723584) cleanup complete.
2025-05-28 17:48:04,901 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:48:04,901 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:48:04,902 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4727733136) was cancelled.
2025-05-28 17:48:04,902 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4727733136) stopping. Performing cleanup...
2025-05-28 17:48:04,902 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:48:04,905 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:48:04,906 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:48:04,906 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:48:04,906 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:48:04,906 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:48:04,906 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4727733136) cleanup complete.
2025-05-28 17:48:04,906 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:48:04,906 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:48:04,907 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4727733280) was cancelled.
2025-05-28 17:48:04,907 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4727733280) stopping. Performing cleanup...
2025-05-28 17:48:04,907 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:48:04,907 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:48:04,907 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:48:04,907 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:48:04,907 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:48:04,910 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:48:04,911 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:48:04,911 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:48:04,912 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:48:04,913 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:48:04,913 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:48:04,913 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4727733280) cleanup complete.
2025-05-28 17:48:04,913 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:48:04,913 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:48:04,913 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:48:04,924 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:48:04,924 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:48:05,417 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:48:05,417 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:48:05,423 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:48:05,423 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:48:05,423 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:48:05,423 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:48:05,423 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:48:05,423 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:48:05,423 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:48:05,423 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:48:05,424 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:48:05,424 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:48:05,424 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:48:05,426 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:48:05,427 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:48:05,427 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:48:05,427 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:48:05,427 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:48:05,427 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:48:05,427 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:48:05,428 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:48:05,429 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:48:05,429 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4423759248) setup complete. Starting run loop.
2025-05-28 17:48:05,429 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:48:05,430 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:48:05,430 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4424415760) setup complete. Starting run loop.
2025-05-28 17:48:05,430 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:48:05,432 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:48:05,432 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:48:05,479 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:48:05,479 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:48:05,480 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:48:05,480 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:48:05,480 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:48:05,481 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:48:05,481 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:48:05,481 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:48:05,481 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:48:05,481 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:48:15,432 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:48:15,436 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:48:15,436 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4424415904) setup complete. Starting run loop.
2025-05-28 17:48:15,436 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:49:16,839 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:49:16,840 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:49:16,840 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:49:16,840 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4423759248) was cancelled.
2025-05-28 17:49:16,840 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4423759248) stopping. Performing cleanup...
2025-05-28 17:49:16,840 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:49:16,845 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:49:16,846 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:49:16,846 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:49:16,846 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:49:16,846 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:49:16,846 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4423759248) cleanup complete.
2025-05-28 17:49:16,846 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:49:16,846 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:49:16,847 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4424415760) was cancelled.
2025-05-28 17:49:16,847 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4424415760) stopping. Performing cleanup...
2025-05-28 17:49:16,847 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:49:16,850 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:49:16,850 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:49:16,850 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:49:16,851 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:49:16,851 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:49:16,851 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4424415760) cleanup complete.
2025-05-28 17:49:16,851 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:49:16,851 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:49:16,851 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4424415904) was cancelled.
2025-05-28 17:49:16,851 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4424415904) stopping. Performing cleanup...
2025-05-28 17:49:16,851 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:49:16,851 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:49:16,851 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:49:16,851 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:49:16,851 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:49:16,853 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:49:16,854 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:49:16,854 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:49:16,854 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:49:16,854 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:49:16,854 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:49:16,854 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4424415904) cleanup complete.
2025-05-28 17:49:16,854 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:49:16,854 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:49:16,854 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:49:16,859 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:49:16,859 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:49:17,354 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:49:17,355 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:49:17,360 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:49:17,360 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:49:17,360 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:49:17,360 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:49:17,360 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:49:17,361 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:49:17,361 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:49:17,361 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:49:17,361 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:49:17,361 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:49:17,361 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:49:17,363 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:49:17,363 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:49:17,363 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:49:17,364 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:49:17,364 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:49:17,365 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:49:17,365 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:49:17,365 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:49:17,365 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4368519040) setup complete. Starting run loop.
2025-05-28 17:49:17,365 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:49:17,365 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:49:17,366 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:49:17,366 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4370380800) setup complete. Starting run loop.
2025-05-28 17:49:17,366 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:49:17,369 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:49:17,369 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:49:17,415 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:49:17,415 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:49:17,416 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:49:17,416 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:49:17,416 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:49:17,417 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:49:17,418 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:49:17,418 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:49:17,418 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:49:17,418 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:49:27,368 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:49:27,373 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:49:27,373 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4371036352) setup complete. Starting run loop.
2025-05-28 17:49:27,373 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:50:21,420 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:50:21,420 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:50:21,420 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:50:21,420 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4368519040) was cancelled.
2025-05-28 17:50:21,420 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4368519040) stopping. Performing cleanup...
2025-05-28 17:50:21,420 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:21,425 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:50:21,426 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:50:21,426 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:21,426 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:50:21,426 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:21,426 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4368519040) cleanup complete.
2025-05-28 17:50:21,426 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:50:21,426 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:50:21,426 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4370380800) was cancelled.
2025-05-28 17:50:21,426 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4370380800) stopping. Performing cleanup...
2025-05-28 17:50:21,427 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:21,430 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:50:21,431 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:50:21,431 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:21,431 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:50:21,431 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:21,431 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4370380800) cleanup complete.
2025-05-28 17:50:21,431 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:50:21,431 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:50:21,432 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4371036352) was cancelled.
2025-05-28 17:50:21,432 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4371036352) stopping. Performing cleanup...
2025-05-28 17:50:21,432 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:50:21,432 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:21,432 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:50:21,432 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:50:21,432 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:21,434 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:50:21,435 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:50:21,435 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:21,435 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:50:21,435 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:21,435 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:50:21,435 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4371036352) cleanup complete.
2025-05-28 17:50:21,435 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:50:21,435 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:50:21,435 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:50:21,439 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:50:21,439 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:50:21,918 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:50:21,918 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:50:21,924 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:50:21,924 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:50:21,924 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:50:21,924 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:50:21,924 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:50:21,924 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:50:21,924 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:50:21,924 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:50:21,924 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:50:21,925 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:50:21,925 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:50:21,926 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:50:21,926 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:50:21,926 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:50:21,927 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:50:21,927 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:50:21,928 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:50:21,928 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:50:21,928 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:50:21,928 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4404159136) setup complete. Starting run loop.
2025-05-28 17:50:21,928 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:50:21,929 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:50:21,930 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:50:21,930 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4417911888) setup complete. Starting run loop.
2025-05-28 17:50:21,930 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:50:21,930 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:50:21,930 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:50:21,973 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:50:21,973 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:50:21,974 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:50:21,974 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:50:21,974 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:50:21,975 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:50:21,976 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:21,976 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:50:21,976 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:50:21,976 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:50:31,931 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:50:31,936 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:50:31,936 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4417900752) setup complete. Starting run loop.
2025-05-28 17:50:31,936 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:50:51,669 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:50:51,669 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:50:51,669 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:50:51,669 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4404159136) was cancelled.
2025-05-28 17:50:51,669 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4404159136) stopping. Performing cleanup...
2025-05-28 17:50:51,669 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:51,673 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:50:51,674 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:50:51,674 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:51,674 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:50:51,674 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:51,674 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4404159136) cleanup complete.
2025-05-28 17:50:51,674 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:50:51,674 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:50:51,674 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4417911888) was cancelled.
2025-05-28 17:50:51,674 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4417911888) stopping. Performing cleanup...
2025-05-28 17:50:51,674 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:51,678 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:50:51,681 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:50:51,681 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:51,681 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:50:51,681 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:51,681 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4417911888) cleanup complete.
2025-05-28 17:50:51,681 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:50:51,681 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:50:51,681 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4417900752) was cancelled.
2025-05-28 17:50:51,682 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4417900752) stopping. Performing cleanup...
2025-05-28 17:50:51,682 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:50:51,682 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:51,682 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:50:51,682 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:50:51,683 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:51,686 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:50:51,687 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:50:51,687 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:51,687 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:50:51,687 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:51,687 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:50:51,687 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4417900752) cleanup complete.
2025-05-28 17:50:51,687 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:50:51,687 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:50:51,687 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:50:51,692 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:50:51,692 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:50:52,173 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:50:52,173 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:50:52,179 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:50:52,179 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:50:52,179 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:50:52,179 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:50:52,179 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:50:52,180 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:50:52,180 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:50:52,180 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:50:52,180 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:50:52,180 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:50:52,180 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:50:52,183 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:50:52,185 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:50:52,185 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:50:52,185 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:50:52,185 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:50:52,185 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:50:52,185 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:50:52,186 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:50:52,186 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4414294928) setup complete. Starting run loop.
2025-05-28 17:50:52,186 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:50:52,186 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:50:52,187 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:50:52,187 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4414004288) setup complete. Starting run loop.
2025-05-28 17:50:52,187 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:50:52,188 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:50:52,188 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:50:52,234 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:50:52,234 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:50:52,235 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:50:52,235 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:50:52,235 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:50:52,237 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:50:52,237 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:52,237 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:50:52,237 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:50:52,237 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:50:59,982 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:50:59,982 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:50:59,982 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:50:59,982 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4414294928) was cancelled.
2025-05-28 17:50:59,982 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4414294928) stopping. Performing cleanup...
2025-05-28 17:50:59,982 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:59,987 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:50:59,988 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:50:59,988 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:59,988 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:50:59,988 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:59,988 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4414294928) cleanup complete.
2025-05-28 17:50:59,988 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:50:59,988 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:50:59,988 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4414004288) was cancelled.
2025-05-28 17:50:59,988 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4414004288) stopping. Performing cleanup...
2025-05-28 17:50:59,988 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:59,991 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:50:59,992 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:50:59,992 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:59,992 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:50:59,992 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:59,992 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4414004288) cleanup complete.
2025-05-28 17:50:59,992 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:50:59,993 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:50:59,993 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4577358912) was cancelled.
2025-05-28 17:50:59,993 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4577358912) stopping. Performing cleanup...
2025-05-28 17:50:59,993 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:50:59,993 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:59,993 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:50:59,993 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:50:59,993 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:50:59,994 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:50:59,995 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:50:59,995 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:50:59,995 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:50:59,995 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:50:59,995 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:50:59,995 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4577358912) cleanup complete.
2025-05-28 17:50:59,995 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:50:59,995 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:50:59,996 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:51:00,000 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:51:00,000 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:51:00,409 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:51:00,409 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:51:00,414 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:51:00,414 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:51:00,414 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:51:00,414 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:51:00,414 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:51:00,414 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:51:00,414 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:51:00,414 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:51:00,415 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:51:00,415 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:51:00,415 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:51:00,417 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:51:00,418 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:51:00,418 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:51:00,418 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:51:00,418 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:51:00,419 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:51:00,419 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:51:00,420 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:51:00,420 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:51:00,420 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4450132304) setup complete. Starting run loop.
2025-05-28 17:51:00,420 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:51:00,421 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:51:00,421 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4449826480) setup complete. Starting run loop.
2025-05-28 17:51:00,421 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:51:00,431 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:51:00,431 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:51:00,467 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:51:00,467 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:51:00,468 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:51:00,468 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:51:00,468 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:51:00,468 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:51:00,469 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:51:00,469 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:51:00,469 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:51:00,469 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:51:10,433 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:51:10,438 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:51:10,438 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4450253184) setup complete. Starting run loop.
2025-05-28 17:51:10,438 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:51:26,035 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 17:51:26,035 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 17:51:26,035 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 17:51:26,035 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4450132304) was cancelled.
2025-05-28 17:51:26,035 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4450132304) stopping. Performing cleanup...
2025-05-28 17:51:26,035 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:51:26,040 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 17:51:26,041 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 17:51:26,041 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:51:26,041 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 17:51:26,041 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:51:26,041 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4450132304) cleanup complete.
2025-05-28 17:51:26,041 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 17:51:26,041 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 17:51:26,042 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4449826480) was cancelled.
2025-05-28 17:51:26,042 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4449826480) stopping. Performing cleanup...
2025-05-28 17:51:26,042 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:51:26,045 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 17:51:26,046 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 17:51:26,046 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:51:26,046 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 17:51:26,046 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:51:26,046 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4449826480) cleanup complete.
2025-05-28 17:51:26,046 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 17:51:26,046 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 17:51:26,047 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4450253184) was cancelled.
2025-05-28 17:51:26,047 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4450253184) stopping. Performing cleanup...
2025-05-28 17:51:26,047 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 17:51:26,047 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:51:26,047 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:51:26,047 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 17:51:26,047 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 17:51:26,049 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 17:51:26,049 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 17:51:26,049 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:51:26,050 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 17:51:26,050 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 17:51:26,050 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 17:51:26,050 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4450253184) cleanup complete.
2025-05-28 17:51:26,050 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 17:51:26,050 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 17:51:26,050 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 17:51:26,055 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 17:51:26,055 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 17:51:26,473 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:51:26,473 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 17:51:26,478 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 17:51:26,478 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 17:51:26,478 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 17:51:26,478 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 17:51:26,478 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 17:51:26,478 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 17:51:26,478 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 17:51:26,478 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 17:51:26,478 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 17:51:26,479 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 17:51:26,479 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 17:51:26,480 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 17:51:26,481 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 17:51:26,481 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 17:51:26,481 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 17:51:26,481 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 17:51:26,481 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 17:51:26,481 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 17:51:26,485 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 17:51:26,485 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 17:51:26,485 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4590062048) setup complete. Starting run loop.
2025-05-28 17:51:26,485 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 17:51:26,485 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 17:51:26,485 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4590369680) setup complete. Starting run loop.
2025-05-28 17:51:26,485 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 17:51:26,485 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 17:51:26,485 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 17:51:26,535 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 17:51:26,536 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 17:51:26,536 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:51:26,536 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 17:51:26,536 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 17:51:26,537 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 17:51:26,538 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 17:51:26,538 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 17:51:26,538 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 17:51:26,538 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 17:51:36,486 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 17:51:36,491 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 17:51:36,491 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4590369584) setup complete. Starting run loop.
2025-05-28 17:51:36,491 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 17:56:36,681 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 17:56:36,691 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 17:58:19,564 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:58:33,001 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 21 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 28 - Database session factory configured for Agent.
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - __init__ - 120 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 99286
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 42 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - setup - 494 - AgentRunner setup started.
2025-05-28 17:58:33,001 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 17:58:33,007 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 17:58:33,008 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 27 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 17:58:33,104 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 17:58:33,104 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 33 - Configuration fetched successfully.
2025-05-28 17:58:33,104 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _load_config - 138 - Agent configuration loaded and prepared successfully.
2025-05-28 17:58:33,104 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 149 - Creating LangGraph application...
2025-05-28 17:58:33,104 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 913 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 17:58:33,104 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 17:58:33,130 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_main_llm - 63 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 17:58:33,131 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 818 - Creating agent graph in GraphFactory...
2025-05-28 17:58:33,131 - INFO - app.agent_runner.common.tools_registry - tools_registry - configure_tools_centralized - 364 - Configured 3 predefined tools from centralized registry
2025-05-28 17:58:33,131 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 94 - Added 3 tools from centralized registry
2025-05-28 17:58:33,131 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 114 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 17:58:33,188 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 17:58:33,192 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 17:58:34,754 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 17:58:34,757 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 132 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 17:58:34,757 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 166 - Must conditions for KB tool 'knowledgeBase-1745316404538': [FieldCondition(key='metadata.client_id', match=MatchValue(value='2'), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None), FieldCondition(key='metadata.datasource_id', match=MatchAny(any=['5', '6', '7']), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None)]
2025-05-28 17:58:34,757 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 182 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 17:58:34,757 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 190 - Using max_rewrites: 4
2025-05-28 17:58:34,757 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 217 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 17:58:34,757 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 244 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 17:58:34,757 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_tools - 153 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 17:58:34,758 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 826 - Context memory enabled: True
2025-05-28 17:58:34,758 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 834 - Added node: agent
2025-05-28 17:58:34,758 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 843 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 17:58:34,758 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 853 - Added node: safe_tools
2025-05-28 17:58:34,758 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 864 - Added edge: safe_tools -> agent
2025-05-28 17:58:34,758 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 870 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 17:58:34,759 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 877 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 17:58:34,759 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 893 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 905 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 922 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 157 - LangGraph application created successfully.
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component AgentRunner (instance: 4506535456) setup complete. Starting run loop.
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 522 - AgentRunner run_loop starting...
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AgentPubSubListener
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 1 registered main tasks.
2025-05-28 17:58:34,770 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 17:58:34,773 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:01:36,879 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:01:36,888 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:04:58,946 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:04:58,947 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:04:58,947 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:04:58,947 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4590062048) was cancelled.
2025-05-28 18:04:58,947 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4590062048) stopping. Performing cleanup...
2025-05-28 18:04:58,947 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:04:58,952 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:04:58,953 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:04:58,953 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:04:58,953 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:04:58,953 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:04:58,953 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4590062048) cleanup complete.
2025-05-28 18:04:58,954 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:04:58,954 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:04:58,954 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4590369680) was cancelled.
2025-05-28 18:04:58,954 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4590369680) stopping. Performing cleanup...
2025-05-28 18:04:58,954 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:04:58,957 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:04:58,957 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:04:58,958 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:04:58,958 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:04:58,958 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:04:58,958 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4590369680) cleanup complete.
2025-05-28 18:04:58,958 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:04:58,958 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:04:58,958 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4590369584) was cancelled.
2025-05-28 18:04:58,958 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4590369584) stopping. Performing cleanup...
2025-05-28 18:04:58,958 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:04:58,958 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:04:58,958 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:04:58,958 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:04:58,958 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:04:58,960 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:04:58,961 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:04:58,961 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:04:58,961 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:04:58,961 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:04:58,961 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:04:58,961 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4590369584) cleanup complete.
2025-05-28 18:04:58,961 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:04:58,961 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:04:58,961 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:04:58,971 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:04:58,971 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:04:59,424 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:04:59,424 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:04:59,429 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:04:59,429 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:04:59,429 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:04:59,429 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:04:59,429 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:04:59,429 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:04:59,429 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:04:59,429 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:04:59,430 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:04:59,430 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:04:59,430 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:04:59,433 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:04:59,433 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:04:59,434 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:04:59,434 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:04:59,434 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:04:59,435 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:04:59,435 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:04:59,436 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:04:59,436 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4378393584) setup complete. Starting run loop.
2025-05-28 18:04:59,436 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:04:59,436 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:04:59,437 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:04:59,437 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4377966592) setup complete. Starting run loop.
2025-05-28 18:04:59,437 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:04:59,438 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:04:59,438 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:04:59,482 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:04:59,482 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:04:59,483 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:04:59,483 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:04:59,483 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:04:59,484 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:04:59,484 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:04:59,485 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:04:59,485 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:04:59,485 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:05:01,198 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:05:01,198 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:05:01,198 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:05:01,198 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4378393584) was cancelled.
2025-05-28 18:05:01,198 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4378393584) stopping. Performing cleanup...
2025-05-28 18:05:01,198 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:05:01,203 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:05:01,204 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:05:01,204 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:01,204 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:05:01,204 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:05:01,204 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4378393584) cleanup complete.
2025-05-28 18:05:01,204 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:05:01,204 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:05:01,205 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4377966592) was cancelled.
2025-05-28 18:05:01,205 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4377966592) stopping. Performing cleanup...
2025-05-28 18:05:01,205 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:05:01,208 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:05:01,209 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:05:01,209 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:01,209 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:05:01,209 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:05:01,209 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4377966592) cleanup complete.
2025-05-28 18:05:01,209 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:05:01,209 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:05:01,209 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4378392912) was cancelled.
2025-05-28 18:05:01,209 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4378392912) stopping. Performing cleanup...
2025-05-28 18:05:01,209 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:05:01,209 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:01,209 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:05:01,209 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:05:01,209 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:05:01,211 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:05:01,212 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:05:01,212 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:01,212 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:05:01,212 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:05:01,212 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:05:01,212 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4378392912) cleanup complete.
2025-05-28 18:05:01,212 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:05:01,212 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:05:01,212 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:05:01,215 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:05:01,215 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:05:01,572 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:05:01,573 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:05:01,577 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:05:01,577 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:05:01,577 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:05:01,577 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:05:01,577 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:05:01,577 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:05:01,577 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:05:01,577 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:05:01,578 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:05:01,578 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:05:01,578 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:05:01,580 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:05:01,581 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:05:01,581 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:05:01,582 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:05:01,582 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:05:01,582 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:05:01,582 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:05:01,584 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:05:01,584 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4413400096) setup complete. Starting run loop.
2025-05-28 18:05:01,584 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:05:01,584 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:05:01,585 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:05:01,585 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4413740896) setup complete. Starting run loop.
2025-05-28 18:05:01,585 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:05:01,586 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:05:01,586 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:05:01,633 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:05:01,633 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:05:01,634 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:05:01,634 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:05:01,634 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:05:01,635 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:05:01,635 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:01,636 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:05:01,636 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:05:01,636 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:05:03,045 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:05:03,045 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:05:03,045 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:05:03,045 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4413400096) was cancelled.
2025-05-28 18:05:03,045 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4413400096) stopping. Performing cleanup...
2025-05-28 18:05:03,045 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:05:03,050 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:05:03,051 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:05:03,051 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:03,051 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:05:03,051 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:05:03,051 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4413400096) cleanup complete.
2025-05-28 18:05:03,051 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:05:03,051 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:05:03,051 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4413740896) was cancelled.
2025-05-28 18:05:03,051 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4413740896) stopping. Performing cleanup...
2025-05-28 18:05:03,051 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:05:03,055 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:05:03,056 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:05:03,056 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:03,056 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:05:03,056 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:05:03,056 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4413740896) cleanup complete.
2025-05-28 18:05:03,056 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:05:03,056 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:05:03,056 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4407434304) was cancelled.
2025-05-28 18:05:03,056 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4407434304) stopping. Performing cleanup...
2025-05-28 18:05:03,056 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:05:03,056 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:03,056 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:05:03,056 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:05:03,056 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:05:03,058 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:05:03,059 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:05:03,059 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:03,059 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:05:03,059 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:05:03,059 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:05:03,059 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4407434304) cleanup complete.
2025-05-28 18:05:03,059 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:05:03,059 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:05:03,059 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:05:03,064 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:05:03,064 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:05:03,377 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:05:03,377 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:05:03,380 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:05:03,381 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:05:03,381 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:05:03,381 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:05:03,381 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:05:03,381 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:05:03,381 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:05:03,381 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:05:03,381 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:05:03,381 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:05:03,381 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:05:03,384 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:05:03,384 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:05:03,384 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:05:03,384 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:05:03,384 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:05:03,385 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:05:03,385 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:05:03,387 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:05:03,387 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4375236480) setup complete. Starting run loop.
2025-05-28 18:05:03,387 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:05:03,387 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:05:03,388 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:05:03,388 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4377754656) setup complete. Starting run loop.
2025-05-28 18:05:03,388 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:05:03,389 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:05:03,389 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:05:03,429 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:05:03,429 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:05:03,430 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:05:03,430 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:05:03,430 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:05:03,431 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:05:03,432 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:05:03,432 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:05:03,432 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:05:03,432 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:05:13,390 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:05:13,394 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:05:13,395 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4377754800) setup complete. Starting run loop.
2025-05-28 18:05:13,395 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:08:14,056 - WARNING - aiogram.dispatcher - dispatcher - _signal_stop_polling - 455 - Received SIGINT signal
2025-05-28 18:08:14,056 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 160 - ServiceComponentBase run_loop itself was cancelled (e.g. during shutdown).
2025-05-28 18:08:14,057 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component AgentRunner (instance: 4679402944) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:08:14,057 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for AgentRunner (instance: 4679402944)...
2025-05-28 18:08:14,057 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:08:14,057 - INFO - aiogram.dispatcher - dispatcher - _polling - 359 - Polling stopped for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 18:08:14,057 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 536 - AgentRunner run_loop finished.
2025-05-28 18:08:14,058 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for AgentRunner (instance: 4679402944) was cancelled.
2025-05-28 18:08:14,058 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component AgentRunner (instance: 4679402944) stopping. Performing cleanup...
2025-05-28 18:08:14,058 - INFO - aiogram.dispatcher - dispatcher - start_polling - 554 - Polling stopped
2025-05-28 18:08:14,058 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 546 - AgentRunner cleanup started.
2025-05-28 18:08:14,058 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:08:14,059 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:input finished.
2025-05-28 18:08:14,059 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 552 - Cleared loaded threads cache 'agent_threads:agent_airsoft_0faa9616' (deleted: 1) on start/restart.
2025-05-28 18:08:14,060 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 1 main tasks.
2025-05-28 18:08:14,060 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 204 - No running main tasks to cancel.
2025-05-28 18:08:14,060 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:08:14,062 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616 as part of cleanup.
2025-05-28 18:08:14,063 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key agent_status:agent_airsoft_0faa9616 from Redis.
2025-05-28 18:08:14,063 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:14,063 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616 cleaned up Redis resources.
2025-05-28 18:08:14,063 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:08:14,063 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 581 - AgentRunner cleanup finished.
2025-05-28 18:08:14,063 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component AgentRunner (instance: 4679402944) cleanup complete.
2025-05-28 18:08:14,064 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 51 - AgentRunner for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:08:14,064 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 60 - Shutting down agent runner for agent_airsoft_0faa9616.
2025-05-28 18:08:14,075 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:08:14,075 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 63 - Database engine closed.
2025-05-28 18:08:14,075 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 66 - Agent runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:08:14,076 - INFO - __main__ - runner_main - <module> - 86 - Agent runner main finished.
2025-05-28 18:08:14,234 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:08:14,235 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:08:14,235 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:08:14,235 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4375236480) was cancelled.
2025-05-28 18:08:14,235 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4375236480) stopping. Performing cleanup...
2025-05-28 18:08:14,235 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:08:14,240 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:08:14,241 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:08:14,241 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:14,242 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:08:14,242 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:08:14,242 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4375236480) cleanup complete.
2025-05-28 18:08:14,242 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:08:14,242 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:08:14,242 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4377754656) was cancelled.
2025-05-28 18:08:14,242 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4377754656) stopping. Performing cleanup...
2025-05-28 18:08:14,242 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:08:14,245 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:08:14,246 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:08:14,246 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:14,247 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:08:14,247 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:08:14,247 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4377754656) cleanup complete.
2025-05-28 18:08:14,247 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:08:14,247 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:08:14,247 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4377754800) was cancelled.
2025-05-28 18:08:14,247 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4377754800) stopping. Performing cleanup...
2025-05-28 18:08:14,247 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:08:14,247 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:14,248 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:08:14,248 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:08:14,248 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:08:14,250 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:08:14,251 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:08:14,251 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:14,251 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:08:14,251 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:08:14,251 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:08:14,251 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4377754800) cleanup complete.
2025-05-28 18:08:14,251 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:08:14,251 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:08:14,251 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:08:14,257 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:08:14,257 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 482 - Aiogram polling has stopped.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 137 - Main task 'AiogramPolling' completed. Result: None
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 156 - A main task finished. Initiating shutdown of other tasks and component.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component TelegramIntegrationBot (instance: 4402044256) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for TelegramIntegrationBot (instance: 4402044256)...
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 494 - TelegramIntegrationBot run_loop for agent agent_airsoft_0faa9616 finishing.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for TelegramIntegrationBot (instance: 4402044256) was cancelled.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component TelegramIntegrationBot (instance: 4402044256) stopping. Performing cleanup...
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 503 - TelegramIntegrationBot cleanup started.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 516 - Closing Aiogram bot session.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 518 - Aiogram bot session closed.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 2 main tasks.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:output finished.
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'RedisOutputListener' completed during cleanup with result: None
2025-05-28 18:08:14,309 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:08:14,315 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616:telegram as part of cleanup.
2025-05-28 18:08:14,316 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key integration_status:agent_airsoft_0faa9616:telegram from Redis.
2025-05-28 18:08:14,316 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:14,316 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616:telegram cleaned up Redis resources.
2025-05-28 18:08:14,316 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:08:14,317 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 524 - TelegramIntegrationBot cleanup finished.
2025-05-28 18:08:14,317 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component TelegramIntegrationBot (instance: 4402044256) cleanup complete.
2025-05-28 18:08:14,317 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 86 - TelegramIntegrationBot for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:08:14,317 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 95 - Shutting down Telegram bot runner for agent_airsoft_0faa9616.
2025-05-28 18:08:14,322 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:08:14,322 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 98 - Database engine closed.
2025-05-28 18:08:14,322 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 101 - Telegram bot runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:08:14,324 - INFO - __main__ - telegram_bot_main - <module> - 124 - Telegram bot runner main finished.
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 160 - ServiceComponentBase run_loop itself was cancelled (e.g. during shutdown).
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component AgentRunner (instance: 4506535456) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for AgentRunner (instance: 4506535456)...
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 536 - AgentRunner run_loop finished.
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for AgentRunner (instance: 4506535456) was cancelled.
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component AgentRunner (instance: 4506535456) stopping. Performing cleanup...
2025-05-28 18:08:21,987 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 546 - AgentRunner cleanup started.
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 552 - Cleared loaded threads cache 'agent_threads:agent_airsoft_0faa9616' (deleted: 0) on start/restart.
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 1 main tasks.
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:input finished.
2025-05-28 18:08:21,989 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'AgentPubSubListener' completed during cleanup with result: None
2025-05-28 18:08:21,990 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:08:21,994 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616 as part of cleanup.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key agent_status:agent_airsoft_0faa9616 from Redis.
2025-05-28 18:08:21,995 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616 cleaned up Redis resources.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 581 - AgentRunner cleanup finished.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component AgentRunner (instance: 4506535456) cleanup complete.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 51 - AgentRunner for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:08:21,995 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 60 - Shutting down agent runner for agent_airsoft_0faa9616.
2025-05-28 18:08:21,996 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:08:21,996 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 63 - Database engine closed.
2025-05-28 18:08:21,996 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 66 - Agent runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:08:21,997 - INFO - __main__ - runner_main - <module> - 86 - Agent runner main finished.
2025-05-28 18:09:26,622 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:09:26,622 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:09:26,628 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:09:26,628 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:09:26,628 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:09:26,628 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:09:26,628 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:09:26,628 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:09:26,628 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:09:26,628 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:09:26,628 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:09:26,628 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:09:26,628 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:09:26,631 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:09:26,632 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:09:26,632 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:09:26,633 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:09:26,633 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:09:26,633 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:09:26,633 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:09:26,635 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:09:26,635 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:09:26,635 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4381985584) setup complete. Starting run loop.
2025-05-28 18:09:26,635 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:09:26,637 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:09:26,637 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:09:26,637 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:09:26,637 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4382293024) setup complete. Starting run loop.
2025-05-28 18:09:26,637 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:09:26,682 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:09:26,683 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:09:26,685 - INFO - app.services.process_manager - process_manager - start_agent_process - 880 - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 18:09:26,686 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 579
2025-05-28 18:09:26,686 - INFO - app.services.process_manager - process_manager - start_agent_process - 913 - Agent process agent_airsoft_0faa9616 initiated start with PID 579
2025-05-28 18:09:26,686 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 79 - Successfully initiated start for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 18:09:26,686 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:09:26,686 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:09:26,688 - INFO - app.services.process_manager - process_manager - start_integration_process - 554 - Attempting to start integration process for agent_airsoft_0faa9616/telegram...
2025-05-28 18:09:26,689 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [integration_start_agent_airsoft_0faa9616_telegram] Process launched without output capture. PID: 580
2025-05-28 18:09:26,689 - INFO - app.services.process_manager - process_manager - start_integration_process - 600 - Integration process telegram for agent agent_airsoft_0faa9616 initiated start with PID 580
2025-05-28 18:09:26,690 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 123 - Successfully initiated start for telegram integration for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 18:09:26,691 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:09:26,691 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:09:26,691 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:09:26,691 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:09:27,609 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:09:27,609 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 50 - Starting Telegram bot for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:09:27,609 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 57 - Database session factory configured for Telegram bot.
2025-05-28 18:09:27,609 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 18:09:27,609 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - __init__ - 56 - TelegramIntegrationBot initialized. PID: 580
2025-05-28 18:09:27,609 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 74 - Calling TelegramIntegrationBot.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:09:27,610 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 441 - TelegramIntegrationBot setup started.
2025-05-28 18:09:27,610 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 18:09:27,616 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 452 - Aiogram Bot and Dispatcher initialized.
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _register_handlers - 341 - Aiogram handlers registered.
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 456 - TelegramIntegrationBot setup complete.
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component TelegramIntegrationBot (instance: 4723776912) setup complete. Starting run loop.
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 464 - TelegramIntegrationBot run_loop started for agent agent_airsoft_0faa9616. Polling for updates...
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: RedisOutputListener
2025-05-28 18:09:27,629 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AiogramPolling
2025-05-28 18:09:27,630 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 2 registered main tasks.
2025-05-28 18:09:27,630 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:09:27,630 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 473 - Starting aiogram polling...
2025-05-28 18:09:27,630 - INFO - aiogram.dispatcher - dispatcher - start_polling - 527 - Start polling
2025-05-28 18:09:27,633 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:09:27,887 - INFO - aiogram.dispatcher - dispatcher - _polling - 341 - Run polling for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 18:09:28,056 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 21 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 28 - Database session factory configured for Agent.
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - __init__ - 120 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 579
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 42 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - setup - 494 - AgentRunner setup started.
2025-05-28 18:09:28,056 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 18:09:28,062 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 18:09:28,062 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 27 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 18:09:28,142 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 18:09:28,142 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 33 - Configuration fetched successfully.
2025-05-28 18:09:28,142 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _load_config - 138 - Agent configuration loaded and prepared successfully.
2025-05-28 18:09:28,142 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 149 - Creating LangGraph application...
2025-05-28 18:09:28,142 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 913 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 18:09:28,142 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:09:28,168 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_main_llm - 63 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 18:09:28,168 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 818 - Creating agent graph in GraphFactory...
2025-05-28 18:09:28,168 - INFO - app.agent_runner.common.tools_registry - tools_registry - configure_tools_centralized - 364 - Configured 3 predefined tools from centralized registry
2025-05-28 18:09:28,168 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 94 - Added 3 tools from centralized registry
2025-05-28 18:09:28,168 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 114 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 18:09:28,223 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 18:09:28,227 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 18:09:29,202 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:09:29,204 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 132 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 18:09:29,205 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 166 - Must conditions for KB tool 'knowledgeBase-1745316404538': [FieldCondition(key='metadata.client_id', match=MatchValue(value='2'), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None), FieldCondition(key='metadata.datasource_id', match=MatchAny(any=['5', '6', '7']), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None)]
2025-05-28 18:09:29,205 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 182 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 18:09:29,205 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 190 - Using max_rewrites: 4
2025-05-28 18:09:29,205 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 217 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 18:09:29,205 - INFO - app.agent_runner.langgraph.tools - tools - configure_tools - 244 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 18:09:29,205 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_tools - 153 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 18:09:29,205 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 826 - Context memory enabled: True
2025-05-28 18:09:29,206 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 834 - Added node: agent
2025-05-28 18:09:29,206 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 843 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 18:09:29,206 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 853 - Added node: safe_tools
2025-05-28 18:09:29,206 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 864 - Added edge: safe_tools -> agent
2025-05-28 18:09:29,206 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 870 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 18:09:29,207 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 877 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 18:09:29,207 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 893 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 18:09:29,217 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 905 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 18:09:29,217 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 922 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 18:09:29,217 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 157 - LangGraph application created successfully.
2025-05-28 18:09:29,218 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component AgentRunner (instance: 4494132912) setup complete. Starting run loop.
2025-05-28 18:09:29,218 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 522 - AgentRunner run_loop starting...
2025-05-28 18:09:29,218 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AgentPubSubListener
2025-05-28 18:09:29,218 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 1 registered main tasks.
2025-05-28 18:09:29,218 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:09:29,220 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:09:36,637 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:09:36,645 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:09:36,645 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4382286688) setup complete. Starting run loop.
2025-05-28 18:09:36,645 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:14:36,869 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:14:36,898 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:19:37,090 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:19:37,100 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:24:37,301 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:24:37,310 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:29:37,504 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:29:37,511 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:34:37,701 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:34:37,715 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:37:44,976 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'Привет...'
2025-05-28 18:37:44,988 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 127 - Auth cache miss for user 144641834, agent agent_airsoft_0faa9616. Checking DB.
2025-05-28 18:37:45,406 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 147 - User 144641834 (DBID: 1) IS authorized for agent agent_airsoft_0faa9616 via DB.
2025-05-28 18:37:45,410 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 18:37:45,410 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 18:37:45,424 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 18:37:45,437 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: 3206e391-9023-48f6-8962-173dc3553bf4)
2025-05-28 18:37:45,440 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:37:45,442 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 423 - Thread '144641834' not found in cache 'agent_threads:agent_airsoft_0faa9616'. Loading history from DB with depth 20.
2025-05-28 18:37:45,630 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 433 - Loaded 20 messages from DB for thread '144641834'.
2025-05-28 18:37:45,632 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 436 - Added thread '144641834' to cache 'agent_threads:agent_airsoft_0faa9616'.
2025-05-28 18:37:45,632 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 20)
2025-05-28 18:37:45,655 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 3206e391-9023-48f6-8962-173dc3553bf4, db_id: 896
2025-05-28 18:37:45,733 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:37:45,734 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:37:45,769 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:37:45,777 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 18:37:46,411 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756294 is handled. Duration 1456 ms by bot id=1750613938
2025-05-28 18:37:46,834 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:37:47,011 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Привет-привет! Как настроение? Чем могу помочь? 😉
2025-05-28 18:37:47,011 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_6f2eabb9a5'}
2025-05-28 18:37:47,011 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1701, 'output_tokens': 14, 'total_tokens': 1715, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:37:47,011 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1701 C:14 T:1715
2025-05-28 18:37:47,011 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1715 tokens recorded.
2025-05-28 18:37:47,012 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 18:37:47,012 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 18:37:47,013 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Привет-привет! Как настроение? Чем могу помочь? 😉...
2025-05-28 18:37:47,016 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: 3206e391-9023-48f6-8962-173dc3553bf4)
2025-05-28 18:37:47,019 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 1 token usage events for InteractionID: 3206e391-9023-48f6-8962-173dc3553bf4.
2025-05-28 18:37:47,026 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Привет-привет! Как настроение? Чем могу помочь? 😉...
2025-05-28 18:37:47,026 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Привет-привет! Как настроение? Чем могу помочь? 😉...'
2025-05-28 18:37:47,036 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': '3206e391-9023-48f6-8962-173dc3553bf4', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1701, 'completion_tokens': 14, 'total_tokens': 1715, 'timestamp': '2025-05-28T13:37:47.011284+00:00'}
2025-05-28 18:37:47,036 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: 3206e391-9023-48f6-8962-173dc3553bf4
2025-05-28 18:37:47,052 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 3206e391-9023-48f6-8962-173dc3553bf4, db_id: 897
2025-05-28 18:37:47,085 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 897 for interaction_id: 3206e391-9023-48f6-8962-173dc3553bf4 on attempt 1
2025-05-28 18:37:47,092 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: 3206e391-9023-48f6-8962-173dc3553bf4, db_id: 362
2025-05-28 18:38:00,154 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'что ты умеешь?...'
2025-05-28 18:38:00,156 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 18:38:00,162 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 18:38:00,162 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 18:38:00,162 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 18:38:00,163 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: 48253de1-9e83-40ee-a740-869240b1f8f2)
2025-05-28 18:38:00,163 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:38:00,164 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 439 - Thread '144641834' found in cache 'agent_threads:agent_airsoft_0faa9616'. Skipping DB load.
2025-05-28 18:38:00,164 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 0)
2025-05-28 18:38:00,168 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:38:00,168 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:38:00,171 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 48253de1-9e83-40ee-a740-869240b1f8f2, db_id: 898
2025-05-28 18:38:00,193 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:38:00,196 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 18:38:00,854 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:38:01,162 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756295 is handled. Duration 1008 ms by bot id=1750613938
2025-05-28 18:38:01,491 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Ой, я умею много интересного! Вот несколько моих суперспособностей:

- Отвечать на вопросы и давать 
2025-05-28 18:38:01,491 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_658b958c37'}
2025-05-28 18:38:01,491 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1727, 'output_tokens': 119, 'total_tokens': 1846, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:38:01,491 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1727 C:119 T:1846
2025-05-28 18:38:01,491 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1846 tokens recorded.
2025-05-28 18:38:01,492 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 18:38:01,492 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 18:38:01,493 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Ой, я умею много интересного! Вот несколько моих суперспособностей:

- Отвечать на вопросы и давать ...
2025-05-28 18:38:01,495 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: 48253de1-9e83-40ee-a740-869240b1f8f2)
2025-05-28 18:38:01,496 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 1 token usage events for InteractionID: 48253de1-9e83-40ee-a740-869240b1f8f2.
2025-05-28 18:38:01,498 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Ой, я умею много интересного! Вот несколько моих суперспособностей:

- Отвечать на вопросы и давать ...
2025-05-28 18:38:01,498 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Ой, я умею много интересного! Вот несколько моих с...'
2025-05-28 18:38:01,500 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': '48253de1-9e83-40ee-a740-869240b1f8f2', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1727, 'completion_tokens': 119, 'total_tokens': 1846, 'timestamp': '2025-05-28T13:38:01.491457+00:00'}
2025-05-28 18:38:01,500 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: 48253de1-9e83-40ee-a740-869240b1f8f2
2025-05-28 18:38:01,506 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 48253de1-9e83-40ee-a740-869240b1f8f2, db_id: 899
2025-05-28 18:38:01,506 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 899 for interaction_id: 48253de1-9e83-40ee-a740-869240b1f8f2 on attempt 1
2025-05-28 18:38:01,511 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: 48253de1-9e83-40ee-a740-869240b1f8f2, db_id: 363
2025-05-28 18:38:42,530 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'Что ты можешь сказать про нюаны перехода на ут11?...'
2025-05-28 18:38:42,532 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 18:38:42,536 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 18:38:42,536 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 18:38:42,536 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 18:38:42,537 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: 79460fdd-5d2f-4527-bad8-6541bc96f73f)
2025-05-28 18:38:42,537 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:38:42,538 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 439 - Thread '144641834' found in cache 'agent_threads:agent_airsoft_0faa9616'. Skipping DB load.
2025-05-28 18:38:42,539 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 0)
2025-05-28 18:38:42,545 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:38:42,545 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:38:42,547 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 79460fdd-5d2f-4527-bad8-6541bc96f73f, db_id: 900
2025-05-28 18:38:42,574 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:38:42,579 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 18:38:43,468 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:38:43,537 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756296 is handled. Duration 1007 ms by bot id=1750613938
2025-05-28 18:38:55,016 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Ой, нюансов при переходе на 1С:Управление торговлей 11 действительно много! Вот самые важные, на кот
2025-05-28 18:38:55,016 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_38647f5e19'}
2025-05-28 18:38:55,016 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1867, 'output_tokens': 266, 'total_tokens': 2133, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:38:55,016 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1867 C:266 T:2133
2025-05-28 18:38:55,016 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 2133 tokens recorded.
2025-05-28 18:38:55,017 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 18:38:55,017 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 18:38:55,018 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Ой, нюансов при переходе на 1С:Управление торговлей 11 действительно много! Вот самые важные, на кот...
2025-05-28 18:38:55,021 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: 79460fdd-5d2f-4527-bad8-6541bc96f73f)
2025-05-28 18:38:55,021 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 1 token usage events for InteractionID: 79460fdd-5d2f-4527-bad8-6541bc96f73f.
2025-05-28 18:38:55,023 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Ой, нюансов при переходе на 1С:Управление торговлей 11 действительно много! Вот самые важные, на кот...
2025-05-28 18:38:55,023 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Ой, нюансов при переходе на 1С:Управление торговле...'
2025-05-28 18:38:55,025 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': '79460fdd-5d2f-4527-bad8-6541bc96f73f', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1867, 'completion_tokens': 266, 'total_tokens': 2133, 'timestamp': '2025-05-28T13:38:55.016670+00:00'}
2025-05-28 18:38:55,025 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: 79460fdd-5d2f-4527-bad8-6541bc96f73f
2025-05-28 18:38:55,028 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 900 for interaction_id: 79460fdd-5d2f-4527-bad8-6541bc96f73f on attempt 1
2025-05-28 18:38:55,031 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 79460fdd-5d2f-4527-bad8-6541bc96f73f, db_id: 901
2025-05-28 18:38:55,047 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: 79460fdd-5d2f-4527-bad8-6541bc96f73f, db_id: 364
2025-05-28 18:39:37,915 - INFO - InactivityMonitorWorker - base_worker - run_loop - 275 - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:39:37,924 - INFO - InactivityMonitorWorker - base_worker - run_loop - 281 - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:42:37,287 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:42:37,288 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:42:37,288 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:42:37,289 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4381985584) was cancelled.
2025-05-28 18:42:37,289 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4381985584) stopping. Performing cleanup...
2025-05-28 18:42:37,289 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:42:37,293 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:42:37,294 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:42:37,294 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:42:37,295 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:42:37,295 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:42:37,295 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4381985584) cleanup complete.
2025-05-28 18:42:37,295 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:42:37,295 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:42:37,295 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4382293024) was cancelled.
2025-05-28 18:42:37,295 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4382293024) stopping. Performing cleanup...
2025-05-28 18:42:37,295 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:42:37,296 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:42:37,297 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:42:37,297 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:42:37,297 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:42:37,297 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:42:37,297 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4382293024) cleanup complete.
2025-05-28 18:42:37,297 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:42:37,297 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:42:37,297 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4382286688) was cancelled.
2025-05-28 18:42:37,297 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4382286688) stopping. Performing cleanup...
2025-05-28 18:42:37,298 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:42:37,298 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:42:37,298 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:42:37,298 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:42:37,298 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:42:37,299 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:42:37,300 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:42:37,300 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:42:37,300 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:42:37,301 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:42:37,301 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:42:37,301 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4382286688) cleanup complete.
2025-05-28 18:42:37,301 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:42:37,301 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:42:37,301 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:42:37,318 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:42:37,318 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:42:37,811 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:42:37,811 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:42:37,816 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:42:37,816 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:42:37,816 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:42:37,816 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:42:37,816 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:42:37,816 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:42:37,816 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:42:37,816 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:42:37,817 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:42:37,817 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:42:37,817 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:42:37,818 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:42:37,819 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:42:37,819 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:42:37,820 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:42:37,820 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:42:37,820 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:42:37,820 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:42:37,823 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:42:37,823 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4446348896) setup complete. Starting run loop.
2025-05-28 18:42:37,823 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:42:37,823 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:42:37,823 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:42:37,823 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4446353408) setup complete. Starting run loop.
2025-05-28 18:42:37,823 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:42:37,825 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:42:37,825 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:42:37,872 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:42:37,873 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:42:37,874 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:42:37,874 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:42:37,874 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:42:37,875 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:42:37,875 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:42:37,876 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:42:37,876 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:42:37,876 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:42:47,826 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:42:47,831 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:42:47,831 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4446781264) setup complete. Starting run loop.
2025-05-28 18:42:47,831 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:43:10,307 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:43:10,308 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:43:10,308 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:43:10,309 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4446348896) was cancelled.
2025-05-28 18:43:10,309 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4446348896) stopping. Performing cleanup...
2025-05-28 18:43:10,309 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:43:10,316 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:43:10,317 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:43:10,317 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:10,317 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:43:10,317 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:43:10,317 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4446348896) cleanup complete.
2025-05-28 18:43:10,317 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:43:10,317 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:43:10,317 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4446353408) was cancelled.
2025-05-28 18:43:10,317 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4446353408) stopping. Performing cleanup...
2025-05-28 18:43:10,317 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:43:10,321 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:43:10,322 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:43:10,322 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:10,323 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:43:10,323 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:43:10,323 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4446353408) cleanup complete.
2025-05-28 18:43:10,323 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:43:10,323 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:43:10,323 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4446781264) was cancelled.
2025-05-28 18:43:10,323 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4446781264) stopping. Performing cleanup...
2025-05-28 18:43:10,323 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:43:10,323 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:10,323 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:43:10,323 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:43:10,323 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:43:10,325 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:43:10,326 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:43:10,326 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:10,326 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:43:10,326 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:43:10,326 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:43:10,326 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4446781264) cleanup complete.
2025-05-28 18:43:10,326 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:43:10,326 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:43:10,326 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:43:10,332 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:43:10,332 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:43:10,807 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:43:10,807 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:43:10,812 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:43:10,812 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:43:10,812 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:43:10,812 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:43:10,812 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:43:10,812 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:43:10,812 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:43:10,812 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:43:10,812 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:43:10,812 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:43:10,812 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:43:10,815 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:43:10,815 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:43:10,815 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:43:10,815 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:43:10,815 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:43:10,815 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:43:10,815 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:43:10,817 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:43:10,817 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:43:10,817 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4405837168) setup complete. Starting run loop.
2025-05-28 18:43:10,817 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:43:10,818 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:43:10,818 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4405836688) setup complete. Starting run loop.
2025-05-28 18:43:10,818 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:43:10,820 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:43:10,820 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:43:10,869 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:43:10,869 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:43:10,870 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:43:10,870 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:43:10,870 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:43:10,871 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:43:10,872 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:10,872 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:43:10,872 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:43:10,872 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:43:15,442 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 160 - ServiceComponentBase run_loop itself was cancelled (e.g. during shutdown).
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component AgentRunner (instance: 4494132912) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:43:15,442 - WARNING - aiogram.dispatcher - dispatcher - _signal_stop_polling - 455 - Received SIGINT signal
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for AgentRunner (instance: 4494132912)...
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 536 - AgentRunner run_loop finished.
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for AgentRunner (instance: 4494132912) was cancelled.
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component AgentRunner (instance: 4494132912) stopping. Performing cleanup...
2025-05-28 18:43:15,445 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 546 - AgentRunner cleanup started.
2025-05-28 18:43:15,445 - INFO - aiogram.dispatcher - dispatcher - _polling - 359 - Polling stopped for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 18:43:15,446 - INFO - aiogram.dispatcher - dispatcher - start_polling - 554 - Polling stopped
2025-05-28 18:43:15,446 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 552 - Cleared loaded threads cache 'agent_threads:agent_airsoft_0faa9616' (deleted: 1) on start/restart.
2025-05-28 18:43:15,447 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 1 main tasks.
2025-05-28 18:43:15,447 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 18:43:15,447 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 18:43:15,447 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:43:15,448 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:input finished.
2025-05-28 18:43:15,448 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'AgentPubSubListener' completed during cleanup with result: None
2025-05-28 18:43:15,448 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:43:15,452 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616 as part of cleanup.
2025-05-28 18:43:15,453 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key agent_status:agent_airsoft_0faa9616 from Redis.
2025-05-28 18:43:15,453 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:15,454 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616 cleaned up Redis resources.
2025-05-28 18:43:15,454 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:43:15,454 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 581 - AgentRunner cleanup finished.
2025-05-28 18:43:15,454 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component AgentRunner (instance: 4494132912) cleanup complete.
2025-05-28 18:43:15,454 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 51 - AgentRunner for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:43:15,454 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 60 - Shutting down agent runner for agent_airsoft_0faa9616.
2025-05-28 18:43:15,464 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:43:15,464 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 63 - Database engine closed.
2025-05-28 18:43:15,464 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 66 - Agent runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:43:15,466 - INFO - __main__ - runner_main - <module> - 86 - Agent runner main finished.
2025-05-28 18:43:15,599 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:43:15,600 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:43:15,600 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:43:15,600 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4405837168) was cancelled.
2025-05-28 18:43:15,600 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4405837168) stopping. Performing cleanup...
2025-05-28 18:43:15,600 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:43:15,605 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:43:15,606 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:43:15,606 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:15,606 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:43:15,606 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:43:15,606 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4405837168) cleanup complete.
2025-05-28 18:43:15,606 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:43:15,606 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:43:15,606 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4405836688) was cancelled.
2025-05-28 18:43:15,606 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4405836688) stopping. Performing cleanup...
2025-05-28 18:43:15,606 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:43:15,609 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:43:15,610 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:43:15,610 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:15,610 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:43:15,610 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:43:15,610 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4405836688) cleanup complete.
2025-05-28 18:43:15,610 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:43:15,610 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:43:15,610 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4405826848) was cancelled.
2025-05-28 18:43:15,610 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4405826848) stopping. Performing cleanup...
2025-05-28 18:43:15,610 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:43:15,611 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:15,611 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:43:15,611 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:43:15,611 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:43:15,612 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:43:15,613 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:43:15,613 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:15,613 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:43:15,613 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:43:15,613 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:43:15,613 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4405826848) cleanup complete.
2025-05-28 18:43:15,613 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:43:15,613 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:43:15,613 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:43:15,616 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:43:15,616 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:43:15,696 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 482 - Aiogram polling has stopped.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 137 - Main task 'AiogramPolling' completed. Result: None
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 156 - A main task finished. Initiating shutdown of other tasks and component.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component TelegramIntegrationBot (instance: 4723776912) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for TelegramIntegrationBot (instance: 4723776912)...
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 494 - TelegramIntegrationBot run_loop for agent agent_airsoft_0faa9616 finishing.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for TelegramIntegrationBot (instance: 4723776912) was cancelled.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component TelegramIntegrationBot (instance: 4723776912) stopping. Performing cleanup...
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 503 - TelegramIntegrationBot cleanup started.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 516 - Closing Aiogram bot session.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 518 - Aiogram bot session closed.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 2 main tasks.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 18:43:15,697 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:43:15,698 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:output finished.
2025-05-28 18:43:15,698 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'RedisOutputListener' completed during cleanup with result: None
2025-05-28 18:43:15,698 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:43:15,702 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616:telegram as part of cleanup.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key integration_status:agent_airsoft_0faa9616:telegram from Redis.
2025-05-28 18:43:15,703 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616:telegram cleaned up Redis resources.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 524 - TelegramIntegrationBot cleanup finished.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component TelegramIntegrationBot (instance: 4723776912) cleanup complete.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 86 - TelegramIntegrationBot for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:43:15,703 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 95 - Shutting down Telegram bot runner for agent_airsoft_0faa9616.
2025-05-28 18:43:15,708 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:43:15,708 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 98 - Database engine closed.
2025-05-28 18:43:15,708 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 101 - Telegram bot runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:43:15,710 - INFO - __main__ - telegram_bot_main - <module> - 124 - Telegram bot runner main finished.
2025-05-28 18:43:21,778 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:43:21,778 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:43:21,783 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:43:21,783 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:43:21,783 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:43:21,783 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:43:21,783 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:43:21,783 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:43:21,783 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:43:21,783 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:43:21,783 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:43:21,783 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:43:21,783 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:43:21,785 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:43:21,787 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:43:21,787 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:43:21,787 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:43:21,787 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:43:21,787 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:43:21,787 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:43:21,788 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:43:21,788 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:43:21,788 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4852513584) setup complete. Starting run loop.
2025-05-28 18:43:21,788 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:43:21,789 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:43:21,789 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4852513200) setup complete. Starting run loop.
2025-05-28 18:43:21,789 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:43:21,791 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:43:21,791 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:43:21,835 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:43:21,835 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:43:21,836 - INFO - app.services.process_manager - process_manager - start_agent_process - 880 - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 18:43:21,838 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 2336
2025-05-28 18:43:21,838 - INFO - app.services.process_manager - process_manager - start_agent_process - 913 - Agent process agent_airsoft_0faa9616 initiated start with PID 2336
2025-05-28 18:43:21,838 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 79 - Successfully initiated start for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 18:43:21,838 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:43:21,838 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:43:21,840 - INFO - app.services.process_manager - process_manager - start_integration_process - 554 - Attempting to start integration process for agent_airsoft_0faa9616/telegram...
2025-05-28 18:43:21,841 - INFO - app.core.base.process_launcher - process_launcher - launch_process - 160 - [integration_start_agent_airsoft_0faa9616_telegram] Process launched without output capture. PID: 2337
2025-05-28 18:43:21,841 - INFO - app.services.process_manager - process_manager - start_integration_process - 600 - Integration process telegram for agent agent_airsoft_0faa9616 initiated start with PID 2337
2025-05-28 18:43:21,841 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 123 - Successfully initiated start for telegram integration for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 18:43:21,842 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:43:21,842 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:43:21,842 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:43:21,842 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:43:22,758 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 50 - Starting Telegram bot for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 57 - Database session factory configured for Telegram bot.
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - __init__ - 56 - TelegramIntegrationBot initialized. PID: 2337
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 74 - Calling TelegramIntegrationBot.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 441 - TelegramIntegrationBot setup started.
2025-05-28 18:43:22,759 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 18:43:22,767 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 452 - Aiogram Bot and Dispatcher initialized.
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _register_handlers - 341 - Aiogram handlers registered.
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - setup - 456 - TelegramIntegrationBot setup complete.
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component TelegramIntegrationBot (instance: 4456881696) setup complete. Starting run loop.
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 464 - TelegramIntegrationBot run_loop started for agent agent_airsoft_0faa9616. Polling for updates...
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: RedisOutputListener
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AiogramPolling
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 2 registered main tasks.
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:43:22,780 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 473 - Starting aiogram polling...
2025-05-28 18:43:22,780 - INFO - aiogram.dispatcher - dispatcher - start_polling - 527 - Start polling
2025-05-28 18:43:22,783 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:43:23,035 - INFO - aiogram.dispatcher - dispatcher - _polling - 341 - Run polling for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 18:43:23,111 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 21 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 28 - Database session factory configured for Agent.
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - __init__ - 44 - ServiceComponentBase initialized.
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - __init__ - 120 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 2336
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 42 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - setup - 494 - AgentRunner setup started.
2025-05-28 18:43:23,112 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 84 - ServiceComponent setup started.
2025-05-28 18:43:23,118 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - setup - 95 - ServiceComponent setup completed.
2025-05-28 18:43:23,118 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 27 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 18:43:23,200 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 18:43:23,200 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - fetch_config - 33 - Configuration fetched successfully.
2025-05-28 18:43:23,200 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _load_config - 138 - Agent configuration loaded and prepared successfully.
2025-05-28 18:43:23,200 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 149 - Creating LangGraph application...
2025-05-28 18:43:23,200 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 913 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 18:43:23,200 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:43:23,226 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_main_llm - 63 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 18:43:23,226 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 818 - Creating agent graph in GraphFactory...
2025-05-28 18:43:23,226 - INFO - app.agent_runner.common.tools_registry - tools_registry - configure_tools_centralized - 364 - Configured 3 predefined tools from centralized registry
2025-05-28 18:43:23,226 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 94 - Added 3 tools from centralized registry
2025-05-28 18:43:23,226 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 114 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 18:43:23,282 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 18:43:23,288 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 18:43:24,157 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 132 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 166 - Must conditions for KB tool 'knowledgeBase-1745316404538': [FieldCondition(key='metadata.client_id', match=MatchValue(value='2'), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None), FieldCondition(key='metadata.datasource_id', match=MatchAny(any=['5', '6', '7']), range=None, geo_bounding_box=None, geo_radius=None, geo_polygon=None, values_count=None)]
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 182 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 190 - Using max_rewrites: 4
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 217 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - tools - configure_tools - 244 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _configure_tools - 153 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 18:43:24,161 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 826 - Context memory enabled: True
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 834 - Added node: agent
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 843 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 853 - Added node: safe_tools
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 864 - Added edge: safe_tools -> agent
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 870 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 877 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 18:43:24,162 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 893 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_graph - 905 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - factory - create_agent_app - 922 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _setup_app - 157 - LangGraph application created successfully.
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 111 - Component AgentRunner (instance: 4858692912) setup complete. Starting run loop.
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 522 - AgentRunner run_loop starting...
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _register_main_task - 62 - Registered main task: AgentPubSubListener
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 122 - Starting run_loop with 1 registered main tasks.
2025-05-28 18:43:24,172 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 236 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:43:24,176 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 254 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:43:31,791 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:43:31,797 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:43:31,798 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4852513344) setup complete. Starting run loop.
2025-05-28 18:43:31,798 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:44:01,208 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:44:01,208 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:44:01,208 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:44:01,208 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4852513584) was cancelled.
2025-05-28 18:44:01,208 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4852513584) stopping. Performing cleanup...
2025-05-28 18:44:01,208 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:44:01,216 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:44:01,218 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:44:01,218 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:44:01,218 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:44:01,218 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:44:01,218 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4852513584) cleanup complete.
2025-05-28 18:44:01,218 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:44:01,218 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:44:01,218 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4852513200) was cancelled.
2025-05-28 18:44:01,218 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4852513200) stopping. Performing cleanup...
2025-05-28 18:44:01,218 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:44:01,222 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:44:01,223 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:44:01,223 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:44:01,223 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:44:01,223 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:44:01,223 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4852513200) cleanup complete.
2025-05-28 18:44:01,223 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:44:01,223 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:44:01,223 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4852513344) was cancelled.
2025-05-28 18:44:01,223 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4852513344) stopping. Performing cleanup...
2025-05-28 18:44:01,223 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:44:01,223 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:44:01,223 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:44:01,223 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:44:01,223 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:44:01,226 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:44:01,227 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:44:01,227 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:44:01,227 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:44:01,227 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:44:01,227 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:44:01,227 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4852513344) cleanup complete.
2025-05-28 18:44:01,227 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:44:01,227 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:44:01,227 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:44:01,239 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:44:01,239 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:44:01,718 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:44:01,718 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:44:01,723 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:44:01,723 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:44:01,723 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:44:01,723 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:44:01,723 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:44:01,724 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:44:01,724 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:44:01,724 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:44:01,724 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:44:01,724 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:44:01,724 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:44:01,727 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:44:01,729 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:44:01,729 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:44:01,731 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:44:01,731 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:44:01,731 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:44:01,731 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:44:01,733 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:44:01,733 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:44:01,733 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4438901056) setup complete. Starting run loop.
2025-05-28 18:44:01,733 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:44:01,735 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:44:01,735 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4442651680) setup complete. Starting run loop.
2025-05-28 18:44:01,735 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:44:01,736 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:44:01,736 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:44:01,799 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:44:01,800 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:44:01,801 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:44:01,801 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:44:01,801 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:44:01,803 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:44:01,803 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:44:01,804 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:44:01,804 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:44:01,804 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:44:11,737 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:44:11,742 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:44:11,742 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4442651584) setup complete. Starting run loop.
2025-05-28 18:44:11,742 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:45:07,532 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'Сколько программистов необходимо для перехода?...'
2025-05-28 18:45:07,535 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 18:45:07,641 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 18:45:07,641 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 18:45:07,641 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 18:45:07,644 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: 6c719543-e400-459f-979c-360a0576c1bf)
2025-05-28 18:45:07,644 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:45:07,644 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 423 - Thread '144641834' not found in cache 'agent_threads:agent_airsoft_0faa9616'. Loading history from DB with depth 20.
2025-05-28 18:45:07,683 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 6c719543-e400-459f-979c-360a0576c1bf, db_id: 902
2025-05-28 18:45:07,704 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 433 - Loaded 20 messages from DB for thread '144641834'.
2025-05-28 18:45:07,705 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 436 - Added thread '144641834' to cache 'agent_threads:agent_airsoft_0faa9616'.
2025-05-28 18:45:07,705 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 20)
2025-05-28 18:45:07,784 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:45:07,785 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:45:07,811 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:45:07,817 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 18:45:08,641 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756297 is handled. Duration 1110 ms by bot id=1750613938
2025-05-28 18:45:08,739 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:45:11,981 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Для перехода на 1С:Управление торговлей 11 обычно требуется от 1 до 3 программистов, в зависимости о
2025-05-28 18:45:11,981 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_38647f5e19'}
2025-05-28 18:45:11,981 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1684, 'output_tokens': 159, 'total_tokens': 1843, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:45:11,981 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1684 C:159 T:1843
2025-05-28 18:45:11,981 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1843 tokens recorded.
2025-05-28 18:45:11,982 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 18:45:11,982 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 18:45:11,983 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Для перехода на 1С:Управление торговлей 11 обычно требуется от 1 до 3 программистов, в зависимости о...
2025-05-28 18:45:11,985 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: 6c719543-e400-459f-979c-360a0576c1bf)
2025-05-28 18:45:11,985 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 1 token usage events for InteractionID: 6c719543-e400-459f-979c-360a0576c1bf.
2025-05-28 18:45:11,987 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Для перехода на 1С:Управление торговлей 11 обычно требуется от 1 до 3 программистов, в зависимости о...
2025-05-28 18:45:11,988 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Для перехода на 1С:Управление торговлей 11 обычно ...'
2025-05-28 18:45:11,989 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': '6c719543-e400-459f-979c-360a0576c1bf', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 1684, 'completion_tokens': 159, 'total_tokens': 1843, 'timestamp': '2025-05-28T13:45:11.981413+00:00'}
2025-05-28 18:45:11,989 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: 6c719543-e400-459f-979c-360a0576c1bf
2025-05-28 18:45:11,994 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 6c719543-e400-459f-979c-360a0576c1bf, db_id: 903
2025-05-28 18:45:12,024 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 903 for interaction_id: 6c719543-e400-459f-979c-360a0576c1bf on attempt 1
2025-05-28 18:45:12,029 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: 6c719543-e400-459f-979c-360a0576c1bf, db_id: 365
2025-05-28 18:46:16,395 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'Что у тебя есть про налоговую?...'
2025-05-28 18:46:16,396 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 18:46:16,407 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 18:46:16,407 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 18:46:16,407 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 18:46:16,409 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: 98faba0f-2c0c-4493-b32c-7a7a7ee4bc0d)
2025-05-28 18:46:16,409 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:46:16,410 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 439 - Thread '144641834' found in cache 'agent_threads:agent_airsoft_0faa9616'. Skipping DB load.
2025-05-28 18:46:16,411 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 0)
2025-05-28 18:46:16,416 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:46:16,417 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:46:16,425 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: 98faba0f-2c0c-4493-b32c-7a7a7ee4bc0d, db_id: 904
2025-05-28 18:46:16,448 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:46:16,452 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 18:46:17,408 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756298 is handled. Duration 1013 ms by bot id=1750613938
2025-05-28 18:46:21,472 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:46:21,569 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: N/A
2025-05-28 18:46:21,569 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'tool_calls', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_658b958c37'}
2025-05-28 18:46:21,569 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 1858, 'output_tokens': 23, 'total_tokens': 1881, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:46:21,569 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:1858 C:23 T:1881
2025-05-28 18:46:21,569 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 1881 tokens recorded.
2025-05-28 18:46:21,570 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 18:46:21,570 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 635 - Tool call detected: knowledgeBase-1745316404538
2025-05-28 18:46:21,570 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 638 - ---DECISION: ROUTE TO RETRIEVE (knowledgeBase-1745316404538)---
2025-05-28 18:46:22,170 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:46:22,200 - INFO - httpx - _client - _send_single_request - 1025 - HTTP Request: POST http://127.0.0.1:6333/collections/platformai/points/query "HTTP/1.1 200 OK"
2025-05-28 18:46:22,204 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 360 - ---CHECK RELEVANCE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:46:22,204 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 371 - Grading documents for question: 'Что у тебя есть про налоговую?'
2025-05-28 18:46:22,204 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.0, streaming: False
2025-05-28 18:46:22,230 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created grading LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:46:22,238 - INFO - AGENT:agent_airsoft_0faa9616 - factory - process_doc - 413 - Grading document content (first 300 chars): ## МИНФИН РОССИИ ФЕДЕРАЛЬНАЯ НАЛОГОВАЯ СЛУЖБА УФНС РОССИИ ПО СВЕРДЛОВСКОЙ ОБЛАСТИ

**МЕЖРАЙОННАЯ ИНСПЕКЦИЯ ФЕДЕРАЛЬНОЙ НАЛОГОВОЙ СЛУЖБЫ №32 ПО СВЕРДЛОВСКОЙ ОБЛАСТИ**

> (Межрайонная ИФНС России № 32 по Свердловской области)

Стачек ул., 17-Б, Екатеринбург, 620091 Телефон:(343) 288-2648; Телефакс:(34
2025-05-28 18:46:22,238 - INFO - AGENT:agent_airsoft_0faa9616 - factory - process_doc - 414 - Question for grading: Что у тебя есть про налоговую?
2025-05-28 18:46:22,914 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:46:22,928 - INFO - AGENT:agent_airsoft_0faa9616 - factory - process_doc - 424 - Grading result: yes for document starting with: ## МИНФИН РОССИИ ФЕДЕРАЛЬНАЯ НАЛОГОВАЯ СЛУЖБА УФНС РОССИИ ПО СВЕРДЛОВСКОЙ ОБЛАСТИ

**МЕЖРАЙОННАЯ ИНС...
2025-05-28 18:46:22,928 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:898 C:6 T:904
2025-05-28 18:46:22,928 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for grading_llm: 904 tokens recorded.
2025-05-28 18:46:22,928 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 461 - Total token usage for grading_llm batch: 904 tokens.
2025-05-28 18:46:22,928 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _grade_docs_node - 466 - Found 1 relevant documents out of 1 initial (after split).
2025-05-28 18:46:22,929 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _decide_to_generate_edge - 585 - ---ASSESS GRADED DOCUMENTS---
2025-05-28 18:46:22,929 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _decide_to_generate_edge - 600 - ---DECISION: RELEVANT DOCUMENTS FOUND, GENERATE---
2025-05-28 18:46:22,929 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _generate_node - 532 - ---GENERATE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:46:22,929 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _generate_node - 553 - Generating answer for question: 'Что у тебя есть про налоговую?' using 1 documents.
2025-05-28 18:46:22,934 - ERROR - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 264 - Error processing PubSub message: 'GraphFactory' object has no attribute '_create_rag_prompt_template'
Traceback (most recent call last):
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/app/agent_runner/agent_runner.py", line 228, in _handle_pubsub_message
    response_content, final_message = await self._invoke_agent(
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/app/agent_runner/agent_runner.py", line 370, in _invoke_agent
    async for output in self.agent_app.astream(graph_input, self.config, stream_mode="updates"):
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/.venv/lib/python3.12/site-packages/langgraph/pregel/__init__.py", line 2313, in astream
    async for _ in runner.atick(
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/.venv/lib/python3.12/site-packages/langgraph/pregel/runner.py", line 444, in atick
    await arun_with_retry(
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/.venv/lib/python3.12/site-packages/langgraph/pregel/retry.py", line 128, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/.venv/lib/python3.12/site-packages/langgraph/utils/runnable.py", line 583, in ainvoke
    input = await step.ainvoke(input, config, **kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/.venv/lib/python3.12/site-packages/langgraph/utils/runnable.py", line 371, in ainvoke
    ret = await asyncio.create_task(coro, context=context)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/jb/Projects/PlatformAI/PlatformAI-HUB/app/agent_runner/langgraph/factory.py", line 557, in _generate_node
    prompt = self._create_rag_prompt_template()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'GraphFactory' object has no attribute '_create_rag_prompt_template'. Did you mean: '_create_rag_template'?
During task with name 'generate' and id '495ffb5e-b5e7-7473-cbbb-3820295eff68'
2025-05-28 18:47:51,596 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:47:51,598 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:47:51,598 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:47:51,601 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4438901056) was cancelled.
2025-05-28 18:47:51,601 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4438901056) stopping. Performing cleanup...
2025-05-28 18:47:51,602 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:47:51,611 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:47:51,612 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:47:51,612 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:47:51,612 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:47:51,612 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:47:51,612 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4438901056) cleanup complete.
2025-05-28 18:47:51,612 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:47:51,612 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:47:51,612 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4442651680) was cancelled.
2025-05-28 18:47:51,612 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4442651680) stopping. Performing cleanup...
2025-05-28 18:47:51,612 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:47:51,616 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:47:51,617 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:47:51,617 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:47:51,617 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:47:51,617 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:47:51,617 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4442651680) cleanup complete.
2025-05-28 18:47:51,617 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:47:51,617 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:47:51,617 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4442651584) was cancelled.
2025-05-28 18:47:51,617 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4442651584) stopping. Performing cleanup...
2025-05-28 18:47:51,617 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:47:51,617 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:47:51,617 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:47:51,617 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:47:51,617 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:47:51,620 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:47:51,621 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:47:51,621 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:47:51,621 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:47:51,621 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:47:51,621 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:47:51,621 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4442651584) cleanup complete.
2025-05-28 18:47:51,621 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:47:51,621 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:47:51,622 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:47:51,641 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:47:51,641 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:47:52,116 - INFO - app.core.logging_config - logging_config - setup_logging - 32 - Logging configured with level: INFO
2025-05-28 18:47:52,116 - INFO - app.core.lifespan - lifespan - lifespan - 277 - Application startup sequence initiated.
2025-05-28 18:47:52,121 - INFO - app.services.redis_service - redis_service - init_redis_pool - 24 - Redis connection pool initialized successfully.
2025-05-28 18:47:52,121 - INFO - app.core.lifespan - lifespan - start_background_tasks - 172 - Starting background tasks...
2025-05-28 18:47:52,121 - INFO - app.core.lifespan - lifespan - start_background_tasks - 182 - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:47:52,121 - INFO - TokenUsageWorker - token_usage_worker - __init__ - 45 - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:47:52,121 - INFO - app.core.lifespan - lifespan - start_background_tasks - 194 - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:47:52,121 - INFO - app.core.lifespan - lifespan - start_background_tasks - 206 - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:47:52,121 - INFO - app.core.lifespan - lifespan - start_background_tasks - 210 - 3 background tasks initiated.
2025-05-28 18:47:52,121 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 51 - Attempting to start existing agents and their integrations...
2025-05-28 18:47:52,122 - INFO - HistorySaverWorker - base_worker - setup - 48 - [history_saver_worker] Worker setup started.
2025-05-28 18:47:52,122 - INFO - TokenUsageWorker - base_worker - setup - 48 - [token_usage_worker] Worker setup started.
2025-05-28 18:47:52,122 - INFO - InactivityMonitorWorker - base_worker - setup - 48 - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:47:52,124 - INFO - HistorySaverWorker - base_worker - setup - 52 - [history_saver_worker] Worker setup completed.
2025-05-28 18:47:52,124 - INFO - HistorySaverWorker - base_worker - setup - 114 - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:47:52,124 - INFO - InactivityMonitorWorker - base_worker - setup - 52 - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:47:52,124 - INFO - InactivityMonitorWorker - base_worker - setup - 243 - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:47:52,124 - INFO - TokenUsageWorker - base_worker - setup - 52 - [token_usage_worker] Worker setup completed.
2025-05-28 18:47:52,124 - INFO - TokenUsageWorker - base_worker - setup - 114 - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:47:52,125 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 61 - ProcessManager setup complete for startup.
2025-05-28 18:47:52,127 - INFO - HistorySaverWorker - history_saver_worker - setup - 49 - [history_saver_worker] Database session factory initialized.
2025-05-28 18:47:52,127 - INFO - HistorySaverWorker - runnable_component - run - 111 - Component HistorySaverWorker (instance: 4446485584) setup complete. Starting run loop.
2025-05-28 18:47:52,127 - INFO - HistorySaverWorker - base_worker - run_loop - 131 - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:47:52,127 - INFO - TokenUsageWorker - token_usage_worker - setup - 57 - [token_usage_worker] Database session factory initialized.
2025-05-28 18:47:52,128 - INFO - TokenUsageWorker - token_usage_worker - setup - 64 - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:47:52,128 - INFO - TokenUsageWorker - runnable_component - run - 111 - Component TokenUsageWorker (instance: 4446485056) setup complete. Starting run loop.
2025-05-28 18:47:52,128 - INFO - TokenUsageWorker - base_worker - run_loop - 131 - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:47:52,129 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 86 - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:47:52,129 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 94 - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:47:52,177 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 66 - Found 1 agents to potentially start.
2025-05-28 18:47:52,177 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 69 - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:47:52,178 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 73 - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:47:52,178 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 93 - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:47:52,178 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 109 - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:47:52,179 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 115 - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:47:52,180 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:47:52,180 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:47:52,180 - INFO - app.core.lifespan - lifespan - start_existing_agents_and_integrations - 153 - ProcessManager cleanup complete for startup function.
2025-05-28 18:47:52,180 - INFO - app.core.lifespan - lifespan - lifespan - 284 - Application startup sequence completed.
2025-05-28 18:48:02,131 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 96 - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:48:02,134 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - setup - 98 - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:48:02,134 - INFO - InactivityMonitorWorker - runnable_component - run - 111 - Component InactivityMonitorWorker (instance: 4446588368) setup complete. Starting run loop.
2025-05-28 18:48:02,134 - INFO - InactivityMonitorWorker - base_worker - run_loop - 258 - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:48:06,423 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 287 - Text from 144641834 in chat 144641834 for agent agent_airsoft_0faa9616: 'Что у тебя есть про налоговую?...'
2025-05-28 18:48:06,434 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _check_user_authorization - 124 - Auth cache hit for user 144641834, agent agent_airsoft_0faa9616. Status: True
2025-05-28 18:48:06,442 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _publish_to_agent - 101 - Published message to agent:agent_airsoft_0faa9616:input for chat 144641834
2025-05-28 18:48:06,443 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_text_message - 313 - Message from 144641834 published to agent agent_airsoft_0faa9616. User data: {'is_authenticated': True, 'user_id': '144641834', 'phone_number': '79222088435', 'first_name': 'Evgeniy', 'last_name': 'Ikonnikov', 'username': 'Ikonnik0ff'}
2025-05-28 18:48:06,443 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _handle_pubsub_message - 202 - Processing message for chat_id: 144641834
2025-05-28 18:48:06,445 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued user message for history (Thread: 144641834, InteractionID: cf272141-313b-4f0c-825c-ee96fd2c2c5d)
2025-05-28 18:48:06,445 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 417 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:48:06,446 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _get_history - 439 - Thread '144641834' found in cache 'agent_threads:agent_airsoft_0faa9616'. Skipping DB load.
2025-05-28 18:48:06,446 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 366 - Invoking graph for thread_id: 144641834 (Initial history messages: 0)
2025-05-28 18:48:06,456 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 255 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:48:06,465 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_llm_instance - 80 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:48:06,509 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: cf272141-313b-4f0c-825c-ee96fd2c2c5d, db_id: 905
2025-05-28 18:48:06,517 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _create_node_llm - 713 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:48:06,521 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _bind_tools_to_model - 804 - Model bound to 5 tools.
2025-05-28 18:48:07,444 - INFO - aiogram.event - dispatcher - feed_update - 172 - Update id=804756299 is handled. Duration 1022 ms by bot id=1750613938
2025-05-28 18:48:07,717 - INFO - httpx - _client - _send_single_request - 1740 - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:48:10,948 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 285 - Agent node response content preview: Вот что у меня есть про налоговую службу:

- Пример официального уведомления от Межрайонной инспекци
2025-05-28 18:48:10,948 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 287 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_38647f5e19'}
2025-05-28 18:48:10,948 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _agent_node - 289 - Agent node usage_metadata: {'input_tokens': 2641, 'output_tokens': 135, 'total_tokens': 2776, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:48:10,948 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _extract_token_data - 218 - Token usage from usage_metadata: P:2641 C:135 T:2776
2025-05-28 18:48:10,948 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _get_tokens - 250 - Token usage for agent_llm: 2776 tokens recorded.
2025-05-28 18:48:10,949 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 605 - ---ROUTE TOOLS---
2025-05-28 18:48:10,949 - INFO - AGENT:agent_airsoft_0faa9616 - factory - _route_tools_edge - 613 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 18:48:10,950 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _invoke_agent - 384 - Graph execution finished. Final response: Вот что у меня есть про налоговую службу:

- Пример официального уведомления от Межрайонной инспекци...
2025-05-28 18:48:10,952 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_history - 481 - Queued agent message for history (Thread: 144641834, InteractionID: cf272141-313b-4f0c-825c-ee96fd2c2c5d)
2025-05-28 18:48:10,953 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - _save_tokens - 315 - Found 1 token usage events for InteractionID: cf272141-313b-4f0c-825c-ee96fd2c2c5d.
2025-05-28 18:48:10,956 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 385 - Received response from agent for chat 144641834: Вот что у меня есть про налоговую службу:

- Пример официального уведомления от Межрайонной инспекци...
2025-05-28 18:48:10,956 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - _handle_pubsub_message - 414 - Sending message from agent to chat 144641834: 'Вот что у меня есть про налоговую службу:

- Приме...'
2025-05-28 18:48:10,958 - INFO - TokenUsageWorker - token_usage_worker - process_message - 117 - [token_usage_worker] RAW token usage data: {'interaction_id': 'cf272141-313b-4f0c-825c-ee96fd2c2c5d', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '144641834', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 2641, 'completion_tokens': 135, 'total_tokens': 2776, 'timestamp': '2025-05-28T13:48:10.948510+00:00'}
2025-05-28 18:48:10,958 - INFO - TokenUsageWorker - token_usage_worker - process_message - 129 - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: cf272141-313b-4f0c-825c-ee96fd2c2c5d
2025-05-28 18:48:10,963 - INFO - HistorySaverWorker - history_saver_worker - process_message - 123 - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: cf272141-313b-4f0c-825c-ee96fd2c2c5d, db_id: 906
2025-05-28 18:48:10,994 - INFO - TokenUsageWorker - token_usage_worker - process_message - 148 - [token_usage_worker] Found message_id: 906 for interaction_id: cf272141-313b-4f0c-825c-ee96fd2c2c5d on attempt 1
2025-05-28 18:48:10,998 - INFO - TokenUsageWorker - token_usage_worker - _save_token_usage_to_db - 92 - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: cf272141-313b-4f0c-825c-ee96fd2c2c5d, db_id: 366
2025-05-28 18:51:27,070 - INFO - app.core.lifespan - lifespan - lifespan - 287 - Application shutdown sequence initiated.
2025-05-28 18:51:27,071 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 230 - Stopping 3 background tasks...
2025-05-28 18:51:27,071 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:51:27,071 - INFO - HistorySaverWorker - runnable_component - run - 116 - Run_loop for HistorySaverWorker (instance: 4446485584) was cancelled.
2025-05-28 18:51:27,071 - INFO - HistorySaverWorker - runnable_component - run - 123 - Component HistorySaverWorker (instance: 4446485584) stopping. Performing cleanup...
2025-05-28 18:51:27,071 - INFO - HistorySaverWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:51:27,075 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:51:27,076 - INFO - HistorySaverWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:51:27,076 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:51:27,076 - INFO - HistorySaverWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:51:27,076 - INFO - HistorySaverWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:51:27,076 - INFO - HistorySaverWorker - runnable_component - run - 128 - Component HistorySaverWorker (instance: 4446485584) cleanup complete.
2025-05-28 18:51:27,076 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:51:27,076 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:51:27,076 - INFO - TokenUsageWorker - runnable_component - run - 116 - Run_loop for TokenUsageWorker (instance: 4446485056) was cancelled.
2025-05-28 18:51:27,076 - INFO - TokenUsageWorker - runnable_component - run - 123 - Component TokenUsageWorker (instance: 4446485056) stopping. Performing cleanup...
2025-05-28 18:51:27,076 - INFO - TokenUsageWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:51:27,079 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:51:27,080 - INFO - TokenUsageWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:51:27,080 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:51:27,080 - INFO - TokenUsageWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:51:27,080 - INFO - TokenUsageWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:51:27,080 - INFO - TokenUsageWorker - runnable_component - run - 128 - Component TokenUsageWorker (instance: 4446485056) cleanup complete.
2025-05-28 18:51:27,080 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:51:27,080 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 234 - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:51:27,080 - INFO - InactivityMonitorWorker - runnable_component - run - 116 - Run_loop for InactivityMonitorWorker (instance: 4446588368) was cancelled.
2025-05-28 18:51:27,080 - INFO - InactivityMonitorWorker - runnable_component - run - 123 - Component InactivityMonitorWorker (instance: 4446588368) stopping. Performing cleanup...
2025-05-28 18:51:27,080 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 437 - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:51:27,080 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:51:27,080 - INFO - app.services.process_manager - process_manager - cleanup_manager - 170 - ProcessManager cleaned up Redis connection.
2025-05-28 18:51:27,080 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 441 - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:51:27,080 - INFO - InactivityMonitorWorker - base_worker - cleanup - 63 - [self._component_id] Worker cleanup started.
2025-05-28 18:51:27,083 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 316 - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:51:27,084 - INFO - InactivityMonitorWorker - status_updater - delete_status_key_from_redis - 196 - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:51:27,085 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:51:27,085 - INFO - InactivityMonitorWorker - status_updater - cleanup_status_updater - 320 - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:51:27,085 - INFO - InactivityMonitorWorker - base_worker - cleanup - 67 - [self._component_id] Worker cleanup completed.
2025-05-28 18:51:27,085 - INFO - InactivityMonitorWorker - inactivity_monitor_worker - cleanup - 445 - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:51:27,085 - INFO - InactivityMonitorWorker - runnable_component - run - 128 - Component InactivityMonitorWorker (instance: 4446588368) cleanup complete.
2025-05-28 18:51:27,085 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 240 - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:51:27,085 - INFO - app.core.lifespan - lifespan - stop_background_tasks - 249 - All background tasks signaled to stop.
2025-05-28 18:51:27,085 - INFO - app.services.redis_service - redis_service - close_redis_pool - 43 - Redis connection pool closed successfully.
2025-05-28 18:51:27,096 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:51:27,096 - INFO - app.core.lifespan - lifespan - lifespan - 293 - Application shutdown sequence completed.
2025-05-28 18:51:27,584 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:51:27,584 - INFO - app.core.lifespan - Application startup sequence initiated.
2025-05-28 18:51:27,588 - INFO - app.services.redis_service - Redis connection pool initialized successfully.
2025-05-28 18:51:27,588 - INFO - app.core.lifespan - Starting background tasks...
2025-05-28 18:51:27,588 - INFO - app.core.lifespan - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:51:27,588 - INFO - TokenUsageWorker - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:51:27,588 - INFO - app.core.lifespan - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:51:27,588 - INFO - app.core.lifespan - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:51:27,588 - INFO - app.core.lifespan - 3 background tasks initiated.
2025-05-28 18:51:27,588 - INFO - app.core.lifespan - Attempting to start existing agents and their integrations...
2025-05-28 18:51:27,588 - INFO - HistorySaverWorker - [history_saver_worker] Worker setup started.
2025-05-28 18:51:27,589 - INFO - TokenUsageWorker - [token_usage_worker] Worker setup started.
2025-05-28 18:51:27,589 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:51:27,592 - INFO - TokenUsageWorker - [token_usage_worker] Worker setup completed.
2025-05-28 18:51:27,592 - INFO - TokenUsageWorker - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:51:27,593 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:51:27,593 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:51:27,593 - INFO - app.core.lifespan - ProcessManager setup complete for startup.
2025-05-28 18:51:27,594 - INFO - HistorySaverWorker - [history_saver_worker] Worker setup completed.
2025-05-28 18:51:27,594 - INFO - HistorySaverWorker - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:51:27,594 - INFO - TokenUsageWorker - [token_usage_worker] Database session factory initialized.
2025-05-28 18:51:27,596 - INFO - HistorySaverWorker - [history_saver_worker] Database session factory initialized.
2025-05-28 18:51:27,596 - INFO - HistorySaverWorker - Component HistorySaverWorker (instance: 4567290064) setup complete. Starting run loop.
2025-05-28 18:51:27,596 - INFO - TokenUsageWorker - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:51:27,596 - INFO - TokenUsageWorker - Component TokenUsageWorker (instance: 4567300672) setup complete. Starting run loop.
2025-05-28 18:51:27,596 - INFO - HistorySaverWorker - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:51:27,596 - INFO - TokenUsageWorker - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:51:27,598 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:51:27,598 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:51:27,646 - INFO - app.core.lifespan - Found 1 agents to potentially start.
2025-05-28 18:51:27,646 - INFO - app.core.lifespan - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:51:27,647 - INFO - app.core.lifespan - Agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:51:27,647 - INFO - app.core.lifespan - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:51:27,647 - INFO - app.core.lifespan - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:51:27,648 - INFO - app.core.lifespan - telegram integration for agent agent_airsoft_0faa9616 is already running.
2025-05-28 18:51:27,649 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:51:27,649 - INFO - app.services.process_manager - ProcessManager cleaned up Redis connection.
2025-05-28 18:51:27,649 - INFO - app.core.lifespan - ProcessManager cleanup complete for startup function.
2025-05-28 18:51:27,649 - INFO - app.core.lifespan - Application startup sequence completed.
2025-05-28 18:51:37,597 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:51:37,602 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:51:37,602 - INFO - InactivityMonitorWorker - Component InactivityMonitorWorker (instance: 4350868704) setup complete. Starting run loop.
2025-05-28 18:51:37,602 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:52:50,585 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 160 - ServiceComponentBase run_loop itself was cancelled (e.g. during shutdown).
2025-05-28 18:52:50,585 - WARNING - aiogram.dispatcher - dispatcher - _signal_stop_polling - 455 - Received SIGINT signal
2025-05-28 18:52:50,586 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component AgentRunner (instance: 4858692912) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:52:50,586 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for AgentRunner (instance: 4858692912)...
2025-05-28 18:52:50,586 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:52:50,586 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - run_loop - 536 - AgentRunner run_loop finished.
2025-05-28 18:52:50,586 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for AgentRunner (instance: 4858692912) was cancelled.
2025-05-28 18:52:50,587 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component AgentRunner (instance: 4858692912) stopping. Performing cleanup...
2025-05-28 18:52:50,587 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 546 - AgentRunner cleanup started.
2025-05-28 18:52:50,587 - INFO - aiogram.dispatcher - dispatcher - _polling - 359 - Polling stopped for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 18:52:50,587 - INFO - aiogram.dispatcher - dispatcher - start_polling - 554 - Polling stopped
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 552 - Cleared loaded threads cache 'agent_threads:agent_airsoft_0faa9616' (deleted: 1) on start/restart.
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 1 main tasks.
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:input finished.
2025-05-28 18:52:50,588 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'AgentPubSubListener' completed during cleanup with result: None
2025-05-28 18:52:50,589 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:52:50,596 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616 as part of cleanup.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key agent_status:agent_airsoft_0faa9616 from Redis.
2025-05-28 18:52:50,597 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616 cleaned up Redis resources.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - agent_runner - cleanup - 581 - AgentRunner cleanup finished.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component AgentRunner (instance: 4858692912) cleanup complete.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 51 - AgentRunner for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:52:50,597 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 60 - Shutting down agent runner for agent_airsoft_0faa9616.
2025-05-28 18:52:50,608 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:52:50,608 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 63 - Database engine closed.
2025-05-28 18:52:50,608 - INFO - AGENT:agent_airsoft_0faa9616 - runner_main - main_async_runner - 66 - Agent runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:52:50,608 - INFO - __main__ - runner_main - <module> - 86 - Agent runner main finished.
2025-05-28 18:52:50,695 - INFO - app.core.lifespan - Application shutdown sequence initiated.
2025-05-28 18:52:50,695 - INFO - app.core.lifespan - Stopping 3 background tasks...
2025-05-28 18:52:50,695 - INFO - app.core.lifespan - Attempting to cancel task HistorySaverWorker...
2025-05-28 18:52:50,695 - INFO - HistorySaverWorker - Run_loop for HistorySaverWorker (instance: 4567290064) was cancelled.
2025-05-28 18:52:50,695 - INFO - HistorySaverWorker - Component HistorySaverWorker (instance: 4567290064) stopping. Performing cleanup...
2025-05-28 18:52:50,695 - INFO - HistorySaverWorker - [self._component_id] Worker cleanup started.
2025-05-28 18:52:50,700 - INFO - HistorySaverWorker - Clearing status key for history_saver_worker as part of cleanup.
2025-05-28 18:52:50,701 - INFO - HistorySaverWorker - Deleted status key worker_status:history_saver:history_saver_worker from Redis.
2025-05-28 18:52:50,701 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:52:50,701 - INFO - HistorySaverWorker - StatusUpdater for history_saver_worker cleaned up Redis resources.
2025-05-28 18:52:50,701 - INFO - HistorySaverWorker - [self._component_id] Worker cleanup completed.
2025-05-28 18:52:50,701 - INFO - HistorySaverWorker - Component HistorySaverWorker (instance: 4567290064) cleanup complete.
2025-05-28 18:52:50,701 - INFO - app.core.lifespan - Task HistorySaverWorker finished after cancellation signal.
2025-05-28 18:52:50,701 - INFO - app.core.lifespan - Attempting to cancel task TokenUsageWorker...
2025-05-28 18:52:50,701 - INFO - TokenUsageWorker - Run_loop for TokenUsageWorker (instance: 4567300672) was cancelled.
2025-05-28 18:52:50,702 - INFO - TokenUsageWorker - Component TokenUsageWorker (instance: 4567300672) stopping. Performing cleanup...
2025-05-28 18:52:50,702 - INFO - TokenUsageWorker - [self._component_id] Worker cleanup started.
2025-05-28 18:52:50,705 - INFO - TokenUsageWorker - Clearing status key for token_usage_worker as part of cleanup.
2025-05-28 18:52:50,706 - INFO - TokenUsageWorker - Deleted status key worker_status:token_usage:token_usage_worker from Redis.
2025-05-28 18:52:50,706 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:52:50,706 - INFO - TokenUsageWorker - StatusUpdater for token_usage_worker cleaned up Redis resources.
2025-05-28 18:52:50,706 - INFO - TokenUsageWorker - [self._component_id] Worker cleanup completed.
2025-05-28 18:52:50,706 - INFO - TokenUsageWorker - Component TokenUsageWorker (instance: 4567300672) cleanup complete.
2025-05-28 18:52:50,706 - INFO - app.core.lifespan - Task TokenUsageWorker finished after cancellation signal.
2025-05-28 18:52:50,706 - INFO - app.core.lifespan - Attempting to cancel task InactivityMonitorWorker...
2025-05-28 18:52:50,706 - INFO - InactivityMonitorWorker - Run_loop for InactivityMonitorWorker (instance: 4350868704) was cancelled.
2025-05-28 18:52:50,706 - INFO - InactivityMonitorWorker - Component InactivityMonitorWorker (instance: 4350868704) stopping. Performing cleanup...
2025-05-28 18:52:50,706 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Cleaning up InactivityMonitorWorker...
2025-05-28 18:52:50,706 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:52:50,706 - INFO - app.services.process_manager - ProcessManager cleaned up Redis connection.
2025-05-28 18:52:50,706 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] ProcessManager cleaned up.
2025-05-28 18:52:50,706 - INFO - InactivityMonitorWorker - [self._component_id] Worker cleanup started.
2025-05-28 18:52:50,709 - INFO - InactivityMonitorWorker - Clearing status key for inactivity_monitor_worker as part of cleanup.
2025-05-28 18:52:50,709 - INFO - InactivityMonitorWorker - Deleted status key worker_status:inactivity_monitor:inactivity_monitor_worker from Redis.
2025-05-28 18:52:50,709 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:52:50,710 - INFO - InactivityMonitorWorker - StatusUpdater for inactivity_monitor_worker cleaned up Redis resources.
2025-05-28 18:52:50,710 - INFO - InactivityMonitorWorker - [self._component_id] Worker cleanup completed.
2025-05-28 18:52:50,710 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] InactivityMonitorWorker cleanup finished.
2025-05-28 18:52:50,710 - INFO - InactivityMonitorWorker - Component InactivityMonitorWorker (instance: 4350868704) cleanup complete.
2025-05-28 18:52:50,710 - INFO - app.core.lifespan - Task InactivityMonitorWorker finished after cancellation signal.
2025-05-28 18:52:50,710 - INFO - app.core.lifespan - All background tasks signaled to stop.
2025-05-28 18:52:50,710 - INFO - app.services.redis_service - Redis connection pool closed successfully.
2025-05-28 18:52:50,722 - INFO - app.db.session - Database engine closed successfully.
2025-05-28 18:52:50,722 - INFO - app.core.lifespan - Application shutdown sequence completed.
2025-05-28 18:52:50,841 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - polling_wrapper - 482 - Aiogram polling has stopped.
2025-05-28 18:52:50,841 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 137 - Main task 'AiogramPolling' completed. Result: None
2025-05-28 18:52:50,842 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 156 - A main task finished. Initiating shutdown of other tasks and component.
2025-05-28 18:52:50,842 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 74 - Component TelegramIntegrationBot (instance: 4456881696) received shutdown request. Initiating graceful shutdown...
2025-05-28 18:52:50,842 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - initiate_shutdown - 79 - Cancelling main task (_run_loop) for TelegramIntegrationBot (instance: 4456881696)...
2025-05-28 18:52:50,842 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - run_loop - 172 - ServiceComponentBase run_loop finished.
2025-05-28 18:52:50,843 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - run_loop - 494 - TelegramIntegrationBot run_loop for agent agent_airsoft_0faa9616 finishing.
2025-05-28 18:52:50,845 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 116 - Run_loop for TelegramIntegrationBot (instance: 4456881696) was cancelled.
2025-05-28 18:52:50,845 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 123 - Component TelegramIntegrationBot (instance: 4456881696) stopping. Performing cleanup...
2025-05-28 18:52:50,846 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 503 - TelegramIntegrationBot cleanup started.
2025-05-28 18:52:50,847 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 516 - Closing Aiogram bot session.
2025-05-28 18:52:50,847 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 518 - Aiogram bot session closed.
2025-05-28 18:52:50,847 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 181 - ServiceComponent cleanup started. Cancelling 2 main tasks.
2025-05-28 18:52:50,847 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 191 - Waiting for 1 tasks to process cancellation...
2025-05-28 18:52:50,847 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 270 - Pub/Sub listener task cancelled.
2025-05-28 18:52:50,847 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 294 - Closing Pub/Sub connection for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:52:50,848 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - _pubsub_listener_loop - 298 - Pub/Sub listener loop for agent:agent_airsoft_0faa9616:output finished.
2025-05-28 18:52:50,848 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 202 - Task 'RedisOutputListener' completed during cleanup with result: None
2025-05-28 18:52:50,848 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 207 - All main tasks processed and list cleared.
2025-05-28 18:52:50,852 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 316 - Clearing status key for agent_airsoft_0faa9616:telegram as part of cleanup.
2025-05-28 18:52:50,853 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - delete_status_key_from_redis - 196 - Deleted status key integration_status:agent_airsoft_0faa9616:telegram from Redis.
2025-05-28 18:52:50,853 - INFO - app.core.base.redis_manager - redis_manager - close_redis_resources - 139 - Closing Redis client connection.
2025-05-28 18:52:50,854 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - status_updater - cleanup_status_updater - 320 - StatusUpdater for agent_airsoft_0faa9616:telegram cleaned up Redis resources.
2025-05-28 18:52:50,854 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - service_component - cleanup - 211 - ServiceComponent cleanup completed.
2025-05-28 18:52:50,854 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot - cleanup - 524 - TelegramIntegrationBot cleanup finished.
2025-05-28 18:52:50,854 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - runnable_component - run - 128 - Component TelegramIntegrationBot (instance: 4456881696) cleanup complete.
2025-05-28 18:52:50,854 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 86 - TelegramIntegrationBot for agent_airsoft_0faa9616 finished execution or was shut down without a restart request.
2025-05-28 18:52:50,854 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 95 - Shutting down Telegram bot runner for agent_airsoft_0faa9616.
2025-05-28 18:52:50,859 - INFO - app.db.session - session - close_db_engine - 66 - Database engine closed successfully.
2025-05-28 18:52:50,859 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 98 - Database engine closed.
2025-05-28 18:52:50,859 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - telegram_bot_main - main_async_runner - 101 - Telegram bot runner for agent_airsoft_0faa9616 has been shut down.
2025-05-28 18:52:50,860 - INFO - __main__ - telegram_bot_main - <module> - 124 - Telegram bot runner main finished.
2025-05-28 18:52:56,207 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:52:56,208 - INFO - app.core.lifespan - Application startup sequence initiated.
2025-05-28 18:52:56,212 - INFO - app.services.redis_service - Redis connection pool initialized successfully.
2025-05-28 18:52:56,212 - INFO - app.core.lifespan - Starting background tasks...
2025-05-28 18:52:56,212 - INFO - app.core.lifespan - History saver worker started, listening to queue: chat_history_queue
2025-05-28 18:52:56,212 - INFO - TokenUsageWorker - [token_usage_worker] Initialized. Listening to queue: token_usage_queue
2025-05-28 18:52:56,212 - INFO - app.core.lifespan - Token usage saver worker started, listening to queue: token_usage_queue
2025-05-28 18:52:56,212 - INFO - app.core.lifespan - Inactivity monitor worker started. Check interval: 300s, Timeout: 1800s.
2025-05-28 18:52:56,212 - INFO - app.core.lifespan - 3 background tasks initiated.
2025-05-28 18:52:56,212 - INFO - app.core.lifespan - Attempting to start existing agents and their integrations...
2025-05-28 18:52:56,213 - INFO - HistorySaverWorker - [history_saver_worker] Worker setup started.
2025-05-28 18:52:56,213 - INFO - TokenUsageWorker - [token_usage_worker] Worker setup started.
2025-05-28 18:52:56,213 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Worker setup started.
2025-05-28 18:52:56,216 - INFO - HistorySaverWorker - [history_saver_worker] Worker setup completed.
2025-05-28 18:52:56,216 - INFO - HistorySaverWorker - [history_saver_worker] Listening to Redis queues: chat_history_queue
2025-05-28 18:52:56,216 - INFO - TokenUsageWorker - [token_usage_worker] Worker setup completed.
2025-05-28 18:52:56,216 - INFO - TokenUsageWorker - [token_usage_worker] Listening to Redis queues: token_usage_queue
2025-05-28 18:52:56,216 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Worker setup completed.
2025-05-28 18:52:56,216 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Scheduled task interval: 300 seconds.
2025-05-28 18:52:56,216 - INFO - app.core.lifespan - ProcessManager setup complete for startup.
2025-05-28 18:52:56,218 - INFO - HistorySaverWorker - [history_saver_worker] Database session factory initialized.
2025-05-28 18:52:56,218 - INFO - HistorySaverWorker - Component HistorySaverWorker (instance: 4450024624) setup complete. Starting run loop.
2025-05-28 18:52:56,218 - INFO - HistorySaverWorker - [history_saver_worker] Starting queue listening loop for chat_history_queue.
2025-05-28 18:52:56,218 - INFO - TokenUsageWorker - [token_usage_worker] Database session factory initialized.
2025-05-28 18:52:56,219 - INFO - TokenUsageWorker - [token_usage_worker] Redis queue 'token_usage_queue' length at setup: 0
2025-05-28 18:52:56,219 - INFO - TokenUsageWorker - Component TokenUsageWorker (instance: 4441192688) setup complete. Starting run loop.
2025-05-28 18:52:56,219 - INFO - TokenUsageWorker - [token_usage_worker] Starting queue listening loop for token_usage_queue.
2025-05-28 18:52:56,220 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] ProcessManager initialized for InactivityMonitor.
2025-05-28 18:52:56,220 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Delaying initial check for 10 seconds to allow lifespan to complete agent setups...
2025-05-28 18:52:56,265 - INFO - app.core.lifespan - Found 1 agents to potentially start.
2025-05-28 18:52:56,265 - INFO - app.core.lifespan - Attempting to start agent: agent_airsoft_0faa9616
2025-05-28 18:52:56,267 - INFO - app.services.process_manager - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 18:52:56,268 - INFO - app.core.base.process_launcher - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 2670
2025-05-28 18:52:56,268 - INFO - app.services.process_manager - Agent process agent_airsoft_0faa9616 initiated start with PID 2670
2025-05-28 18:52:56,269 - INFO - app.core.lifespan - Successfully initiated start for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 18:52:56,269 - INFO - app.core.lifespan - Found 1 integrations in config for agent agent_airsoft_0faa9616.
2025-05-28 18:52:56,269 - INFO - app.core.lifespan - Attempting to start telegram integration for agent: agent_airsoft_0faa9616 (settings provided: True)
2025-05-28 18:52:56,270 - INFO - app.services.process_manager - Attempting to start integration process for agent_airsoft_0faa9616/telegram...
2025-05-28 18:52:56,271 - INFO - app.core.base.process_launcher - [integration_start_agent_airsoft_0faa9616_telegram] Process launched without output capture. PID: 2671
2025-05-28 18:52:56,271 - INFO - app.services.process_manager - Integration process telegram for agent agent_airsoft_0faa9616 initiated start with PID 2671
2025-05-28 18:52:56,272 - INFO - app.core.lifespan - Successfully initiated start for telegram integration for agent: agent_airsoft_0faa9616. Process manager will update status.
2025-05-28 18:52:56,272 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:52:56,272 - INFO - app.services.process_manager - ProcessManager cleaned up Redis connection.
2025-05-28 18:52:56,272 - INFO - app.core.lifespan - ProcessManager cleanup complete for startup function.
2025-05-28 18:52:56,273 - INFO - app.core.lifespan - Application startup sequence completed.
2025-05-28 18:52:57,172 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Starting Telegram bot for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Database session factory configured for Telegram bot.
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - ServiceComponentBase initialized.
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - TelegramIntegrationBot initialized. PID: 2671
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Calling TelegramIntegrationBot.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - TelegramIntegrationBot setup started.
2025-05-28 18:52:57,173 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - ServiceComponent setup started.
2025-05-28 18:52:57,177 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - ServiceComponent setup completed.
2025-05-28 18:52:57,190 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Aiogram Bot and Dispatcher initialized.
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Aiogram handlers registered.
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - TelegramIntegrationBot setup complete.
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Component TelegramIntegrationBot (instance: 4403322208) setup complete. Starting run loop.
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - TelegramIntegrationBot run_loop started for agent agent_airsoft_0faa9616. Polling for updates...
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Registered main task: RedisOutputListener
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Registered main task: AiogramPolling
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Starting run_loop with 2 registered main tasks.
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:52:57,191 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Starting aiogram polling...
2025-05-28 18:52:57,192 - INFO - aiogram.dispatcher - Start polling
2025-05-28 18:52:57,195 - INFO - TELEGRAM_BOT:agent_airsoft_0faa9616 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:output
2025-05-28 18:52:57,441 - INFO - aiogram.dispatcher - Run polling for bot @Mcat_testbot id=1750613938 - 'PlatformAI'
2025-05-28 18:52:57,532 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - Database session factory configured for Agent.
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponentBase initialized.
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 2670
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner setup started.
2025-05-28 18:52:57,533 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup started.
2025-05-28 18:52:57,539 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup completed.
2025-05-28 18:52:57,539 - INFO - AGENT:agent_airsoft_0faa9616 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 18:52:57,620 - INFO - httpx - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 18:52:57,621 - INFO - AGENT:agent_airsoft_0faa9616 - Configuration fetched successfully.
2025-05-28 18:52:57,621 - INFO - AGENT:agent_airsoft_0faa9616 - Agent configuration loaded and prepared successfully.
2025-05-28 18:52:57,621 - INFO - AGENT:agent_airsoft_0faa9616 - Creating LangGraph application...
2025-05-28 18:52:57,621 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 18:52:57,621 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:52:57,647 - INFO - AGENT:agent_airsoft_0faa9616 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 18:52:57,647 - INFO - AGENT:agent_airsoft_0faa9616 - Creating agent graph in GraphFactory...
2025-05-28 18:52:57,647 - INFO - app.agent_runner.common.tools_registry - Configured 3 predefined tools from centralized registry
2025-05-28 18:52:57,647 - INFO - AGENT:agent_airsoft_0faa9616 - Added 3 tools from centralized registry
2025-05-28 18:52:57,647 - INFO - AGENT:agent_airsoft_0faa9616 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 18:52:57,701 - INFO - httpx - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 18:52:57,706 - INFO - httpx - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 18:52:58,664 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Using max_rewrites: 4
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 18:52:58,666 - INFO - AGENT:agent_airsoft_0faa9616 - Context memory enabled: True
2025-05-28 18:52:58,667 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: agent
2025-05-28 18:52:58,667 - INFO - AGENT:agent_airsoft_0faa9616 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 18:52:58,667 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: safe_tools
2025-05-28 18:52:58,667 - INFO - AGENT:agent_airsoft_0faa9616 - Added edge: safe_tools -> agent
2025-05-28 18:52:58,667 - INFO - AGENT:agent_airsoft_0faa9616 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 18:52:58,667 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 18:52:58,668 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - LangGraph application created successfully.
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - Component AgentRunner (instance: 4506879472) setup complete. Starting run loop.
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner run_loop starting...
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - Registered main task: AgentPubSubListener
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - Starting run_loop with 1 registered main tasks.
2025-05-28 18:52:58,678 - INFO - AGENT:agent_airsoft_0faa9616 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:52:58,682 - INFO - AGENT:agent_airsoft_0faa9616 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:53:06,222 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Performing initial check for crashed/stopped processes...
2025-05-28 18:53:06,226 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Initial check for crashed/stopped processes completed.
2025-05-28 18:53:06,226 - INFO - InactivityMonitorWorker - Component InactivityMonitorWorker (instance: 4450013344) setup complete. Starting run loop.
2025-05-28 18:53:06,226 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Starting scheduled task loop with interval 300s.
2025-05-28 18:54:00,583 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616: Found knowledgeBase tool with IDs: ['3']. Fetching source IDs...
2025-05-28 18:54:00,597 - INFO - httpx - HTTP Request: GET http://localhost:3001/api/v1/admin-sources/?datastoreId=3&status=sync "HTTP/1.1 200 OK"
2025-05-28 18:54:00,597 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616: Replacing knowledgeBaseIds ['3'] with source IDs (as strings) ['5', '6', '7']
2025-05-28 18:54:00,597 - INFO - app.db.crud.agent_crud - Updating agent config in DB for agent_id: agent_airsoft_0faa9616
2025-05-28 18:54:00,640 - INFO - app.db.crud.agent_crud - Agent config updated successfully for agent_id: agent_airsoft_0faa9616
2025-05-28 18:54:00,640 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616 was running. Attempting to restart it after config update.
2025-05-28 18:54:00,640 - INFO - app.services.process_manager - Restarting agent process for agent_airsoft_0faa9616...
2025-05-28 18:54:00,641 - INFO - app.services.process_manager - Stopping agent process agent_airsoft_0faa9616 (PID: 2670). Force: True
2025-05-28 18:54:00,641 - INFO - app.services.process_manager - SIGTERM sent to agent agent_airsoft_0faa9616 (PID: 2670)
2025-05-28 18:54:00,741 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 (PID: 2670) terminated gracefully after SIGTERM.
2025-05-28 18:54:00,743 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 marked as stopped in Redis.
2025-05-28 18:54:00,743 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 stopped (or stop attempted and assumed successful for restart). Pausing briefly...
2025-05-28 18:54:05,745 - INFO - app.services.process_manager - Proceeding to start agent agent_airsoft_0faa9616 after delay...
2025-05-28 18:54:05,748 - INFO - app.services.process_manager - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 18:54:05,749 - INFO - app.core.base.process_launcher - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 2744
2025-05-28 18:54:05,749 - INFO - app.services.process_manager - Agent process agent_airsoft_0faa9616 initiated start with PID 2744
2025-05-28 18:54:05,750 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 successfully started as part of restart sequence.
2025-05-28 18:54:05,750 - INFO - app.api.routers.agent_api - Restart command issued for agent agent_airsoft_0faa9616 after config update.
2025-05-28 18:54:05,750 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:54:05,750 - INFO - app.services.process_manager - ProcessManager cleaned up Redis connection.
2025-05-28 18:54:07,105 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - Database session factory configured for Agent.
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponentBase initialized.
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 2744
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner setup started.
2025-05-28 18:54:07,106 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup started.
2025-05-28 18:54:07,112 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup completed.
2025-05-28 18:54:07,112 - INFO - AGENT:agent_airsoft_0faa9616 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 18:54:07,190 - INFO - httpx - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 18:54:07,190 - INFO - AGENT:agent_airsoft_0faa9616 - Configuration fetched successfully.
2025-05-28 18:54:07,190 - INFO - AGENT:agent_airsoft_0faa9616 - Agent configuration loaded and prepared successfully.
2025-05-28 18:54:07,190 - INFO - AGENT:agent_airsoft_0faa9616 - Creating LangGraph application...
2025-05-28 18:54:07,190 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 18:54:07,190 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:54:07,216 - INFO - AGENT:agent_airsoft_0faa9616 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 18:54:07,216 - INFO - AGENT:agent_airsoft_0faa9616 - Creating agent graph in GraphFactory...
2025-05-28 18:54:07,216 - INFO - app.agent_runner.common.tools_registry - Configured 3 predefined tools from centralized registry
2025-05-28 18:54:07,216 - INFO - AGENT:agent_airsoft_0faa9616 - Added 3 tools from centralized registry
2025-05-28 18:54:07,216 - INFO - AGENT:agent_airsoft_0faa9616 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 18:54:07,277 - INFO - httpx - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 18:54:07,283 - INFO - httpx - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 18:54:08,277 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:54:08,280 - INFO - AGENT:agent_airsoft_0faa9616 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 18:54:08,280 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1745316404538) for datasources: ['5', '6', '7']
2025-05-28 18:54:08,280 - INFO - AGENT:agent_airsoft_0faa9616 - Using max_rewrites: 4
2025-05-28 18:54:08,280 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 18:54:08,281 - INFO - AGENT:agent_airsoft_0faa9616 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 18:54:08,281 - INFO - AGENT:agent_airsoft_0faa9616 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 4.
2025-05-28 18:54:08,281 - INFO - AGENT:agent_airsoft_0faa9616 - Context memory enabled: True
2025-05-28 18:54:08,281 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: agent
2025-05-28 18:54:08,282 - INFO - AGENT:agent_airsoft_0faa9616 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 18:54:08,282 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: safe_tools
2025-05-28 18:54:08,282 - INFO - AGENT:agent_airsoft_0faa9616 - Added edge: safe_tools -> agent
2025-05-28 18:54:08,282 - INFO - AGENT:agent_airsoft_0faa9616 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 18:54:08,282 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 18:54:08,282 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 18:54:08,293 - INFO - AGENT:agent_airsoft_0faa9616 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 18:54:08,293 - INFO - AGENT:agent_airsoft_0faa9616 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 18:54:08,293 - INFO - AGENT:agent_airsoft_0faa9616 - LangGraph application created successfully.
2025-05-28 18:54:08,293 - INFO - AGENT:agent_airsoft_0faa9616 - Component AgentRunner (instance: 4504094192) setup complete. Starting run loop.
2025-05-28 18:54:08,293 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner run_loop starting...
2025-05-28 18:54:08,293 - INFO - AGENT:agent_airsoft_0faa9616 - Registered main task: AgentPubSubListener
2025-05-28 18:54:08,294 - INFO - AGENT:agent_airsoft_0faa9616 - Starting run_loop with 1 registered main tasks.
2025-05-28 18:54:08,294 - INFO - AGENT:agent_airsoft_0faa9616 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:54:08,297 - INFO - AGENT:agent_airsoft_0faa9616 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:54:41,853 - INFO - app.db.crud.agent_crud - Updating agent config in DB for agent_id: agent_airsoft_0faa9616
2025-05-28 18:54:41,888 - INFO - app.db.crud.agent_crud - Agent config updated successfully for agent_id: agent_airsoft_0faa9616
2025-05-28 18:54:41,889 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616 was running. Attempting to restart it after config update.
2025-05-28 18:54:41,889 - INFO - app.services.process_manager - Restarting agent process for agent_airsoft_0faa9616...
2025-05-28 18:54:41,891 - INFO - app.services.process_manager - Stopping agent process agent_airsoft_0faa9616 (PID: 2744). Force: True
2025-05-28 18:54:41,892 - INFO - app.services.process_manager - SIGTERM sent to agent agent_airsoft_0faa9616 (PID: 2744)
2025-05-28 18:54:41,992 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 (PID: 2744) terminated gracefully after SIGTERM.
2025-05-28 18:54:41,994 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 marked as stopped in Redis.
2025-05-28 18:54:41,994 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 stopped (or stop attempted and assumed successful for restart). Pausing briefly...
2025-05-28 18:54:46,995 - INFO - app.services.process_manager - Proceeding to start agent agent_airsoft_0faa9616 after delay...
2025-05-28 18:54:46,998 - INFO - app.services.process_manager - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 18:54:46,999 - INFO - app.core.base.process_launcher - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 2766
2025-05-28 18:54:46,999 - INFO - app.services.process_manager - Agent process agent_airsoft_0faa9616 initiated start with PID 2766
2025-05-28 18:54:47,000 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 successfully started as part of restart sequence.
2025-05-28 18:54:47,000 - INFO - app.api.routers.agent_api - Restart command issued for agent agent_airsoft_0faa9616 after config update.
2025-05-28 18:54:47,000 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:54:47,000 - INFO - app.services.process_manager - ProcessManager cleaned up Redis connection.
2025-05-28 18:54:48,258 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - Database session factory configured for Agent.
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponentBase initialized.
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 2766
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner setup started.
2025-05-28 18:54:48,259 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup started.
2025-05-28 18:54:48,266 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup completed.
2025-05-28 18:54:48,266 - INFO - AGENT:agent_airsoft_0faa9616 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 18:54:48,346 - INFO - httpx - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 18:54:48,346 - INFO - AGENT:agent_airsoft_0faa9616 - Configuration fetched successfully.
2025-05-28 18:54:48,346 - INFO - AGENT:agent_airsoft_0faa9616 - Agent configuration loaded and prepared successfully.
2025-05-28 18:54:48,346 - INFO - AGENT:agent_airsoft_0faa9616 - Creating LangGraph application...
2025-05-28 18:54:48,346 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 18:54:48,346 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Creating agent graph in GraphFactory...
2025-05-28 18:54:48,372 - INFO - app.agent_runner.common.tools_registry - Configured 3 predefined tools from centralized registry
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Added 3 tools from centralized registry
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - No Knowledge Base tools configured.
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Using max_rewrites: 3
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Total tools configured: 4 (4 safe, 0 datastore).
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Tools configured: 4 total, 4 safe, 0 datastore tools. Max rewrites: 3.
2025-05-28 18:54:48,372 - INFO - AGENT:agent_airsoft_0faa9616 - Context memory enabled: True
2025-05-28 18:54:48,373 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: agent
2025-05-28 18:54:48,373 - INFO - AGENT:agent_airsoft_0faa9616 - No datastore tools configured. RAG nodes skipped.
2025-05-28 18:54:48,373 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: safe_tools
2025-05-28 18:54:48,373 - INFO - AGENT:agent_airsoft_0faa9616 - Added edge: safe_tools -> agent
2025-05-28 18:54:48,373 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', '__end__'])
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - LangGraph application created successfully.
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - Component AgentRunner (instance: 4430071040) setup complete. Starting run loop.
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner run_loop starting...
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - Registered main task: AgentPubSubListener
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - Starting run_loop with 1 registered main tasks.
2025-05-28 18:54:48,378 - INFO - AGENT:agent_airsoft_0faa9616 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:54:48,381 - INFO - AGENT:agent_airsoft_0faa9616 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:55:14,652 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616: Found knowledgeBase tool with IDs: ['3']. Fetching source IDs...
2025-05-28 18:55:14,659 - INFO - httpx - HTTP Request: GET http://localhost:3001/api/v1/admin-sources/?datastoreId=3&status=sync "HTTP/1.1 200 OK"
2025-05-28 18:55:14,660 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616: Replacing knowledgeBaseIds ['3'] with source IDs (as strings) ['5', '6', '7']
2025-05-28 18:55:14,660 - INFO - app.db.crud.agent_crud - Updating agent config in DB for agent_id: agent_airsoft_0faa9616
2025-05-28 18:55:14,668 - INFO - app.db.crud.agent_crud - Agent config updated successfully for agent_id: agent_airsoft_0faa9616
2025-05-28 18:55:14,668 - INFO - app.api.routers.agent_api - Agent agent_airsoft_0faa9616 was running. Attempting to restart it after config update.
2025-05-28 18:55:14,668 - INFO - app.services.process_manager - Restarting agent process for agent_airsoft_0faa9616...
2025-05-28 18:55:14,671 - INFO - app.services.process_manager - Stopping agent process agent_airsoft_0faa9616 (PID: 2766). Force: True
2025-05-28 18:55:14,671 - INFO - app.services.process_manager - SIGTERM sent to agent agent_airsoft_0faa9616 (PID: 2766)
2025-05-28 18:55:14,772 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 (PID: 2766) terminated gracefully after SIGTERM.
2025-05-28 18:55:14,774 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 marked as stopped in Redis.
2025-05-28 18:55:14,774 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 stopped (or stop attempted and assumed successful for restart). Pausing briefly...
2025-05-28 18:55:19,775 - INFO - app.services.process_manager - Proceeding to start agent agent_airsoft_0faa9616 after delay...
2025-05-28 18:55:19,778 - INFO - app.services.process_manager - Attempting to start agent process for agent_airsoft_0faa9616...
2025-05-28 18:55:19,779 - INFO - app.core.base.process_launcher - [agent_start_agent_airsoft_0faa9616] Process launched without output capture. PID: 2785
2025-05-28 18:55:19,779 - INFO - app.services.process_manager - Agent process agent_airsoft_0faa9616 initiated start with PID 2785
2025-05-28 18:55:19,780 - INFO - app.services.process_manager - Agent agent_airsoft_0faa9616 successfully started as part of restart sequence.
2025-05-28 18:55:19,780 - INFO - app.api.routers.agent_api - Restart command issued for agent agent_airsoft_0faa9616 after config update.
2025-05-28 18:55:19,780 - INFO - app.core.base.redis_manager - Closing Redis client connection.
2025-05-28 18:55:19,780 - INFO - app.services.process_manager - ProcessManager cleaned up Redis connection.
2025-05-28 18:55:21,060 - INFO - app.core.logging_config - Logging configured with level: INFO
2025-05-28 18:55:21,060 - INFO - AGENT:agent_airsoft_0faa9616 - Starting agent runner for Agent ID: agent_airsoft_0faa9616
2025-05-28 18:55:21,061 - INFO - AGENT:agent_airsoft_0faa9616 - Database session factory configured for Agent.
2025-05-28 18:55:21,061 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponentBase initialized.
2025-05-28 18:55:21,061 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner for agent agent_airsoft_0faa9616 initialized. PID: 2785
2025-05-28 18:55:21,061 - INFO - AGENT:agent_airsoft_0faa9616 - Calling AgentRunner.run() for agent agent_airsoft_0faa9616...
2025-05-28 18:55:21,061 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner setup started.
2025-05-28 18:55:21,061 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup started.
2025-05-28 18:55:21,067 - INFO - AGENT:agent_airsoft_0faa9616 - ServiceComponent setup completed.
2025-05-28 18:55:21,067 - INFO - AGENT:agent_airsoft_0faa9616 - Fetching configuration from: http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config
2025-05-28 18:55:21,141 - INFO - httpx - HTTP Request: GET http://localhost:8001/api/v1/agents/agent_airsoft_0faa9616/config "HTTP/1.1 200 OK"
2025-05-28 18:55:21,141 - INFO - AGENT:agent_airsoft_0faa9616 - Configuration fetched successfully.
2025-05-28 18:55:21,141 - INFO - AGENT:agent_airsoft_0faa9616 - Agent configuration loaded and prepared successfully.
2025-05-28 18:55:21,141 - INFO - AGENT:agent_airsoft_0faa9616 - Creating LangGraph application...
2025-05-28 18:55:21,141 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create agent graph for agent_id: agent_airsoft_0faa9616 using GraphFactory.
2025-05-28 18:55:21,141 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:55:21,167 - INFO - AGENT:agent_airsoft_0faa9616 - Main LLM configured: gpt-4.1-mini via OpenAI
2025-05-28 18:55:21,167 - INFO - AGENT:agent_airsoft_0faa9616 - Creating agent graph in GraphFactory...
2025-05-28 18:55:21,167 - INFO - app.agent_runner.common.tools_registry - Configured 3 predefined tools from centralized registry
2025-05-28 18:55:21,167 - INFO - AGENT:agent_airsoft_0faa9616 - Added 3 tools from centralized registry
2025-05-28 18:55:21,167 - INFO - AGENT:agent_airsoft_0faa9616 - Configuring 1 Knowledge Base tool(s)...
2025-05-28 18:55:21,226 - INFO - httpx - HTTP Request: GET http://127.0.0.1:6333 "HTTP/1.1 200 OK"
2025-05-28 18:55:21,231 - INFO - httpx - HTTP Request: GET http://127.0.0.1:6333/collections/platformai "HTTP/1.1 200 OK"
2025-05-28 18:55:22,313 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Connected to Qdrant at http://127.0.0.1:6333, collection: platformai
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Knowledge Base tool 'База знаний' (ID: knowledgeBase-1748440512419) for datasources: ['5', '6', '7']
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Using max_rewrites: 3
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Configured Web Search tool 'Поиск в Интернете' (ID: webSearch-1746879979658)
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Total tools configured: 5 (4 safe, 1 datastore).
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Tools configured: 5 total, 4 safe, 1 datastore tools. Max rewrites: 3.
2025-05-28 18:55:22,317 - INFO - AGENT:agent_airsoft_0faa9616 - Context memory enabled: True
2025-05-28 18:55:22,318 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: agent
2025-05-28 18:55:22,318 - INFO - AGENT:agent_airsoft_0faa9616 - Added RAG nodes: retrieve, grade_documents, rewrite, generate
2025-05-28 18:55:22,318 - INFO - AGENT:agent_airsoft_0faa9616 - Added node: safe_tools
2025-05-28 18:55:22,318 - INFO - AGENT:agent_airsoft_0faa9616 - Added edge: safe_tools -> agent
2025-05-28 18:55:22,318 - INFO - AGENT:agent_airsoft_0faa9616 - Added RAG edges: retrieve->grade, rewrite->agent, generate->END
2025-05-28 18:55:22,319 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: grade_documents -> decide_to_generate
2025-05-28 18:55:22,319 - INFO - AGENT:agent_airsoft_0faa9616 - Added conditional edge: agent -> route_tools (possible: ['safe_tools', 'retrieve', '__end__'])
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - Agent graph compiled successfully in GraphFactory. Checkpointer: Enabled
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - GraphFactory successfully created graph for agent_id: agent_airsoft_0faa9616.
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - LangGraph application created successfully.
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - Component AgentRunner (instance: 5168022928) setup complete. Starting run loop.
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - AgentRunner run_loop starting...
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - Registered main task: AgentPubSubListener
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - Starting run_loop with 1 registered main tasks.
2025-05-28 18:55:22,329 - INFO - AGENT:agent_airsoft_0faa9616 - Pub/Sub listener starting for channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:55:22,333 - INFO - AGENT:agent_airsoft_0faa9616 - Subscribed to Redis channel: agent:agent_airsoft_0faa9616:input
2025-05-28 18:56:09,058 - INFO - app.api.routers.sse_api - SSE connection requested for agent agent_airsoft_0faa9616, thread a469dcf5-a2a5-4344-b15c-27db2e19360a
2025-05-28 18:56:41,842 - INFO - app.api.routers.sse_api - Message published to agent:agent_airsoft_0faa9616:input for agent agent_airsoft_0faa9616, thread 9fb8e3a6-7879-4612-9e53-9d1bbaea8257
2025-05-28 18:56:41,842 - INFO - AGENT:agent_airsoft_0faa9616 - Processing message for chat_id: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257
2025-05-28 18:56:41,844 - INFO - AGENT:agent_airsoft_0faa9616 - Queued user message for history (Thread: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257, InteractionID: d06c037a-a1bc-45a7-bb04-fe36755847d0)
2025-05-28 18:56:41,844 - INFO - AGENT:agent_airsoft_0faa9616 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:56:41,845 - INFO - AGENT:agent_airsoft_0faa9616 - Thread '9fb8e3a6-7879-4612-9e53-9d1bbaea8257' not found in cache 'agent_threads:agent_airsoft_0faa9616'. Loading history from DB with depth 20.
2025-05-28 18:56:41,866 - INFO - HistorySaverWorker - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: d06c037a-a1bc-45a7-bb04-fe36755847d0, db_id: 907
2025-05-28 18:56:41,947 - INFO - AGENT:agent_airsoft_0faa9616 - Loaded 1 messages from DB for thread '9fb8e3a6-7879-4612-9e53-9d1bbaea8257'.
2025-05-28 18:56:41,949 - INFO - AGENT:agent_airsoft_0faa9616 - Added thread '9fb8e3a6-7879-4612-9e53-9d1bbaea8257' to cache 'agent_threads:agent_airsoft_0faa9616'.
2025-05-28 18:56:41,949 - INFO - AGENT:agent_airsoft_0faa9616 - Invoking graph for thread_id: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257 (Initial history messages: 1)
2025-05-28 18:56:41,960 - INFO - app.api.routers.sse_api - SSE connection requested for agent agent_airsoft_0faa9616, thread 9fb8e3a6-7879-4612-9e53-9d1bbaea8257
2025-05-28 18:56:42,042 - INFO - AGENT:agent_airsoft_0faa9616 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:56:42,042 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:56:42,077 - INFO - AGENT:agent_airsoft_0faa9616 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:56:42,084 - INFO - AGENT:agent_airsoft_0faa9616 - Model bound to 5 tools.
2025-05-28 18:56:43,268 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:56:46,452 - INFO - AGENT:agent_airsoft_0faa9616 - Agent node response content preview: Количество программистов, необходимых для перехода на 1С:Управление Торговлей 11 (УТ11), зависит от 
2025-05-28 18:56:46,452 - INFO - AGENT:agent_airsoft_0faa9616 - Agent node response_metadata: {'finish_reason': 'stop', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_71b9d4b387'}
2025-05-28 18:56:46,452 - INFO - AGENT:agent_airsoft_0faa9616 - Agent node usage_metadata: {'input_tokens': 391, 'output_tokens': 186, 'total_tokens': 577, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:56:46,452 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage from usage_metadata: P:391 C:186 T:577
2025-05-28 18:56:46,452 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage for agent_llm: 577 tokens recorded.
2025-05-28 18:56:46,453 - INFO - AGENT:agent_airsoft_0faa9616 - ---ROUTE TOOLS---
2025-05-28 18:56:46,453 - INFO - AGENT:agent_airsoft_0faa9616 - ---DECISION: NO TOOLS CALLED, END---
2025-05-28 18:56:46,454 - INFO - AGENT:agent_airsoft_0faa9616 - Graph execution finished. Final response: Количество программистов, необходимых для перехода на 1С:Управление Торговлей 11 (УТ11), зависит от ...
2025-05-28 18:56:46,457 - INFO - AGENT:agent_airsoft_0faa9616 - Queued agent message for history (Thread: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257, InteractionID: d06c037a-a1bc-45a7-bb04-fe36755847d0)
2025-05-28 18:56:46,458 - INFO - AGENT:agent_airsoft_0faa9616 - Found 1 token usage events for InteractionID: d06c037a-a1bc-45a7-bb04-fe36755847d0.
2025-05-28 18:56:46,462 - INFO - TokenUsageWorker - [token_usage_worker] RAW token usage data: {'interaction_id': 'd06c037a-a1bc-45a7-bb04-fe36755847d0', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '9fb8e3a6-7879-4612-9e53-9d1bbaea8257', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 391, 'completion_tokens': 186, 'total_tokens': 577, 'timestamp': '2025-05-28T13:56:46.452692+00:00'}
2025-05-28 18:56:46,463 - INFO - TokenUsageWorker - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: d06c037a-a1bc-45a7-bb04-fe36755847d0
2025-05-28 18:56:46,470 - INFO - HistorySaverWorker - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: d06c037a-a1bc-45a7-bb04-fe36755847d0, db_id: 908
2025-05-28 18:56:46,510 - INFO - TokenUsageWorker - [token_usage_worker] Found message_id: 908 for interaction_id: d06c037a-a1bc-45a7-bb04-fe36755847d0 on attempt 1
2025-05-28 18:56:46,519 - INFO - TokenUsageWorker - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: d06c037a-a1bc-45a7-bb04-fe36755847d0, db_id: 367
2025-05-28 18:58:06,374 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 18:58:06,385 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Scheduled task completed.
2025-05-28 18:58:29,107 - INFO - app.api.routers.sse_api - Message published to agent:agent_airsoft_0faa9616:input for agent agent_airsoft_0faa9616, thread 9fb8e3a6-7879-4612-9e53-9d1bbaea8257
2025-05-28 18:58:29,108 - INFO - AGENT:agent_airsoft_0faa9616 - Processing message for chat_id: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257
2025-05-28 18:58:29,109 - INFO - AGENT:agent_airsoft_0faa9616 - Queued user message for history (Thread: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257, InteractionID: ed604089-d348-4c2c-8147-91a980b207a7)
2025-05-28 18:58:29,109 - INFO - AGENT:agent_airsoft_0faa9616 - Using history limit: 20 (enabled: True, configured depth: 20)
2025-05-28 18:58:29,110 - INFO - AGENT:agent_airsoft_0faa9616 - Thread '9fb8e3a6-7879-4612-9e53-9d1bbaea8257' found in cache 'agent_threads:agent_airsoft_0faa9616'. Skipping DB load.
2025-05-28 18:58:29,110 - INFO - AGENT:agent_airsoft_0faa9616 - Invoking graph for thread_id: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257 (Initial history messages: 0)
2025-05-28 18:58:29,121 - INFO - AGENT:agent_airsoft_0faa9616 - ---CALL AGENT NODE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:58:29,122 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:58:29,126 - INFO - HistorySaverWorker - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7, db_id: 909
2025-05-28 18:58:29,154 - INFO - AGENT:agent_airsoft_0faa9616 - Created agent LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:58:29,159 - INFO - AGENT:agent_airsoft_0faa9616 - Model bound to 5 tools.
2025-05-28 18:58:30,366 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:58:30,686 - INFO - AGENT:agent_airsoft_0faa9616 - Agent node response content preview: N/A
2025-05-28 18:58:30,686 - INFO - AGENT:agent_airsoft_0faa9616 - Agent node response_metadata: {'finish_reason': 'tool_calls', 'model_name': 'gpt-4.1-mini-2025-04-14', 'system_fingerprint': 'fp_71b9d4b387'}
2025-05-28 18:58:30,686 - INFO - AGENT:agent_airsoft_0faa9616 - Agent node usage_metadata: {'input_tokens': 590, 'output_tokens': 35, 'total_tokens': 625, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-28 18:58:30,686 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage from usage_metadata: P:590 C:35 T:625
2025-05-28 18:58:30,686 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage for agent_llm: 625 tokens recorded.
2025-05-28 18:58:30,687 - INFO - AGENT:agent_airsoft_0faa9616 - ---ROUTE TOOLS---
2025-05-28 18:58:30,687 - INFO - AGENT:agent_airsoft_0faa9616 - Tool call detected: knowledgeBase-1748440512419
2025-05-28 18:58:30,687 - INFO - AGENT:agent_airsoft_0faa9616 - ---DECISION: ROUTE TO RETRIEVE (knowledgeBase-1748440512419)---
2025-05-28 18:58:31,803 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-05-28 18:58:31,824 - INFO - httpx - HTTP Request: POST http://127.0.0.1:6333/collections/platformai/points/query "HTTP/1.1 200 OK"
2025-05-28 18:58:31,827 - INFO - AGENT:agent_airsoft_0faa9616 - ---CHECK RELEVANCE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:58:31,828 - INFO - AGENT:agent_airsoft_0faa9616 - Grading documents for question: 'Посмотри в базе знаний'
2025-05-28 18:58:31,828 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.0, streaming: False
2025-05-28 18:58:31,853 - INFO - AGENT:agent_airsoft_0faa9616 - Created grading LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:58:31,856 - INFO - AGENT:agent_airsoft_0faa9616 - Grading document content (first 300 chars): # **8) Всякое**

8.1) Всякие обработки и механизмы которые нужно будет переписывать под новую 1с. Тут это займет месяцев 6

# **9)Разработка матрицы прав под нашу логику**

9.1) Это всякие роли права, статусы для заказов. Какая роль за что отвечает, кто что делает с заказами. 1 месяц

# **10)Обучени
2025-05-28 18:58:31,856 - INFO - AGENT:agent_airsoft_0faa9616 - Question for grading: Посмотри в базе знаний
2025-05-28 18:58:32,790 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:58:32,818 - INFO - AGENT:agent_airsoft_0faa9616 - Grading result: yes for document starting with: # **8) Всякое**

8.1) Всякие обработки и механизмы которые нужно будет переписывать под новую 1с. Ту...
2025-05-28 18:58:32,818 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage from usage_metadata: P:905 C:6 T:911
2025-05-28 18:58:32,818 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage for grading_llm: 911 tokens recorded.
2025-05-28 18:58:32,818 - INFO - AGENT:agent_airsoft_0faa9616 - Total token usage for grading_llm batch: 911 tokens.
2025-05-28 18:58:32,818 - INFO - AGENT:agent_airsoft_0faa9616 - Found 1 relevant documents out of 1 initial (after split).
2025-05-28 18:58:32,819 - INFO - AGENT:agent_airsoft_0faa9616 - ---ASSESS GRADED DOCUMENTS---
2025-05-28 18:58:32,819 - INFO - AGENT:agent_airsoft_0faa9616 - ---DECISION: RELEVANT DOCUMENTS FOUND, GENERATE---
2025-05-28 18:58:32,820 - INFO - AGENT:agent_airsoft_0faa9616 - ---GENERATE (Agent ID: agent_airsoft_0faa9616)---
2025-05-28 18:58:32,820 - INFO - AGENT:agent_airsoft_0faa9616 - Generating answer for question: 'Посмотри в базе знаний' using 1 documents.
2025-05-28 18:58:32,820 - INFO - AGENT:agent_airsoft_0faa9616 - Attempting to create LLM instance for provider: OpenAI, model: gpt-4.1-mini, temp: 0.1, streaming: True
2025-05-28 18:58:32,849 - INFO - AGENT:agent_airsoft_0faa9616 - Created generate LLM: gpt-4.1-mini via OpenAI
2025-05-28 18:58:33,685 - INFO - httpx - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-28 18:58:36,078 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage from usage_metadata: P:875 C:132 T:1007
2025-05-28 18:58:36,078 - INFO - AGENT:agent_airsoft_0faa9616 - Token usage for generation_llm: 1007 tokens recorded.
2025-05-28 18:58:36,079 - INFO - AGENT:agent_airsoft_0faa9616 - Graph execution finished. Final response: В базе знаний есть информация по этапам и срокам перехода на новую 1С, включая переписывание бизнес-...
2025-05-28 18:58:36,082 - INFO - AGENT:agent_airsoft_0faa9616 - Queued agent message for history (Thread: 9fb8e3a6-7879-4612-9e53-9d1bbaea8257, InteractionID: ed604089-d348-4c2c-8147-91a980b207a7)
2025-05-28 18:58:36,082 - INFO - AGENT:agent_airsoft_0faa9616 - Found 3 token usage events for InteractionID: ed604089-d348-4c2c-8147-91a980b207a7.
2025-05-28 18:58:36,089 - INFO - TokenUsageWorker - [token_usage_worker] RAW token usage data: {'interaction_id': 'ed604089-d348-4c2c-8147-91a980b207a7', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '9fb8e3a6-7879-4612-9e53-9d1bbaea8257', 'call_type': 'agent_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 590, 'completion_tokens': 35, 'total_tokens': 625, 'timestamp': '2025-05-28T13:58:30.686276+00:00'}
2025-05-28 18:58:36,089 - INFO - TokenUsageWorker - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7
2025-05-28 18:58:36,117 - INFO - HistorySaverWorker - [history_saver_worker] Successfully saved chat message for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7, db_id: 910
2025-05-28 18:58:36,117 - INFO - TokenUsageWorker - [token_usage_worker] Found message_id: 910 for interaction_id: ed604089-d348-4c2c-8147-91a980b207a7 on attempt 1
2025-05-28 18:58:36,127 - INFO - TokenUsageWorker - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7, db_id: 368
2025-05-28 18:58:36,132 - INFO - TokenUsageWorker - [token_usage_worker] RAW token usage data: {'interaction_id': 'ed604089-d348-4c2c-8147-91a980b207a7', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '9fb8e3a6-7879-4612-9e53-9d1bbaea8257', 'call_type': 'generation_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 875, 'completion_tokens': 132, 'total_tokens': 1007, 'timestamp': '2025-05-28T13:58:36.078633+00:00'}
2025-05-28 18:58:36,132 - INFO - TokenUsageWorker - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7
2025-05-28 18:58:36,133 - INFO - TokenUsageWorker - [token_usage_worker] Found message_id: 910 for interaction_id: ed604089-d348-4c2c-8147-91a980b207a7 on attempt 1
2025-05-28 18:58:36,136 - INFO - TokenUsageWorker - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7, db_id: 369
2025-05-28 18:58:36,139 - INFO - TokenUsageWorker - [token_usage_worker] RAW token usage data: {'interaction_id': 'ed604089-d348-4c2c-8147-91a980b207a7', 'agent_id': 'agent_airsoft_0faa9616', 'thread_id': '9fb8e3a6-7879-4612-9e53-9d1bbaea8257', 'call_type': 'grading_llm', 'model_id': 'gpt-4.1-mini-2025-04-14', 'prompt_tokens': 905, 'completion_tokens': 6, 'total_tokens': 911, 'timestamp': '2025-05-28T13:58:32.818589+00:00'}
2025-05-28 18:58:36,139 - INFO - TokenUsageWorker - [token_usage_worker] Attempting to find message_id for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7
2025-05-28 18:58:36,140 - INFO - TokenUsageWorker - [token_usage_worker] Found message_id: 910 for interaction_id: ed604089-d348-4c2c-8147-91a980b207a7 on attempt 1
2025-05-28 18:58:36,142 - INFO - TokenUsageWorker - [token_usage_worker] Successfully saved token usage for agent_id: agent_airsoft_0faa9616, interaction_id: ed604089-d348-4c2c-8147-91a980b207a7, db_id: 370
2025-05-28 19:03:06,584 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Executing scheduled task.
2025-05-28 19:03:06,594 - INFO - InactivityMonitorWorker - [inactivity_monitor_worker] Scheduled task completed.
